<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Analyse et modélisation d’agroécosystèmes sur R - 10&nbsp; Association, partitionnement et ordination</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10-imputation.html" rel="next">
<link href="./08-explorer.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-ordination.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Association, partitionnement et ordination</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Analyse et modélisation d’agroécosystèmes sur R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/chavalli/ecologie-mathematique-R/tree/h2024" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">La science des données avec R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-tableaux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Organisation des données et opérations sur des tableaux</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Science ouverte et reproductibilité</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction à Python</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07a-biostats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Biostatistiques</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07b-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction à l’analyse bayésienne en écologie</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-explorer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Explorer R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-ordination.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Association, partitionnement et ordination</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Détection de valeurs aberrantes et imputation de données manquantes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-series-temporelles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Les séries temporelles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-autoapprentissage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction à l’autoapprentissage</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-donnees-spatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Les données géospatiales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-modelisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Modélisation de mécanismes écologiques</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#espaces-danalyse" id="toc-espaces-danalyse" class="nav-link active" data-scroll-target="#espaces-danalyse"><span class="header-section-number">10.1</span> Espaces d’analyse</a>
  <ul class="collapse">
<li><a href="#abondance-et-occurrence" id="toc-abondance-et-occurrence" class="nav-link" data-scroll-target="#abondance-et-occurrence"><span class="header-section-number">10.1.1</span> Abondance et occurrence</a></li>
  <li><a href="#environnement" id="toc-environnement" class="nav-link" data-scroll-target="#environnement"><span class="header-section-number">10.1.2</span> Environnement</a></li>
  </ul>
</li>
  <li>
<a href="#analyse-dassociation" id="toc-analyse-dassociation" class="nav-link" data-scroll-target="#analyse-dassociation"><span class="header-section-number">10.2</span> Analyse d’association</a>
  <ul class="collapse">
<li><a href="#association-entre-objets-mode-q" id="toc-association-entre-objets-mode-q" class="nav-link" data-scroll-target="#association-entre-objets-mode-q"><span class="header-section-number">10.2.1</span> Association entre objets (mode Q)</a></li>
  <li><a href="#associations-entre-variables-mode-r" id="toc-associations-entre-variables-mode-r" class="nav-link" data-scroll-target="#associations-entre-variables-mode-r"><span class="header-section-number">10.2.2</span> Associations entre variables (mode R)</a></li>
  <li><a href="#conclusion-sur-les-associations" id="toc-conclusion-sur-les-associations" class="nav-link" data-scroll-target="#conclusion-sur-les-associations"><span class="header-section-number">10.2.3</span> Conclusion sur les associations</a></li>
  </ul>
</li>
  <li>
<a href="#partitionnement" id="toc-partitionnement" class="nav-link" data-scroll-target="#partitionnement"><span class="header-section-number">10.3</span> Partitionnement</a>
  <ul class="collapse">
<li><a href="#%C3%A9valuation-dun-partitionnement" id="toc-évaluation-dun-partitionnement" class="nav-link" data-scroll-target="#%C3%A9valuation-dun-partitionnement"><span class="header-section-number">10.3.1</span> Évaluation d’un partitionnement</a></li>
  <li><a href="#partitionnement-non-hi%C3%A9rarchique" id="toc-partitionnement-non-hiérarchique" class="nav-link" data-scroll-target="#partitionnement-non-hi%C3%A9rarchique"><span class="header-section-number">10.3.2</span> Partitionnement non hiérarchique</a></li>
  <li><a href="#partitionnement-hi%C3%A9rarchique" id="toc-partitionnement-hiérarchique" class="nav-link" data-scroll-target="#partitionnement-hi%C3%A9rarchique"><span class="header-section-number">10.3.3</span> Partitionnement hiérarchique</a></li>
  <li><a href="#partitionnement-hi%C3%A9rarchique-bas%C3%A9e-sur-la-densit%C3%A9-des-points" id="toc-partitionnement-hiérarchique-basée-sur-la-densité-des-points" class="nav-link" data-scroll-target="#partitionnement-hi%C3%A9rarchique-bas%C3%A9e-sur-la-densit%C3%A9-des-points"><span class="header-section-number">10.3.4</span> Partitionnement hiérarchique basée sur la densité des points</a></li>
  <li><a href="#conclusion-sur-le-partitionnement" id="toc-conclusion-sur-le-partitionnement" class="nav-link" data-scroll-target="#conclusion-sur-le-partitionnement"><span class="header-section-number">10.3.5</span> Conclusion sur le partitionnement</a></li>
  </ul>
</li>
  <li>
<a href="#ordination" id="toc-ordination" class="nav-link" data-scroll-target="#ordination"><span class="header-section-number">10.4</span> Ordination</a>
  <ul class="collapse">
<li><a href="#ordination-non-contraignante" id="toc-ordination-non-contraignante" class="nav-link" data-scroll-target="#ordination-non-contraignante"><span class="header-section-number">10.4.1</span> Ordination non contraignante</a></li>
  <li><a href="#ordination-contraignante" id="toc-ordination-contraignante" class="nav-link" data-scroll-target="#ordination-contraignante"><span class="header-section-number">10.4.2</span> Ordination contraignante</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-ord" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Association, partitionnement et ordination</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><hr>
<p><strong>Objectifs spécifiques</strong>:</p>
<p>À la fin de ce chapitre, vous</p>
<ul>
<li>serez en mesure d’effectuer des calculs permettant de mesurer des différence entre des observations, des groupes d’observation ou des variables observées</li>
<li>serez en mesure d’effectuer des analyses de partitionnement hiérarchiques et non-hiérarchiques</li>
<li>serez en mesure d’effectuer des calculs d’ordination à l’aide des techniques de réduction d’axe communes: analyse en composante principale, l’analyse de correspondance, l’analyse en coordonnées principales, analyse discriminante linéaire, l’analyse de redondance et l’analyse canonique des correspondances.</li>
</ul>
<hr>
<p>Les données écologiques incluent généralement plusieurs variables qui doivent être analysées conjointement. Les techniques pour l’analyse multivariée de données écologiques ont grandi en nombre et en complexité, laissant émerger l’écologie numérique, un nouveau domaine d’étude scientifique initié par Pierre Legendre et Louis Legendre dont l’ouvrage <em>Numerical Ecology</em>, aujourd’hui à sa troisième édition, reste un incontournable pour qui s’intéresse aux mathématiques sous-jacentes au domaine. Pour la rédaction de ces notes, c’est toutefois le livre <em>Numerical ecology with R</em>, écrit par Borcard et al.&nbsp;(2011) pour offrir un guide à qui voudrait une approche plus appliquée.</p>
<p>L’écologie numérique sera effleurée dans ce chapitre, qui introduit à trois concepts.</p>
<ol type="1">
<li>Les <strong>associations</strong> permettent de quantifier la ressemblance ou la différence entre deux observation (échantillons) ou variables (descripteurs). Lorsque l’on a plus de deux variables ou plus de deux site, nous obtenons des matrices d’association.</li>
<li>Le <strong>partitionnement</strong> permet de regrouper des observations ou des variables selon des métriques d’association.</li>
<li>L’<strong>ordination</strong> vise par l’intermédiaire de techniques de réduction d’axe à mettre de l’ordre dans des données dont le nombre élevé de variables peut amener à des difficultés d’appréciation et d’interprétation.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<section id="espaces-danalyse" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="espaces-danalyse">
<span class="header-section-number">10.1</span> Espaces d’analyse</h2>
<section id="abondance-et-occurrence" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="abondance-et-occurrence">
<span class="header-section-number">10.1.1</span> Abondance et occurrence</h3>
<p>L’abondance est le décompte d’espèces observées, tandis que l’occurrence est la présence ou l’absence d’une espèce. Le tableau suivant contient des données d’abondance.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="st">'Bruant familier'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                    <span class="st">'Citelle à poitrine rousse'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                    <span class="st">'Colibri à gorge rubis'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                    <span class="st">'Geai bleu'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                    <span class="st">'Bruant chanteur'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                    <span class="st">'Chardonneret'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span>, <span class="fl">6</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                    <span class="st">'Bruant à gorge blanche'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                    <span class="st">'Mésange à tête noire'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                    <span class="st">'Jaseur boréal'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">66</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce tableau peut être rapidement transformé en données d’occurrence, qui ne comprennent que l’information booléenne de présence (noté 1) et d’absence (noté 0).</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">occurrence</span> <span class="op">&lt;-</span> <span class="va">abundance</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">transmute_all</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">.</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>L’<strong>espace des espèces</strong> (ou des variables ou descripteurs) est celui où les espèces forment les axes et où les sites sont positionnés dans cet espace. Il s’agit d’une perspective en <em>mode R</em>, qui permet principalement d’identifier quels espèces se retrouvent plus couramment ensemble.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">abundance</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">`Bruant chanteur`</span>, <span class="va">Chardonneret</span>, <span class="va">`Mésange à tête noire`</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  `Bruant chanteur` Chardonneret `Mésange à tête noire`
              &lt;dbl&gt;        &lt;dbl&gt;                  &lt;dbl&gt;
1                 1            0                     20
2                 0            9                      1
3                 5            6                      1
4                 2            0                      0</code></pre>
</div>
</div>
<p>Dans l’<strong>espace des sites</strong> (ou les échantillons ou objets), on transpose la matrice d’abondance. On passe ici en <em>mode Q</em>, où chaque point est une espèce, et où l’on peut observer quels échantillons sont similaires.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">abundance</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          [,1] [,2] [,3] [,4]
Bruant familier              1    0    0    3
Citelle à poitrine rousse    1    0    0    0
Colibri à gorge rubis        0    1    0    0
Geai bleu                    3    2    0    0
Bruant chanteur              1    0    5    2
Chardonneret                 0    9    6    0
Bruant à gorge blanche       1    0    0    0
Mésange à tête noire        20    1    1    0
Jaseur boréal               66    0    0    0</code></pre>
</div>
</div>
</section><section id="environnement" class="level3" data-number="10.1.2"><h3 data-number="10.1.2" class="anchored" data-anchor-id="environnement">
<span class="header-section-number">10.1.2</span> Environnement</h3>
<p>L’<strong>espace de l’environnement</strong> comprend souvent un autre tableau contenant l’information sur l’environnement où se trouve les espèces: les coordonnées et l’élévation, la pente, le pH du sol, la pluviométrie, etc.</p>
</section></section><section id="analyse-dassociation" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="analyse-dassociation">
<span class="header-section-number">10.2</span> Analyse d’association</h2>
<p>Nous utiliserons le terme <em>association</em> comme une <strong>mesure pour quantifier la ressemblance ou la différence entre deux objets (échantillons) ou variables (descripteurs)</strong>.</p>
<p>Alors que la corrélation et la covariance sont des mesures d’association entre des variables (analyse en <em>mode R</em>), la <strong>similarité</strong> et la <strong>distance</strong> sont deux types de une mesure d’association entre des objets (analyse en <em>mode Q</em>). Une distance de 0 est mesurée chez deux objets identiques. La distance augmente au fur et à mesure que les objets sont dissociés. Une similarité ayant une valeur de 0 indique aucune association, tandis qu’une valeur de 1 indique une association parfaite. À l’opposé, la dissimilarité est égale à 1-similarité.</p>
<p>La distance peut être liée à la similarité par la relation:</p>
<p><span class="math display">\[distance=\sqrt{1-similarité}\]</span></p>
<p>ou</p>
<p><span class="math display">\[distance=\sqrt{dissimilarité}\]</span></p>
<p>La racine carrée permet, pour certains indices de similarité, d’obtenir des propriétés euclidiennes. Pour plus de détails, voyez le tableau 7.2 de <a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Legendre et Legendre (2012)</a>.</p>
<p>Les matrices d’association sont généralement présentées comme des matrices carrées, dont les dimensions sont égales au nombre d’objets (<em>mode Q</em>) ou de variables (<em>mode R</em>) dans le tableau. Chaque élément (“cellule”) de la matrice est un indice d’association entre un objet (ou une variable) et un autre. Ainsi, la diagonale de la matrice est un vecteur nul (distance ou dissimilarité) ou unitaire (similarité), car elle correspond à l’association entre un objet et lui-même.</p>
<p>Puisque l’association entre A et B est la même qu’entre B et A, et puisque la diagonale retourne une valeur convenue, il est possible d’exprimer une matrice d’association en mode “compact”, sous forme de vecteur. Le vecteur d’association entre des objets A, B et C contiendra toute l’information nécessaire en un vecteur de trois chiffres, <code>[AB, AC, BC]</code>, plutôt qu’une matrice de dimension <span class="math inline">\(3 \times 3\)</span>. L’impact sur la mémoire vive peut être considérable pour les calculs comprenant de nombreuses dimensions.</p>
<p>En R, les calculs de similarité et de distances peuvent être effectués avec le module vegan. La fonction <code>vegdist</code> permet de calculer les indices d’association en forme carrée.</p>
<p>Nous verrons plus tard les méthodes de mesure de similarité et de distance plus loin. Pour l’instant, utilisons la méthode de <em>Jaccard</em> pour une démonstration sur des données d’occurrence.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/vegandevs/vegan">"vegan"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: permute</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is vegan 2.6-4</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">occurrence</span>, method <span class="op">=</span> <span class="st">"jaccard"</span>,</span>
<span>        diag <span class="op">=</span> <span class="cn">TRUE</span>, upper <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1         2         3         4
1 0.0000000 0.7777778 0.7500000 0.7142857
2 0.7777778 0.0000000 0.6000000 1.0000000
3 0.7500000 0.6000000 0.0000000 0.7500000
4 0.7142857 1.0000000 0.7500000 0.0000000</code></pre>
</div>
</div>
<p>Remarquez que <code>vegdist</code> retourne une matrice dont la diagonale est de 0 (on l’affiche en spécifiant <code>diag = TRUE</code>). La diagonale est l’association d’un objet avec lui-même. Or la similarité d’un objet avec lui-même devrait être de 1! En fait, par convention <code>vegdist</code> retourne des dissimilarités, non pas des similarités. La matrice de distance serait donc calculée en extrayant la racine carrée des éléments de la matrice de dissimilarité:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dissimilarity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">occurrence</span>, method <span class="op">=</span> <span class="st">"jaccard"</span>,</span>
<span>                         diag <span class="op">=</span> <span class="cn">TRUE</span>, upper <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">dissimilarity</span><span class="op">)</span></span>
<span><span class="va">distance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1         2         3         4
1 0.0000000 0.8819171 0.8660254 0.8451543
2 0.8819171 0.0000000 0.7745967 1.0000000
3 0.8660254 0.7745967 0.0000000 0.8660254
4 0.8451543 1.0000000 0.8660254 0.0000000</code></pre>
</div>
</div>
<p>Dans le chapitre sur l’analyse compositionnelle, nous avons abordé les significations différentes que peuvent prendre le zéro. L’information fournie par un zéro peut être différente selon les circonstances. Dans le cas d’une variable continue, un zéro signifie généralement une mesure sous le seuil de détection. Deux tissus dont la concentration en cuivre est nulle ont une affinité sous la perspective de la concentration en cuivre. Dans le cas de mesures d’abondance (décompte) ou d’occurrence (présence-absence), on pourra décrire comme similaires deux niches écologiques où l’on retrouve une espèce en particulier. Mais deux sites où l’on de retrouve pas d’ours polaires ne correspondent pas nécessairement à des niches similaires! En effet, il peut exister de nombreuses raisons écologiques et méthodologiques pour lesquelles l’espèce ou les espèces n’ont pas été observées. C’est le problème des <strong>double-zéros</strong> (espèces non observées à deux sites), problème qui est amplifié avec les grilles comprenant des espèces rares.</p>
<p>La ressemblance entre des objets comprenant des données continues devrait être calculée grâce à des indicateurs <em>symétriques</em>. Inversement, les affinités entre les objets décrits par des données d’abondance ou d’occurrence susceptibles de générer des problèmes de double-zéros devraient être évaluées grâce à des indicateurs <em>asymétriques</em>. Un défi supplémentaire arrive lorsque les données sont de type mixte.</p>
<p>Nous utiliserons la convention de <code>vegan</code> et nous calculerons la dissimilarité, non pas la similarité. Les mesures de dissimilarité sont calculées sur des données d’abondance ou des données d’occurrence. Notons qu’il existe beaucoup de confusion dans la littérature sur la manière de nommer les dissimilarités (ce qui n’est pas le cas des distances, dont les noms sont reconnus). Dans les sections suivantes, nous noterons la dissimilarité avec un <span class="math inline">\(d\)</span> minuscule et la distance avec un <span class="math inline">\(D\)</span> majuscule.</p>
<section id="association-entre-objets-mode-q" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="association-entre-objets-mode-q">
<span class="header-section-number">10.2.1</span> Association entre objets (mode Q)</h3>
<section id="objets-abondance" class="level4" data-number="10.2.1.1"><h4 data-number="10.2.1.1" class="anchored" data-anchor-id="objets-abondance">
<span class="header-section-number">10.2.1.1</span> Objets: Abondance</h4>
<p>La <strong>dissimilarité de Bray-Curtis</strong> est asymétrique. Elle est aussi appelée l’indice de Steinhaus, de Czekanowski ou de Sørensen. Il est important de s’assurer de bien s’entendre la méthode à laquelle on fait référence. L’équation enlève toute ambiguïté. La dissimilarité de Bray-Curtis entre les points A et B est calculée comme suit.</p>
<p><span class="math display">\[d_{AB} =  \frac {\sum \left| A_{i} - B_{i} \right| }{\sum \left(A_{i}+B_{i}\right)}\]</span></p>
<p>Utilisons <code>vegdist</code> pour générer les matrices d’association. Le format “liste” de R est pratique pour enregistrer la collection d’objets, dont les matrice d’association que nous allons créer dans cette section.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">associations_abund</span><span class="op">[[</span><span class="st">'BrayCurtis'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">abundance</span>, method <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span><span class="va">associations_abund</span><span class="op">[[</span><span class="st">'BrayCurtis'</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1         2         3
2 0.9433962                    
3 0.9619048 0.4400000          
4 0.9591837 1.0000000 0.7647059</code></pre>
</div>
</div>
<p>La dissimilarité de Bray-Curtis est souvent utilisée dans la littérature. Toutefois, la version originale de Bray-Curtis n’est pas tout à fait métrique (semimétrique). Conséquemment, la <strong>dissimilarité de Ruzicka</strong> (une variante de la dissimilarité de Jaccard pour les données d’abondance) est métrique, et devrait probablement être préféré à Bray-Curtis (<a href="http://ocw.um.es/ciencias/geobotanica/otros-recursos-1/documentos/vegantutorial.pdf">Oksanen, 2006</a>).</p>
<p><span class="math display">\[d_{AB, Ruzicka} =  \frac { 2 \times d_{AB, Bray-Curtis} }{1 + d_{AB, Bray-Curtis}}\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_abund</span><span class="op">[[</span><span class="st">'Ruzicka'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">associations_abund</span><span class="op">[[</span><span class="st">'BrayCurtis'</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">associations_abund</span><span class="op">[[</span><span class="st">'BrayCurtis'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La <strong>dissimilarité de Kulczynski</strong> (aussi écrit Kulsinski) est asymétrique et semimétrique, tout comme celle de Bray-Curtis. Elle est calculée comme suit.</p>
<p><span class="math display">\[d_{AB} = 1-\frac{1}{2} \times \left[ \frac{\sum min(A_i, B_i)}{\sum A_i} + \frac{\sum min(A_i, B_i)}{\sum B_i} \right]\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_abund</span><span class="op">[[</span><span class="st">'Kulczynski'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">abundance</span>, method <span class="op">=</span> <span class="st">"kulczynski"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Une approche commune pour mesurer l’association entre sites décrits par des données d’abondance est la <strong>distance de Hellinger</strong>. Notez qu’il s’agit ici d’une distance, non pas d’une dissimilarité. Pour l’obtenir, on doit d’abord diviser chaque donnée d’abondance par l’abondance totale pour chaque site pour obtenir les espèces en tant que proportions, puis on extrait la racine carrée de chaque élément. Enfin, on calcule la distance euclidienne entre les proportions de chaque site. Pour rappel, une distance euclidienne est la généralisation en plusieurs dimensions du théorème de Pythagore, <span class="math inline">\(c = \sqrt{a^2 + b^2}\)</span>.</p>
<p><span class="math display">\[D_{AB} = \sqrt {\sum \left( \frac{A_i}{\sum A_i} - \frac{B_i}{\sum B_i} \right)^2}\]</span></p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 66%">
</colgroup>
<tbody><tr class="odd">
<td style="text-align: left;">😱&nbsp;<strong>Attention</strong>
</td>
<td style="text-align: right;">La distance d’Hellinger hérite des biais liées aux données compositionnelles. Elle peut être substituée par une matrice de distances d’Aitchison.</td>
</tr></tbody>
</table>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_abund</span><span class="op">[[</span><span class="st">'Hellinger'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/decostand.html">decostand</a></span><span class="op">(</span><span class="va">abundance</span>, method<span class="op">=</span><span class="st">"hellinger"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Toute comme la distance d’Hellinger, la <strong>distance de chord</strong> est calculée par une distance euclidienne sur des données d’abondance transformées de sorte que chaque ligne ait une longueur (norme) de 1.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_abund</span><span class="op">[[</span><span class="st">'Chord'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/decostand.html">decostand</a></span><span class="op">(</span><span class="va">abundance</span>, method<span class="op">=</span><span class="st">"normalize"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La <strong>métrique du chi-carré</strong>, ou <span class="math inline">\(\chi\)</span>-carré, ou chi-square, donne davantage de poids aux espèces rares qu’aux espèces communes. Son utilisation est recommandée lorsque les espèces rares sont de bons indicateurs de conditions écologiques particulières (<a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Legendre et Legendre, 2012</a>, p.&nbsp;308).</p>
<p><span class="math display">\[  d_{AB} = \sqrt{\sum _j \frac{1}{\sum y_j} \left( \frac{A_j}{\sum A} - \frac{B_j}{\sum B} \right)^2 }  \]</span></p>
<p>La métrique peut être transformée en distance en la multipliant par la racine carrée de la somme totale des espèces dans la matrice d’abondance (<span class="math inline">\(X\)</span>).</p>
<p><span class="math display">\[ D_{AB} = \sqrt{\sum X} \times d_{AB} \]</span></p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_abund</span><span class="op">[[</span><span class="st">'ChiSquare'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/decostand.html">decostand</a></span><span class="op">(</span><span class="va">abundance</span>, method<span class="op">=</span><span class="st">"chi.square"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Une manière visuellement plus intéressante de présenter une matrice d’association est un graphique de type <em>heatmap</em>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_abund_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">associations_abund</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">associations_abund_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">associations_abund</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">associations_abund_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">associations_abund_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">associations_abund_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">associations_abund_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">associations_abund_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">associations_abund_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key<span class="op">=</span><span class="va">row</span><span class="op">)</span></span>
<span>  <span class="va">associations_abund_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">column</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">associations_abund_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">associations_abund</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">associations_abund_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">associations_abund_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">associations_abund_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">row</span>, y<span class="op">=</span><span class="va">column</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">dist</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#00ccff"</span>, mid <span class="op">=</span> <span class="st">"#aad400"</span>, high <span class="op">=</span> <span class="st">"#ff0066"</span>, midpoint <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Site"</span>, y<span class="op">=</span><span class="st">"Site"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-dist-comparaison-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Peu importe le type d’association utilisée, les <em>heatmaps</em> montrent les mêmes tendances. Les associations de dissimilarité (Bray-Curtis, Kulczynski et Ruzicka) s’étalent de 0 à 1, tandis que les distances (Chi-Square, Chord et Hellinger) partent de zéro, mais n’ont pas de limite supérieure. On note les plus grandes différences entre les sites 2 et 4, tandis que les sites 2 et 3 sont les plus semblables pour toutes les mesures d’association à l’exception de la dissimilarité de Kulczynski.</p>
</section><section id="objets-occurrence-présence-absence" class="level4" data-number="10.2.1.2"><h4 data-number="10.2.1.2" class="anchored" data-anchor-id="objets-occurrence-présence-absence">
<span class="header-section-number">10.2.1.2</span> Objets: Occurrence (présence-absence)</h4>
<p>Des indices d’association différents devraient être utilisés lorsque des données sont compilées sous forme booléenne. En général, les tableaux de données d’occurrence seront compilés avec des 1 (présence) et des 0 (absence).</p>
<p>La <strong>similarité de Jaccard</strong> entre le site A et le site B est la proportion de double 1 (présences de 1 dans A et B) parmi les espèces. La dissimilarité est la proportion complémentaire (comprenant [1, 0], [0, 1] et [0, 0]). La distance de Jaccard est la racine carrée de la dissimilarité.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_occ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">associations_occ</span><span class="op">[[</span><span class="st">'Jaccard'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">occurrence</span>, method <span class="op">=</span> <span class="st">"jaccard"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les <strong>distances d’Hellinger, de chord et de chi-carré</strong> sont aussi appropriées pour les calculs de distances sur des tableaux d’occurrence.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_occ</span><span class="op">[[</span><span class="st">'Hellinger'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/decostand.html">decostand</a></span><span class="op">(</span><span class="va">occurrence</span>, method<span class="op">=</span><span class="st">"hellinger"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">associations_occ</span><span class="op">[[</span><span class="st">'Chord'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/decostand.html">decostand</a></span><span class="op">(</span><span class="va">occurrence</span>, method<span class="op">=</span><span class="st">"normalize"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">associations_occ</span><span class="op">[[</span><span class="st">'ChiSquare'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/decostand.html">decostand</a></span><span class="op">(</span><span class="va">occurrence</span>, method<span class="op">=</span><span class="st">"chi.square"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Graphiquement,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_occ_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">associations_occ</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">associations_occ_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">associations_occ</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">associations_occ_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">associations_occ_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">associations_occ_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">associations_occ_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">associations_occ_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">associations_occ_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key<span class="op">=</span><span class="va">row</span><span class="op">)</span></span>
<span>  <span class="va">associations_occ_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">column</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">associations_occ_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">associations_occ</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">associations_occ_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">associations_occ_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">associations_occ_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">row</span>, y<span class="op">=</span><span class="va">column</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">dist</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#00ccff"</span>, mid <span class="op">=</span> <span class="st">"#aad400"</span>, high <span class="op">=</span> <span class="st">"#ff0066"</span>, midpoint <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Site"</span>, y<span class="op">=</span><span class="st">"Site"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-occ-comparaison-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Il est attendu que les matrices d’association sur l’occurrence sont semblables à celles sur l’abondance. Dans ce cas-ci, la distance d’Hellinger donne des résultats semblables à la dissimilarité de Jaccard.</p>
</section><section id="objets-données-quantitatives" class="level4" data-number="10.2.1.3"><h4 data-number="10.2.1.3" class="anchored" data-anchor-id="objets-données-quantitatives">
<span class="header-section-number">10.2.1.3</span> Objets: Données quantitatives</h4>
<p>Les données quantitative en écologie peuvent décrire l’état de l’environnement: le climat, l’hydrologie, l’hydrogéochimie, la pédologie, etc. En règle générale, les coordonnées des sites ne sot pas des variables environnementales, à que l’on soupçonne la coordonnée elle-même d’être responsable d’effets sur notre système: mais il s’agira la plupart du temps d’effets confondants (par exemple, on peut mesurer un effet de la latitude sur le rendement des agrumes, mais il s’agira probablement avant tout d’effets dus aux conditions climatiques, qui elles changent en fonction de la latitude). D’autre types de données quantitative pouvant être appréhendées par des distances sont les traits phénologiques, les ionomes, les génomes, etc.</p>
<p>La <strong>distance euclidienne</strong> est la racine carrée de la somme des carrés des distances sur tous les axes. Il s’agit d’une application multidimensionnelle du théorème de Pythagore. La <strong>distance d’Aitchison</strong>, couverte dans le <a href="08-explorer.html">chapitre&nbsp;<span>9</span></a>, est une distance euclidienne calculée sur des données compositionnelles préalablement transformées. La distance euclidienne est sensible aux unités utilisés: utiliser des millimètres plutôt que des mètres enflera la distance euclidienne. Il est recommandé de porter une attention particulière aux unités, et de standardiser les données au besoin (par exemple, en centrant la moyenne à zéro et en fixant l’écart-type à 1).</p>
<p>On pourrait, par exemple, mesurer la distance entre des observations des dimensions de différentes espèces d’iris. Ce tableau est inclus dans R par défaut.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
1          5.3         3.7          1.5         0.2    setosa
2          6.4         3.1          5.5         1.8 virginica
3          4.9         3.6          1.4         0.1    setosa
4          7.9         3.8          6.4         2.0 virginica
5          4.4         2.9          1.4         0.2    setosa</code></pre>
</div>
</div>
<p>Les mesures du tableau sont en centimètres. Pour éviter de donner davantage de poids aux longueurs des sépales et en même temps de négliger la largeur des pétales, nous allons standardiser le tableau.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_sc</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span> </span>
<span><span class="va">iris_sc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 5
   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
 1       -0.898      1.02          -1.34       -1.31 setosa 
 2       -1.14      -0.132         -1.34       -1.31 setosa 
 3       -1.38       0.327         -1.39       -1.31 setosa 
 4       -1.50       0.0979        -1.28       -1.31 setosa 
 5       -1.02       1.25          -1.34       -1.31 setosa 
 6       -0.535      1.93          -1.17       -1.05 setosa 
 7       -1.50       0.786         -1.34       -1.18 setosa 
 8       -1.02       0.786         -1.28       -1.31 setosa 
 9       -1.74      -0.361         -1.34       -1.31 setosa 
10       -1.14       0.0979        -1.28       -1.44 setosa 
# ℹ 140 more rows</code></pre>
</div>
</div>
<p>Pour les comparaisons des dimensions, prenons la moyenne des dimensions (mises à l’échelle) par espèce.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_means</span> <span class="op">&lt;-</span> <span class="va">iris_sc</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="va">iris_means</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Sepal.Length Sepal.Width Petal.Length Petal.Width
         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
1       -1.01        0.850       -1.30       -1.25 
2        0.112      -0.659        0.284       0.166
3        0.899      -0.191        1.02        1.08 </code></pre>
</div>
</div>
<p>Nous pouvons utiliser la distance euclidienne, commune en géométrie, pour comparer les espèces. La distance euclidienne est calculée comme suit.</p>
<p><span class="math display">\[ \mathcal{E} = \sqrt{\Sigma_i \left( A_i - B_i \right) ^2 } \]</span></p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_cont</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">associations_cont</span><span class="op">[[</span><span class="st">'Euclidean'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">iris_sc</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"euclidean"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La <strong>distance de Mahalanobis</strong> est semblable à la distance euclidienne, mais qui tient compte de la covariance de la matrice des objets. Cette covariance peut être utilisée pour décrire la structure d’un nuage de points. La distance de Mahalanobis se calcule comme suit.</p>
<p><span class="math display">\[\mathcal{M} = \sqrt{(A - B)^T S^{-1} (A-B)}\]</span></p>
<p>Notez qu’il s’agit d’une généralisation de la distance euclidienne, qui équivaut à une distance de Mahalanobis dont la matrice de covariance est une matrice identité.</p>
<p>La distance de Mahalanobis permet de représenter des distances dans un espace fortement corrélé. Elle est couramment utilisée pour détecter les valeurs aberrantes selon des critères de distance à partir du centre d’un jeu de données multivariées.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_cont</span><span class="op">[[</span><span class="st">'Mahalanobis'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">iris_sc</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span>, <span class="st">'mahalanobis'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La <strong>distance de Manhattan</strong> porte aussi le nom de distance de cityblock ou de taxi. C’est la distance que vous devrez parcourir pour vous rendre du point A au point B à Manhattan, c’est-à-dire selon une séquence de tronçons perpendiculaires.</p>
<p><span class="math display">\[ D_{AB} = \sum _i \left| A_i - B_i \right| \]</span></p>
<p>La distance de Manhattan est appropriée lorsque les gradients (changements d’un état à l’autre ou d’une région à l’autre) ne permettent pas des changements simultanés. Mieux vaut standardiser les variables pour éviter qu’une dimension soit prépondérante.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_cont</span><span class="op">[[</span><span class="st">'Manhattan'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">iris_sc</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span>, <span class="st">'manhattan'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Avant de présenter les résultats des espèces d’iris, voici une représentation des distances euclidiennes (rouge), de Mahalanobis (bleu) et de Manhattan (vert), chacune de 1 et 2 unités à partir du centre et, pour ce qui est de la distance de Mahalanobis, selon la covariance.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://r-forge.r-project.org/projects/car/">"car"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">"MASS"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="co"># éviter les conflits de fonctions entre MASS et dplyr</span></span>
<span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span></span>
<span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># matrice de covariance</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="co"># centre</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, <span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span> <span class="co"># générer des données</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">data</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## cercles</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">*</span><span class="va">pi</span>,length<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">*</span><span class="fl">1</span>, <span class="va">mu</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">*</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span>, <span class="va">mu</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">c1</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">c2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ellipses</span></span>
<span><span class="va">e1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">ellipse</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span>, radius<span class="op">=</span><span class="fl">1</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">e2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html">ellipse</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span>, radius<span class="op">=</span><span class="fl">2</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## carrés</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-dist-iris-comparaison-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Et, graphiquement, les résultats des distances des iris.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">associations_cont_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">associations_cont</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">associations_cont_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">associations_cont</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">associations_cont_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">associations_cont_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">associations_cont_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">associations_cont_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">associations_cont_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">associations_cont_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key<span class="op">=</span><span class="va">row</span><span class="op">)</span></span>
<span>  <span class="va">associations_cont_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">column</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">associations_cont_df</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">associations_cont</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">associations_cont_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">associations_cont_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">associations_cont_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">row</span>, y<span class="op">=</span><span class="va">column</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">dist</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#geom_text(aes(label = round(value, 2))) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#00ccff"</span>, mid <span class="op">=</span> <span class="st">"#aad400"</span>, high <span class="op">=</span> <span class="st">"#ff0066"</span>, midpoint <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Site"</span>, y<span class="op">=</span><span class="st">"Site"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-dist-comparaison-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le tableau <code>iris</code> est ordonné par espèce. Les distances euclidienne et de Manhattan permettent aisément de distinguer les espèces selon les dimensions des pétales et des sépales. Toutefois, l’utilisation de la covariance avec la distance de Mahalanobis crée des distinction moins tranchées.</p>
</section><section id="objets-données-mixtes" class="level4" data-number="10.2.1.4"><h4 data-number="10.2.1.4" class="anchored" data-anchor-id="objets-données-mixtes">
<span class="header-section-number">10.2.1.4</span> Objets: Données mixtes</h4>
<p>Les données catégorielles ordinales peuvent être transformées en données continues par gradations linéaires ou quadratiques. Les données catégorielles nominales, quant à elles, peuvent être encodées (<em>encodage catégoriel</em>) en données similaires à des occurrences. Attention toutefois: contrairement à la régression linéaire qui demande d’exclure une catégorie, l’encodage catégoriel doit inclure toutes les catégories. Le comportement par défaut de la fonction <code>model.matrix</code> est d’exclure la catégorie de référence: on doit spécifier que l’intercept est de zéro, c’est-à-dire <code>model.matrix(~ + categorie)</code>.</p>
<p>La <strong>similarité de Gower</strong> a été développée pour mesurer des associations entre des objets dont les données sont mixtes: booléennes, catégorielles et continues. La similarité de Gower est calculée en additionnant les distances calculées par colonne, individuellement. Si la colonne est booléenne, on utilise les distances de Jaccard (qui exclue les double-zéro) de manière univariée: une variable à la fois. Pour les variables continues, on utilise la distance de Manhattan divisée par la plage de valeurs de la variable (pour fin de standardisation). Puisqu’elle hérite de la particularité de la distance de Manhattan et de la similarité de Jaccard univariée, la <strong>similarité de Gower</strong> reste une combinaison linéaire de distances univariées.</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,</span>
<span>            age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">21</span>, <span class="fl">21</span>, <span class="fl">19</span>, <span class="fl">30</span>, <span class="fl">21</span>, <span class="fl">21</span>, <span class="fl">19</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>            gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'M'</span>,<span class="st">'M'</span>,<span class="st">'N'</span>,<span class="st">'M'</span>,<span class="st">'F'</span>,<span class="st">'F'</span>,<span class="st">'F'</span>,<span class="st">'F'</span><span class="op">)</span>,</span>
<span>            civil_status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'MARRIED'</span>,<span class="st">'SINGLE'</span>,<span class="st">'SINGLE'</span>,<span class="st">'SINGLE'</span>,<span class="st">'MARRIED'</span>,<span class="st">'SINGLE'</span>,<span class="st">'WIDOW'</span>,<span class="st">'DIVORCED'</span><span class="op">)</span>,</span>
<span>            salary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3000.0</span>,<span class="fl">1200.0</span> ,<span class="fl">32000.0</span>,<span class="fl">1800.0</span> ,<span class="fl">2900.0</span> ,<span class="fl">1100.0</span> ,<span class="fl">10000.0</span>,<span class="fl">1500.0</span><span class="op">)</span>,</span>
<span>            children <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            available_credit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2200</span>,<span class="fl">100</span>,<span class="fl">22000</span>,<span class="fl">1100</span>,<span class="fl">2000</span>,<span class="fl">100</span>,<span class="fl">6000</span>,<span class="fl">2200</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 7
     ID   age gender civil_status salary children available_credit
  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt; &lt;lgl&gt;               &lt;dbl&gt;
1     1    21 M      MARRIED        3000 TRUE                 2200
2     2    21 M      SINGLE         1200 FALSE                 100
3     3    19 N      SINGLE        32000 TRUE                22000
4     4    30 M      SINGLE         1800 TRUE                 1100
5     5    21 F      MARRIED        2900 TRUE                 2000
6     6    21 F      SINGLE         1100 TRUE                  100
7     7    19 F      WIDOW         10000 FALSE                6000
8     8    30 F      DIVORCED       1500 TRUE                 2200</code></pre>
</div>
</div>
<p>Il faut préalablement procéder à l’encodage catégoriel pour les variables catégorielles nominales.</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X_dum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">.</span>, <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">X_dum</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  age genderF genderM genderN civil_statusMARRIED civil_statusSINGLE
1  21       0       1       0                   1                  0
2  21       0       1       0                   0                  1
3  19       0       0       1                   0                  1
4  30       0       1       0                   0                  1
5  21       1       0       0                   1                  0
6  21       1       0       0                   0                  1
7  19       1       0       0                   0                  0
8  30       1       0       0                   0                  0
  civil_statusWIDOW salary childrenTRUE available_credit
1                 0   3000            1             2200
2                 0   1200            0              100
3                 0  32000            1            22000
4                 0   1800            1             1100
5                 0   2900            1             2000
6                 0   1100            1              100
7                 1  10000            0             6000
8                 0   1500            1             2200
attr(,"assign")
 [1] 1 2 2 2 3 3 3 4 5 6
attr(,"contrasts")
attr(,"contrasts")$gender
[1] "contr.treatment"

attr(,"contrasts")$civil_status
[1] "contr.treatment"

attr(,"contrasts")$children
[1] "contr.treatment"</code></pre>
</div>
</div>
<p>Calculons la dissimilarité de Gower (cette fois le graphique est fait avec <code>pheatmap</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"pheatmap"</span><span class="op">)</span></span>
<span><span class="va">d_gow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">X_dum</span>, <span class="st">'gower'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">d_gow</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">d_gow</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">$</span><span class="va">ID</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">d_gow</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="09-ordination_files/figure-html/apo-mixte-gower-heatmap-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Les dendrogrammes apparaissant sur les axes du graphique sont issus d’un processus de partitionnement basé sur la distance, que nous verrons plus loin dans ce chapitre. Les profils des clients 4 et 7, ainsi que ceux des clients 3 et 7 diffèrent le plus. Les profils 3 et 4 sont néanmoins plutôt différents.</p>
</section></section><section id="associations-entre-variables-mode-r" class="level3" data-number="10.2.2"><h3 data-number="10.2.2" class="anchored" data-anchor-id="associations-entre-variables-mode-r">
<span class="header-section-number">10.2.2</span> Associations entre variables (mode R)</h3>
<p>Il existe de nombreuses approches pour mesurer les associations entre variables. La plus connue est la corrélation. Mais les données d’abondance et d’occurrence demandent des approches différentes.</p>
<section id="variables-abondance" class="level4" data-number="10.2.2.1"><h4 data-number="10.2.2.1" class="anchored" data-anchor-id="variables-abondance">
<span class="header-section-number">10.2.2.1</span> Variables: Abondance</h4>
<p>La distance du chi-carré est suggérée par <a href="http://www.springer.com/us/book/9781441979759">Borcard et al.&nbsp;(2011)</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">abundance_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span></span>
<span><span class="va">D_chisq_R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/decostand.html">decostand</a></span><span class="op">(</span><span class="va">abundance_r</span>, method<span class="op">=</span><span class="st">"chi.square"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">D_chisq_R</span>, display_numbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">D_chisq_R</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="09-ordination_files/figure-html/apo-r-abond-chisq-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Des coabondances sont notables pour la mésange à tête noire, le jaseur boréal, la citelle à poitrine rousse et le bruant à gorge blanche (tache bleu au centre).</p>
</section><section id="variables-occurrence" class="level4" data-number="10.2.2.2"><h4 data-number="10.2.2.2" class="anchored" data-anchor-id="variables-occurrence">
<span class="header-section-number">10.2.2.2</span> Variables: occurrence</h4>
<p>La dissimilarité de Jaccard peut être utilisée.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">occurrence_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">occurrence</span><span class="op">)</span></span>
<span><span class="va">D_jacc_R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">occurrence_r</span>, method <span class="op">=</span> <span class="st">"jaccard"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">D_jacc_R</span>, display_numbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">D_jacc_R</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="09-ordination_files/figure-html/apo-r-aocc-jaccard-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Des cooccurrences sont notables pour le jaseur boréal, la citelle à poitrine rousse et le bruant à gorge blanche (tache bleu au centre).</p>
</section><section id="variables-quantités" class="level4" data-number="10.2.2.3"><h4 data-number="10.2.2.3" class="anchored" data-anchor-id="variables-quantités">
<span class="header-section-number">10.2.2.3</span> Variables: Quantités</h4>
<p>La matrice des corrélations de Pearson peut être utilisée pour les données continues. Quant aux variables ordinales, elles devraient idéalement être liées linéairement ou quadratiquement. Si ce n’est pas le cas, c’est-à-dire que les catégories sont ordonnées par rang seulement, vous pourrez avoir recours aux coefficients de corrélation de Spearman ou de Kendall.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_cor</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>, cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>, cluster_cols <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         display_numbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">iris_cor</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="09-ordination_files/figure-html/apo-r-corr-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section></section><section id="conclusion-sur-les-associations" class="level3" data-number="10.2.3"><h3 data-number="10.2.3" class="anchored" data-anchor-id="conclusion-sur-les-associations">
<span class="header-section-number">10.2.3</span> Conclusion sur les associations</h3>
<p>Il n’existe pas de règle claire pour déterminer quelle technique d’association utiliser. Cela dépend en premier lieu de vos données. Vous sélectionnerez votre méthode d’association selon le type de données que vous abordez, la question à laquelle vous désirez répondre ainsi l’expérience dans la littérature comme celle de vos collègues scientifiques. S’il n’existe pas de règle clair, c’est qu’il existe des dizaines de méthodes différentes, et la plupart d’entre elles vous donneront une perspective juste et valide. Il faut néanmoins faire attention pour éviter de sélectionner les méthodes qui ne sont pas appropriées.</p>
</section></section><section id="partitionnement" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="partitionnement">
<span class="header-section-number">10.3</span> Partitionnement</h2>
<p>Les données suivantes ont été générées par <a href="https://github.com/scikit-learn-contrib/hdbscan/blob/master/notebooks/clusterable_data.npy">Leland McInnes</a> (Tutte institute of mathematics, Ottawa). Êtes-vous en mesure d’identifier des groupes? Combien en trouvez-vous?</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_mcinnes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/clusterable_data.csv"</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, skip <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 2309 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (2): x, y

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_mcinnes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="09-ordination_files/figure-html/apo-load-mcinnes-data-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En 2D, l’oeil humain peut facilement détecter les groupes. En 3D, c’est toujours possible, mais au-delà de 3D, le partitionnement cognitive devient rapidement maladroite. Les algorithmes sont alors d’une aide précieuse. Mais ils transportent en pratique tout un bagage de limitations. Quel est le critère d’association entre les groupes? Combien de groupe devrions-nous créer? Comment distinguer une donnée trop bruitée pour être classifiée?</p>
<p>Le partitionnement de données (<em>clustering</em> en anglais), et inversement leur regroupement, permet de créer des ensembles selon des critères d’association. On suppose donc que Le partitionnement permet de créer des groupes selon l’information que l’on fait émerger des données. Il est conséquemment entendu que les données ne sont pas catégorisées à priori: <strong>il ne s’agit pas de prédire la catégorie d’un objet, mais bien de créer des catégories à partir des objets</strong> par exemple selon leurs dimensions, leurs couleurs, leurs signature chimique, leurs comportements, leurs gènes, etc.</p>
<p>Plusieurs méthodes sont aujourd’hui offertes aux analystes pour partitionner leurs données. Dans le cadre de ce manuel, nous couvrirons ici deux grandes tendances dans les algorithmes.</p>
<ol type="1">
<li><p><em>Méthodes hiérarchique et non hiérarchiques</em>. Dans un partitionnement hiérarchique, l’ensemble des objets forme un groupe, comprenant des sous-regroupements, des sous-sous-regroupements, etc., dont les objets forment l’ultime partitionnement. On pourra alors identifier comment se décline un partitionnement. À l’inverse, un partitionnement non-hiérarchique des algorithmes permettent de créer les groupes non hiérarchisés les plus différents que possible.</p></li>
<li><p><em>Membership exclusif ou flou</em>. Certaines techniques attribuent à chaque objet une classe unique: l’appartenance sera indiquée par un 1 et la non appartenance par un 0. D’autres techniques vont attribuer un membership flou où le degré d’appartenance est une variable continue de 0 à 1. Parmi les méthodes floues, on retrouve les méthodes probabilistes.</p></li>
</ol>
<section id="évaluation-dun-partitionnement" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="évaluation-dun-partitionnement">
<span class="header-section-number">10.3.1</span> Évaluation d’un partitionnement</h3>
<p>Le choix d’une technique de partitionnement parmi de nombreuses disponibles, ainsi que le choix des paramètres gouvernant chacune d’entre elles, est avant tout basé sur ce que l’on désire définir comme étant un groupe, ainsi que la manière d’interpréter les groupes. En outre, <strong>le nombre de groupe à départager est <em>toujours</em> une décision de l’analyste</strong>. Néanmoins, on peut se fier <a href="http://scikit-learn.org/stable/modules/clustering.html#clustering-performance-evaluation">des indicateurs de performance de partitionnement</a>. Parmis ceux-ci, retenons le score <a href="https://rdrr.io/cran/cluster/man/silhouette.html">silhouette</a> ainsi que l’<a href="https://www.tandfonline.com/doi/abs/10.1080/03610927408827101">indice de Calinski-Harabaz</a>.</p>
<section id="score-silhouette" class="level4" data-number="10.3.1.1"><h4 data-number="10.3.1.1" class="anchored" data-anchor-id="score-silhouette">
<span class="header-section-number">10.3.1.1</span> Score silhouette</h4>
<p>En anglais, le <em>h</em> dans silhouette se trouve après le <em>l</em>: on parle donc de <em>silhouette coefficient</em> pour désigner le score de chacun des objets dans le partitionnement. Pour chaque objet, on calcule la distance moyenne qui le sépare des autres points de son groupe (<span class="math inline">\(a\)</span>) ainsi que la distance moyenne qui le sépare des points du groupe le plus rapproché.</p>
<p><span class="math display">\[s = \frac{b-a}{max \left(a, b \right)}\]</span></p>
<p>Un coefficient de -1 indique le pire classement, tandis qu’un coefficient de 1 indique le meilleur classement. La moyenne des coefficients silhouette est le score silhouette.</p>
</section><section id="indice-de-calinski-harabaz" class="level4" data-number="10.3.1.2"><h4 data-number="10.3.1.2" class="anchored" data-anchor-id="indice-de-calinski-harabaz">
<span class="header-section-number">10.3.1.2</span> Indice de Calinski-Harabaz</h4>
<p>L’indice de Calinski-Harabaz est proportionnel au ratio des dispersions intra-groupe et la moyenne des dispersions inter-groupes. Plus l’indice est élevé, mieux les groupes sont définis. La mathématique est décrite <a href="http://scikit-learn.org/stable/modules/clustering.html#calinski-harabaz-index">dans la documentation de scikit-learn</a>, un module d’analyse et autoapprentissage sur Python.</p>
<p><strong>Note</strong>. Les coefficients silhouette et l’indice de Calinski-Harabaz sont plus appropriés pour les formes de groupes convexes (cercles, sphères, hypersphères) que pour les formes irrégulières (notamment celles obtenues par la DBSCAN, discutée ci-dessous).</p>
</section></section><section id="partitionnement-non-hiérarchique" class="level3" data-number="10.3.2"><h3 data-number="10.3.2" class="anchored" data-anchor-id="partitionnement-non-hiérarchique">
<span class="header-section-number">10.3.2</span> Partitionnement non hiérarchique</h3>
<p>Il peut arriver que vous n’ayez pas besoin de comprendre la structure d’agglomération des objets (ou variables). Plusieurs techniques de partitionnement non hiérarchique sont disponibles sur R. On s’intéressera en particulier aux <em>k-means</em> et au <em>dbscan</em>.</p>
<section id="kmeans" class="level4" data-number="10.3.2.1"><h4 data-number="10.3.2.1" class="anchored" data-anchor-id="kmeans">
<span class="header-section-number">10.3.2.1</span> Kmeans</h4>
<p>L’objectif des kmeans est de minimiser la distance euclidienne entre un nombre prédéfini de <em>k</em> groupes exclusifs.</p>
<ol type="1">
<li>L’algorithme commence par placer une nombre <em>k</em> de centroides au hasard dans l’espace d’un nombre <em>p</em> de variables (vous devez fixer <em>k</em>, et <em>p</em> est le nombre de colonnes de vos données).</li>
<li>Ensuite, chaque objet est étiqueté comme appartenant au groupe du centroïde le plus près.</li>
<li>La position du centroïde est déplacée à la moyenne de chaque groupe.</li>
<li>Recommencer à partir de l’étape 2 jusqu’à ce que l’assignation des objets aux groupes ne change plus.</li>
</ol>
<img src="https://media.giphy.com/media/12vVAGkaqHUqCQ/giphy.gif" class="img-fluid" data-fig-align="center"><center>
Source: <a href="https://dashee87.github.io/data%20science/general/Clustering-with-Scikit-with-GIFs/">David Sheehan</a>
</center>
<p>La technique des kmeans suppose que les groupes ont des distributions multinormales - représentées par des cercles en 2D, des sphères en 3D, des hypersphères en plus de 3D. Cette limitation est problématique lorsque les groupes se présentent sous des formes irrégulières, comme celles du nuage de points de Leland McInnes, présenté plus haut. De plus, la technique classique des kmeans est basée sur des distances euclidiennes: l’utilisation des kmeans n’est appropriée pour les données comprenant beaucoup de zéros, comme les données d’abondance, qui devraient préalablement être transformées en variables centrées et réduites (<a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Legendre et Legendre, 2012</a>). La technique des <strong>mixtures gaussiennes</strong> (<a href="https://www.stat.washington.edu/mclust/"><em>gaussian mixtures</em></a>) est une généralisation des kmeans permettant d’intégrer la covariance des groupes. Les groupes ne sont plus des hyper-sphères, mais des hyper-ellipsoïdes.</p>
<section id="application" class="level5" data-number="10.3.2.1.1"><h5 data-number="10.3.2.1.1" class="anchored" data-anchor-id="application">
<span class="header-section-number">10.3.2.1.1</span> Application</h5>
<p>Nous pouvons utilisé la fonction <code>kmeans</code> de R. Toutefois, puisque l’on désire ici effectuer des tests de partitionnement pour plusieurs nombres de groupes, nous utiliserons <code>cascadeKM</code>, du module vegan. Notez que de nombreux paramètres par défaut sont utilisés dans les exécutions ci-dessous. Ces notes de cours ne forment pas un travail de recherche scientifique. Lors de travaux de recherche, l’utilsation d’un argument ou d’un autre dans une fonction doit être justifié: qu’un paramètre soit utilisé par défaut dans une fonction n’est a priori pas une justification convaincante.</p>
<p>Pour les kmeans, on doit fixer le nombre de groupes. Le graphique des données de Leland McInnes montrent 6 groupes. Toutefois, il est rare que l’on puisse visualiser des démarcations aussi tranchées que celles de l’exemple, qui plus est dans des cas où l’on doit traiter de plus de deux dimensions. Je vais donc lancer le partitionnement en boucle pour plusieurs nombres de groupes, de 3 à 10 et pour chaque groupe, évaluer le score silhouette et de Calinski-Habaraz. J’utilise un argument random_state pour m’assurer que les groupes seront les mêmes à chaque fois que la cellule sera lancée.</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/vegandevs/vegan">"vegan"</a></span><span class="op">)</span></span>
<span><span class="va">mcinnes_kmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/cascadeKM.html">cascadeKM</a></span><span class="op">(</span><span class="va">df_mcinnes</span>, inf.gr <span class="op">=</span> <span class="fl">3</span>, sup.gr <span class="op">=</span> <span class="fl">10</span>, criterion <span class="op">=</span> <span class="st">"calinski"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mcinnes_kmeans</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ partition: int [1:2309, 1:8] 1 1 1 1 1 1 1 1 1 1 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:2309] "1" "2" "3" "4" ...
  .. ..$ : chr [1:8] "3 groups" "4 groups" "5 groups" "6 groups" ...
 $ results  : num [1:2, 1:8] 85.1 2164.5 61.4 2294.6 51.4 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:2] "SSE" "calinski"
  .. ..$ : chr [1:8] "3 groups" "4 groups" "5 groups" "6 groups" ...
 $ criterion: chr "calinski"
 $ size     : int [1:10, 1:8] 1243 561 505 NA NA NA NA NA NA NA ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:10] "Group 1" "Group 2" "Group 3" "Group 4" ...
  .. ..$ : chr [1:8] "3 groups" "4 groups" "5 groups" "6 groups" ...
 - attr(*, "class")= chr "cascadeKM"</code></pre>
</div>
</div>
<p>L’objet <code>mcinnes_kmeans</code>, de type <code>cascadeKM</code>, peut être visualisé directement avec la fonction <code>plot</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mcinnes_kmeans</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="09-ordination_files/figure-html/apo-cluster-kmeans-mcinnes-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On obtient un maximum de Calinski à 4 groupes, qui correspond à la deuxième simulation effectuée de 3 à 10.</p>
<p>Examinons les scores silhouette (module: cluster).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://svn.r-project.org/R-packages/trunk/cluster/">"cluster"</a></span><span class="op">)</span></span>
<span><span class="va">asw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mcinnes_kmeans</span><span class="op">$</span><span class="va">partition</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mcinnes_kmeans_silhouette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span><span class="va">mcinnes_kmeans</span><span class="op">$</span><span class="va">partition</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">df_mcinnes</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">asw</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mcinnes_kmeans_silhouette</span><span class="op">)</span><span class="op">$</span><span class="va">avg.width</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">10</span>, <span class="va">asw</span>, type <span class="op">=</span> <span class="st">'b'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-kmeans-mcinnes-silhouette-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le score silhouette maximum est à 3 groupes. La forme des groupes n’étant pas convexe, il fallait s’attendre à ce que indicateurs maximaux pour les deux indicateurs soient différents. C’est d’ailleurs souvent le cas. Cet exemple supporte que le choix du nombre de groupe à départager repose sur l’analyste, non pas uniquement sur les indicateurs de performance. Choisissons 6 groupes, puisque que c’est visuellement ce que l’on devrait chercher pour ce cas d’étude.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kmeans_group</span> <span class="op">&lt;-</span> <span class="va">mcinnes_kmeans</span><span class="op">$</span><span class="va">partition</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">mcinnes_kmeans</span><span class="op">$</span><span class="va">partition</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  3 groups 4 groups 5 groups 6 groups 7 groups 8 groups 9 groups 10 groups
1        1        3        1        5        2        3        1         6
2        1        3        5        4        2        6        1         6
3        1        4        1        5        4        3        6        10</code></pre>
</div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_mcinnes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>kmeans_group <span class="op">=</span> <span class="va">kmeans_group</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># ajouter une colonne de regoupement</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">kmeans_group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-kmeans-mcinnes-6groupes-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>L’algorithme kmeans est loin d’être statisfaisant. Cela est attendu, puisque les kmeans recherchent des distribution gaussiennes sur des groupes vraisemblablement non-gaussiens.</p>
<p>Nous pouvons créer un graphique silhouette pour nos 6 groupes. Notez qu’à cause d’un bogue, il n’est pas possible de présenter les données clairement lorsqu’elles sont nombreuses.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span><span class="va">mcinnes_kmeans</span><span class="op">$</span><span class="va">partition</span><span class="op">[</span>, <span class="fl">6</span><span class="op">]</span>,</span>
<span>                  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">df_mcinnes</span><span class="op">[</span>, <span class="op">]</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">sortSilhouette</a></span><span class="op">(</span><span class="va">sil</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sil</span>, col <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-kmeans-mcinnes-silhouette-plot-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="dbscan" class="level4" data-number="10.3.2.2"><h4 data-number="10.3.2.2" class="anchored" data-anchor-id="dbscan">
<span class="header-section-number">10.3.2.2</span> DBSCAN</h4>
<p>La technique DBSCAN (* <strong>D</strong>ensity-<strong>B</strong>ased <strong>S</strong>patial <strong>C</strong>lustering of <strong>A</strong>pplications with <strong>N</strong>oise<em>) sousentend que les groupes sont composés de zones où l’on retrouve plus de points (zones denses) séparées par des zones de faible densité. Pour lancer l’algorithme, nous devons spécifier une mesure d’association critique (distance ou dissimilarité) </em>d* ainsi qu’un nombre de point critique <em>k</em> dans le voisinage de cette distance.</p>
<ol type="1">
<li>L’algorithme commence par étiqueter chaque point selon l’une de ces catégories:</li>
</ol>
<ul>
<li>
<em>Noyau</em>: le point a au moins <em>k</em> points dans son voisinage, c’est-à-dire à une distance inférieure ou égale à <em>d</em>.</li>
<li>
<em>Bordure</em>: le point a moins de <em>k</em> points dans son voisinage, mais l’un de des points voisins est un <em>noyau</em>.</li>
<li>
<em>Bruit</em>: le cas échéant. Ces points sont considérés comme des outliers.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/07_dbscan_1.svg" class="img-fluid figure-img" width="600"></p>
</figure>
</div>
<ol start="2" type="1">
<li>Les noyaux distancés de <em>d</em> ou moins sont connectés entre eux en englobant les bordures.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/07_dbscan_2.svg" class="img-fluid figure-img" width="600"></p>
</figure>
</div>
<p>Le nombre de groupes est prescrit par l’algorithme DBSCAN, qui permet du coup de détecter des données trop bruitées pour être classées.</p>
<p><a href="https://doi.org/10.1145/2666310.2666417">Damiani et al.&nbsp;(2014)</a> a développé une approche utilisant la technique DBSCAN pour partitionner des zones d’escale pour les flux de populations migratoires.</p>
<section id="application-1" class="level5" data-number="10.3.2.2.1"><h5 data-number="10.3.2.2.1" class="anchored" data-anchor-id="application-1">
<span class="header-section-number">10.3.2.2.1</span> Application</h5>
<p>La technique <strong>DBSCAN</strong> n’est pas basée sur le nombre de groupe, mais sur la densité des points. L’argument <code>x</code> ne constitue pas les données, mais une matrice d’association. L’argument minPts spécifie le nombre minimal de points qui l’on doit retrouver à une distance critique d* pour la formation des *noyaux et la propagation des groupes, spécifiée dans l’argument eps. La distance d peut être estimée en prenant une fraction de la moyenne, mais on aura volontiers recours à sont bon jugement.</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/mhahsler/dbscan">"dbscan"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dbscan'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    as.dendrogram</code></pre>
</div>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mcinnes_dbscan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/dbscan.html">dbscan</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">df_mcinnes</span><span class="op">[</span>, <span class="op">]</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span>,</span>
<span>                         eps <span class="op">=</span> <span class="fl">0.03</span>, minPts <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">dbscan_group</span> <span class="op">&lt;-</span> <span class="va">mcinnes_dbscan</span><span class="op">$</span><span class="va">cluster</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dbscan_group</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 0 2 6 3 4 5</code></pre>
</div>
</div>
<p>Les paramètres spécifiés donnent 5 groupes (<code>1, 2, ..., 5</code>) et des points trop bruités pour être classifiés (étiquetés <code>0</code>). Voyons comment les groupes ont été formés.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_mcinnes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dbscan_group <span class="op">=</span> <span class="va">dbscan_group</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># ajouter une colonne de regoupement</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dbscan_group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-dbscan-mcinnes-5groupes-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le partitionnement semble plus conforme à ce que l’on recherche. Néanmoins, DBSCAN cré quelques petits groupes indésirables (groupe 6, en rose) ainsi qu’un grand groupe (violet) qui auraient lieu d’être partitionné. Ces défaut pourraient être réglés en jouant sur les paramètres <code>eps</code> et <code>minPts</code>.</p>
</section></section></section><section id="partitionnement-hiérarchique" class="level3" data-number="10.3.3"><h3 data-number="10.3.3" class="anchored" data-anchor-id="partitionnement-hiérarchique">
<span class="header-section-number">10.3.3</span> Partitionnement hiérarchique</h3>
<p>Les techniques de partitionnement hiérarchique sont basées sur les matrices d’association. La technique pour mesurer l’association (entre objets ou variables) déterminera en grande partie le partitionnement des données. Les partitionnements hiérarchiques ont l’avantage de pouvoir être représentés sous forme de dendrogramme (ou arbre) de partition. Un tel dendrogramme présente des sous-groupes qui se joignent en groupes jusqu’à former un seul ensemble.</p>
<p>Le partitionnement hiérarchique est abondamment utilisé en phylogénie, pour étudier les relations de parenté entre organismes vivants, populations d’organismes et espèces. La phénétique, branche empirique de la phylogénèse interspécifique, fait usage du partitionnement hiérarchique à partir d’associations génétiques entre unités taxonomiques. On retrouve de nombreuses ressources académiques en phylogénétique ainsi que des outils pour <a href="https://www.springer.com/us/book/9781461495413">R</a> et <a href="https://academic.oup.com/bioinformatics/article/26/12/1569/287181/DendroPy-a-Python-library-for-phylogenetic">Python</a>. Toutefois, la phylogénétique en particulier ne fait pas partie de la présente itération de ce manuel.</p>
<section id="techniques-de-partitionnement-hiérarchique" class="level4" data-number="10.3.3.1"><h4 data-number="10.3.3.1" class="anchored" data-anchor-id="techniques-de-partitionnement-hiérarchique">
<span class="header-section-number">10.3.3.1</span> Techniques de partitionnement hiérarchique</h4>
<p>Le partitionnement hiérarchique est typiquement effectué avec une des quatre méthodes suivantes, dont chacune possède ses particularités, mais sont toutes agglomératives: à chaque étape d’agglomération, on fusionne les deux groupes ayant le plus d’affinité sur la base des deux sous-groupes les plus rapprochés.</p>
<p><strong>Single link</strong> (<code>single</code>). Les groupes sont agglomérés sur la base des deux points parmi les groupes, qui sont les plus proches.</p>
<p><strong>Complete link</strong> (<code>complete</code>). À la différence de la méthode <em>single</em>, on considère comme critère d’agglomération les éléments les plus éloignés de chaque groupe.</p>
<p><strong>Agglomération centrale</strong>. Il s’agit d’une famille de méthodes basées sur les différences entre les tendances centrales des objets ou des groupes.</p>
<ul>
<li>
<strong>Average</strong> (<code>average</code>). Appelée UPGMA (Unweighted Pair-Group Method unsing Average), les groupes sont agglomérés selon un centre calculés par la moyenne et le nombre d’objet pondère l’agglomération (le poids des groupes est retiré). Cette technique est historiquement utilisée en bioinformatique pour partitionner des groupes phylogénétiques (<a href="https://www.cabdirect.org/cabdirect/abstract/19730310919">Sneath et Sokal, 1973</a>).</li>
<li>
<strong>Weighted</strong> (<code>weighted</code>). La version de average, mais non pondérée (WPGMA).</li>
<li>
<strong>Centroid</strong> (<code>centroid</code>). Tout comme average, mais le centroïde (centre géométrique) est utilisé au lieu de la moyenne. Accronyme: UPGMC.</li>
<li>
<strong>Median</strong> (<code>median</code>). Appelée WPGMC. Devinez! ;)</li>
</ul>
<p><strong>Ward</strong> (<code>ward</code>). L’optimisation vise à minimiser les sommes des carrés par regroupement.</p>
</section><section id="quel-outil-de-partitionnement-hiérarchique-utiliser" class="level4" data-number="10.3.3.2"><h4 data-number="10.3.3.2" class="anchored" data-anchor-id="quel-outil-de-partitionnement-hiérarchique-utiliser">
<span class="header-section-number">10.3.3.2</span> Quel outil de partitionnement hiérarchique utiliser?</h4>
<p>Alors que le choix de la matrice d’association dépend des données et de leur contexte, la technique de partitionnement hiérarchique peut, quant à elle, être basée sur un critère numérique. Il en existe plusieurs, mais le critère recommandé pour le choix d’une technique de partitionnement hiérarchique est la <strong>corrélation cophénétique</strong>. La distance cophénétique est la distance à laquelle deux objets ou deux sous-groupes deviennent membres d’un même groupe. La corrélation cophénétique est la corrélation de Pearson entre le vecteur d’association des objets et le vecteur de distances cophénétiques.</p>
</section><section id="application-2" class="level4" data-number="10.3.3.3"><h4 data-number="10.3.3.3" class="anchored" data-anchor-id="application-2">
<span class="header-section-number">10.3.3.3</span> Application</h4>
<p>Les techniques de partitionnement hiérarchique présentées ci-dessus sont disponibles dans le module <code>stats</code> de R, qui est chargé automatiquement lors de l’ouverture de R. Nous allons classifier les dimensions des iris grâce à la distance de Manhattan.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mcinnes_hclust_distmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">df_mcinnes</span>, method <span class="op">=</span> <span class="st">"manhattan"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clustering_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'single'</span>, <span class="st">'complete'</span>, <span class="st">'average'</span>, <span class="st">'centroid'</span>, <span class="st">'ward'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clust_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">coph_corr_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">clustering_methods</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">clust_l</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">mcinnes_hclust_distmat</span>, method <span class="op">=</span> <span class="va">clustering_methods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">coph_corr_l</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">mcinnes_hclust_distmat</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cophenetic.html">cophenetic</a></span><span class="op">(</span><span class="va">clust_l</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The "ward" method has been renamed to "ward.D"; note new "ward.D2"</code></pre>
</div>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">clustering_methods</span>, coph_corr <span class="op">=</span> <span class="va">coph_corr_l</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">clustering_methods</span>, <span class="op">-</span><span class="va">coph_corr</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">coph_corr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Méthode de partitionnement"</span>, y <span class="op">=</span> <span class="st">"Corrélation cophénétique"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-hierarch-mcinnes-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La méthode <code>average</code> retourne la corrélation la plus élevée. Pour plus de flexibilité, enchâssons le nom de la méthode dans une variable. Ainsi, en chageant le nom de cette variable, le reste du code sera conséquent.</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">clust_l</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">clustering_methods</span></span>
<span><span class="va">best_method</span> <span class="op">&lt;-</span> <span class="st">"average"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le partitionnement hiérarchique peut être visualisé par un dendrogramme.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clust_l</span><span class="op">[[</span><span class="va">best_method</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-hierarch-mcinnes-plot-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
</section><section id="combien-de-groupes-utiliser" class="level4" data-number="10.3.3.4"><h4 data-number="10.3.3.4" class="anchored" data-anchor-id="combien-de-groupes-utiliser">
<span class="header-section-number">10.3.3.4</span> Combien de groupes utiliser?</h4>
<p>La longueur des lignes verticales est la distance séparant les groupes enfants. Bien que la sélection du nombre de groupe soit avant tout basée sur les besoins du problème, nous pouvons nous appuyer sur certains outils. La hauteur totale peut servir de critère pour définir un nombre de groupes adéquat. On pourra sélectionner le nombre de groupe où la hauteur se stabilise en fonction du nombre de groupe. On pourra aussi utiliser le <em>graphique silhouette</em>, comprenant une collection de <em>largeurs de silhouette</em>, représentant le degré d’appartenance à son groupe. La fonction <code>sklearn.metrics.silhouette_score</code>, du module scikit-learn, s’en occupe.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">asw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">num_groups</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">num_groups</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">clust_l</span><span class="op">[[</span><span class="va">best_method</span><span class="op">]</span><span class="op">]</span>, k <span class="op">=</span> <span class="va">num_groups</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="va">mcinnes_hclust_distmat</span><span class="op">)</span></span>
<span>  <span class="va">asw</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">sil</span><span class="op">)</span><span class="op">$</span><span class="va">avg.width</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">num_groups</span>, <span class="va">asw</span>, type <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-hierarch-mcinnes-ngroupes-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le nombre optimal de groupes serait de 5. Coupons le dendrorgamme à la hauteur correspondant à 5 groupes avec la fonction <code>cutree</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">k_opt</span> <span class="op">&lt;-</span> <span class="va">num_groups</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">asw</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hclust_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">clust_l</span><span class="op">[[</span><span class="va">best_method</span><span class="op">]</span><span class="op">]</span>, k <span class="op">=</span> <span class="va">k_opt</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clust_l</span><span class="op">[[</span><span class="va">best_method</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/rect.hclust.html">rect.hclust</a></span><span class="op">(</span><span class="va">clust_l</span><span class="op">[[</span><span class="va">best_method</span><span class="op">]</span><span class="op">]</span>, k <span class="op">=</span> <span class="va">k_opt</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-hierarch-mcinnes-5groupes-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>La classification hiérarchique, uniquement basée sur la distance, peut être inappropriée pour définir des formes complexes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_mcinnes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hclust_group <span class="op">=</span> <span class="va">hclust_group</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># ajouter une colonne de regoupement</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">hclust_group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-hierarch-mcinnes-5groupes-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="partitionnement-hiérarchique-basée-sur-la-densité-des-points" class="level3" data-number="10.3.4"><h3 data-number="10.3.4" class="anchored" data-anchor-id="partitionnement-hiérarchique-basée-sur-la-densité-des-points">
<span class="header-section-number">10.3.4</span> Partitionnement hiérarchique basée sur la densité des points</h3>
<p>La tecchinque HDBSCAN, dont l’algorithme est relativement récent (<a href="https://link.springer.com/chapter/10.1007%2F978-3-642-37456-2_14">Campello et al., 2013</a>), permet une partitionnement hiérarchique sur le même principe des zones de densité de la technique DBSCAN. Le HDBSCAN a été utilisée pour partitionner les lieux d’escale d’oiseaux migrateurs en Chine (<a href="https://www.jstage.jst.go.jp/article/dsj/12/0/12_WDS-027/_article">Xu et al., 2013</a>).</p>
<p>Avec DBSCAN, un rayon est fixé dans une métrique appropriée. Pour chaque point, on compte le nombre de point voisins, c’est à dire le nombre de point se situant à une distance (ou une dissimilarité) égale ou inférieure au rayon fixé. Avec HDBSCAN, on spécifie le nombre de points devant être recouverts et on calcule le rayon nécessaire pour les recouvrir. Ainsi, chaque point est associé à un rayon critique que l’on nommera <span class="math inline">\(d_{noyau}\)</span>. La métrique initiale est ensuite altérée: on remplace les associations entre deux objets A et B par la valeur maximale entre cette association, le rayon critique de A et le rayon critique de B. Cette nouvelle distance est appelée la <em>distance d’atteinte mutuelle</em>: elle accentue les distances pour les points se trouvant dans des zones peu denses. On applique par la suite un algorithme semblable à la partition hiérarchique <em>single link</em>: En s’élargissant, les rayons se superposent, chaque superposition de rayon forment graduellement des groupes qui s’agglomèrent ainsi de manière hiérarchique. Au lieu d’effectuer une tranche à une hauteur donnée dans un dendrogramme de partitionnement, la technique HDBSCAN se base sur un dendrogramme condensé qui discarte les sous-groupes comprenant moins de <em>n</em> objets (<span class="math inline">\(n_{gr min}\)</span>). Dans nouveau dendrogramme, on recherche des groupes qui occupent bien l’espace d’analyse. Pour ce faire, on utilise l’inverse de la distance pour créer un indicateur de <em>persistance</em> (semblable à la similarité), <span class="math inline">\(\lambda\)</span>. Pour chaque groupe hiérarchique dans le dendrogramme condensé, on peut calculer la persistance où le groupe prend naissance. De plus, pour chaque objet d’un groupe, on peut aussi calculer une distance à laquelle il quitte le groupe. La <em>stabilité</em> d’un groupe est la somme des différences de persistance entre la persistance à la naissance et les persistances des objets. On descend dans le dendrogramme. Si la somme des stabilité des groupes enfants est plus grande que la stabilité du groupe parent, on accepte la division. Sinon, le parent forme le groupe. La <a href="http://hdbscan.readthedocs.io/en/latest/how_hdbscan_works.html">documentation du module <code>hdbscan</code></a> pour Python offre une description intuitive et plus exhaustive des principes et algorithme de HDBSCAN.</p>
<section id="paramètres" class="level4" data-number="10.3.4.1"><h4 data-number="10.3.4.1" class="anchored" data-anchor-id="paramètres">
<span class="header-section-number">10.3.4.1</span> Paramètres</h4>
<p>Outre la métrique d’association dont nous avons discuté, HDBSCAN demande d’être nourri avec <a href="https://www.rdocumentation.org/packages/dbscan/versions/1.1-3/topics/hdbscan">quelques paramètres importants</a>. En particulier, le <strong>nombre minimum d’objets par groupe</strong>, <span class="math inline">\(n_{gr min}\)</span> dépend de la quantité de données que vous avez à votre disposition, ainsi que de la quantité d’objets que vous jugez suffisante pour créer des groupes. Nous utiliserons l’implémentation de HDBSCAN du module dbscan. Si vous désirez davantage d’options, vous préférerez probablement l’<a href="https://www.rdocumentation.org/packages/largeVis/versions/0.2.1.1/topics/hdbscan">implémentation du module largeVis</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mcinnes_hdbscan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/hdbscan.html">hdbscan</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">df_mcinnes</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span>,</span>
<span>                           minPts <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                           gen_hdbscan_tree <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           gen_simplified_tree <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">hdbscan_group</span> <span class="op">&lt;-</span> <span class="va">mcinnes_hdbscan</span><span class="op">$</span><span class="va">cluster</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">hdbscan_group</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6 0 4 3 5 1 2</code></pre>
</div>
</div>
<p>Nous avons 6 groupes, numérotés de 1 à 6, ainsi que des étiquettes identifiant des objets désignés comme étant du bruit de fond, numéroté 0. Le dendrogramme non condensé peu être produit.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mcinnes_hdbscan</span><span class="op">$</span><span class="va">hdbscan_tree</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-hbdscan-mcinnes-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Difficile d’y voir clair avec autant d’objets. L’objet <code>mcinnes_hdbscan</code> a un nombre minimum d’objets par groupe de 20. Ce qui permet de présenter le dendrogramme de manière condensée.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mcinnes_hdbscan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-hbdscan-mcinnes-plot2-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Enfin, un aperçu des stratégies de partitionnement utilisés jusqu’ici.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clustering_group</span> <span class="op">&lt;-</span> <span class="va">df_mcinnes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">kmeans_group</span>,</span>
<span>         <span class="va">hclust_group</span>,</span>
<span>         <span class="va">dbscan_group</span>,</span>
<span>         <span class="va">hdbscan_group</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span>, <span class="op">-</span><span class="va">y</span>, key <span class="op">=</span> <span class="st">"method"</span>, value <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attributes are not identical across measure variables; they will be
dropped</code></pre>
</div>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clustering_group</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">clustering_group</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span>
<span><span class="va">clustering_group</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">method</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-cluster-hbdscan-mcinnes-plot3-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Clairement, le partitionnement avec HDBSCAN donne les meilleurs résultats.</p>
</section></section><section id="conclusion-sur-le-partitionnement" class="level3" data-number="10.3.5"><h3 data-number="10.3.5" class="anchored" data-anchor-id="conclusion-sur-le-partitionnement">
<span class="header-section-number">10.3.5</span> Conclusion sur le partitionnement</h3>
<p>Au <a href="04-visualisation.html">chapitre&nbsp;<span>4</span></a>, nous avons vu avec le jeu de données “datasaurus” que la visualisation peut permettre de détecter des structures en segmentant les données selon des groupes.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/07_datasaurus_mix.png" class="img-fluid figure-img" width="400"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/07_datasaurus_facet.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Or, si les données n’étaient pas étiquetées, leur structure serait indétectable avec les algorithmes disponibles actuellement. Le partitionnement permet d’explorer des données, de détecter des tendances et de dégager des groupes permettant la prise de décision.</p>
<p>Plusieurs techniques de partitionnement ont été présentées. Le choix de la technique sera déterminante sur la manière dont les groupes seront partitionnés. La définition d’un groupe variant d’un cas à l’autre, il n’existe pas de règle pour prescrire une méthode ou une autre. La partitionnement hiérarchique a l’avantage de permettre de visualiser comment les groupes s’agglomèrent. Parmi les méthodes de partitionnement hiérarchique disponibles, les méthodes basées sur la densité permettent une grande flexibilité, ainsi qu’une détection d’observations ne faisant partie d’aucun groupe.</p>
</section></section><section id="ordination" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="ordination">
<span class="header-section-number">10.4</span> Ordination</h2>
<p>En écologie, biologie, agronomie comme en foresterie, la plupart des tableaux de données comprennent de nombreuses variables: pH, nutriments, climat, espèces ou cultivars, etc. L’ordination vise à mettre de l’ordre dans des données dont le nombre élevé de variables peut amener à des difficultés d’appréciation et d’interprétation (<a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Legendre et Legendre, 2012</a>). Plus précisément, le terme ordination est utilisé en écologie pour désigner les techniques de réduction d’axe. L’analyse en composante principale est probablement la plus connue de ces techniques. Mais de nombreuses techniques d’ordination ont été développées au cours des dernières années, chacune ayant ses domaines d’application.</p>
<p>Les techniques de réduction d’axe permettent de dégager l’information la plus importante en projetant une synthèse des relations entre les observations et entre les variables. Les techniques ne supposant aucune structure <em>a priori</em> sont dites <em>non-contraignantes</em>: elles ne comprennent pas de tests statistiques. À l’inverse, les ordinations contraignantes lient des variables descriptives avec une ou plusieurs variables prédictives.</p>
<p>La référence en la matière est indiscutablement (<a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Legendre et Legendre, 2012</a>). Cette section en couvrira quelques unes et vous guidera vers la technique la plus appropriée pour vos données.</p>
<section id="ordination-non-contraignante" class="level3" data-number="10.4.1"><h3 data-number="10.4.1" class="anchored" data-anchor-id="ordination-non-contraignante">
<span class="header-section-number">10.4.1</span> Ordination non contraignante</h3>
<p>Cette section couvrira l’<strong>analyse en composantes principales</strong> (ACP), l’<strong>analyse de correspondance</strong> (AC), <strong>l’analyse factorielle</strong> (AF) ainsi que l’<strong>analyse en coordonnées principales</strong> (ACoP).</p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead><tr class="header">
<th>Méthode</th>
<th>Distance préservée</th>
<th>Variables</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Analyse en composantes principales (ACP)</td>
<td>Distance euclidienne</td>
<td>Données quantitatives, relations linéaires (attention aux double-zéros)</td>
</tr>
<tr class="even">
<td>Analyse de correspondance (AC)</td>
<td>Distance de <span class="math inline">\(\chi^2\)</span>
</td>
<td>Données non-négatives, dimentionnellement homogènes ou binaires, abondance ou occurrence</td>
</tr>
<tr class="odd">
<td>Positionnement multidimensionnel (PoMd)</td>
<td>Toute mesure de dissimilarité</td>
<td>Données quantitatives, qualitatives nominales/ordinales ou mixtes</td>
</tr>
</tbody>
</table>
<p>Source: Adapté de (<a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Legendre et Legendre, 2012</a>, chapitre 9)</p>
<section id="analyse-en-composantes-principales" class="level4" data-number="10.4.1.1"><h4 data-number="10.4.1.1" class="anchored" data-anchor-id="analyse-en-composantes-principales">
<span class="header-section-number">10.4.1.1</span> Analyse en composantes principales</h4>
<p>L’objectif d’une ACP est de représenter les données dans un nombre réduit de dimensions représentant le plus possible la variation d’un tableau de données: elle permet de projeter les données dans un espace où les variables sont combinées en axes orthogonaux dont le premier axe capte le maximum de variance. L’ACP peut par exemple être utilisée pour analyser des corrélations entre variables ou dégager l’information la plus pertinente d’un tableau de données météo ou de signal en un nombre plus retreint de variables.</p>
<p>L’ACP effectue une rotation des axes à partir du centre (moyenne) du nuage de points effectuée de manière à ce que le premier axe définisse la direction où l’on retrouve la variance maximale. Ce premier axe est une combinaison linéaire des variables et forme la première composante principale. Une fois cet axe définit, on trouve de deuxième axe, orthogonal au premier, où l’on retrouve la variance maximale - cet axe forme la deuxième composante principale, et ainsi de suite jusqu’à ce que le nombre d’axe corresponde au nombre de variables. Les projections des observations sur ces axes principaux sont appelés les <strong>scores</strong>. Les projections des variables sur les axes principaux sont les <strong>vecteurs propres</strong> (<em>eigenvectors</em>, ou <em>loadings</em>). La variance des composantes principales diminue de la première à la dernière, et peut être calculée comme une proportion de la variance totale: c’est le <strong>pourcentage d’inertie</strong>. Par convention, on utilise les <strong>valeurs propres</strong> (<em>eigenvalues</em>) pour mesurer l’importance des axes. Si la première composante principale a une inertie de 50% et la deuxième a une inertie de 30%, la représentation en 2D des projection représentera 80% de la variance du nuage de points.</p>
<p>L’hétérogénéité des échelles de mesure peut avoir une grande importance sur les résultats d’une ACP (les données doivent être dimensionnellement homogènes). En effet, la hauteur d’un ceriser aura une variance plus grande que le diamètre d’une cerise exprimé dans les mêmes unités, et cette dernière aura plus de variance que la teneur en cuivre d’une feuille. Il est conséquemment avisé de mettre les données à l’échelle en centrant la moyenne à zéro et l’écart-type à 1 avant de procéder à une ACP.</p>
<p>L’ACP a été conçue pour projeter en un nombre moindre de dimensions des observations dont les distributions sont multinormales. Bien que l’ACP soit une technique robuste, il est préférable de transformer préalablement les variables dont la distribution est particulièrement asymétriques (<a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Legendre et Legendre, 2012, p.&nbsp;450</a>). Le cas échéant, les valeurs extrêmes pourraient faire dévier les vecteurs propres et biaiser l’analyse. En particulier, les données ACP menées sur des données compositionnelles sont réputées pour générer des analyses biaisées (<a href="http://sp.lyellcollection.org/content/specpubgsl/264/1/1.full.pdf">Pawlowsky-Glahn and Egozcue, 2006</a>). Le test de Mardia (<a href="https://journal.r-project.org/archive/2014-2/korkmaz-goksuluk-zararsiz.pdf">Korkmaz, 2014</a>) peut être utilisé pour tester la multinormalité. Une distribution multinormale devrait générer des scores en forme d’hypersphère (en forme de cercle sur un biplot: voir plus loin).</p>
<section id="vecteurs-propres-et-valeurs-propres" class="level5" data-number="10.4.1.1.1"><h5 data-number="10.4.1.1.1" class="anchored" data-anchor-id="vecteurs-propres-et-valeurs-propres">
<span class="header-section-number">10.4.1.1.1</span> Vecteurs propres et valeurs propres</h5>
<p>Une matrice carrée (comme une matrice de covariance <span class="math inline">\(\Sigma\)</span>) multipliée par un vecteur propre <span class="math inline">\(e\)</span> est égale aux valeurs propres <span class="math inline">\(\lambda\)</span> multipliées par les vecteurs propres <span class="math inline">\(e\)</span>.</p>
<p><span class="math display">\[ \Sigma e = \lambda e \]</span></p>
<p>De manière intuitive, les vecteurs propres indiquent l’orientation de la covariance, et les valeurs propres indique la longueur associée à cette direction. L’ACP est basée sur le calcul des vecteurs propres et des valeurs propres de la matrice de covariance des variables. Pour d’abord obtenir les valeurs propres <span class="math inline">\(\lambda\)</span>, il faut résoudre l’équation</p>
<p><span class="math display">\[ det(cov(X) - \lambda I) = 0 \]</span>,</p>
<p>où <span class="math inline">\(det\)</span> est l’opération permettant de calculer le déterminant, <span class="math inline">\(cov\)</span> est l’opération pour calculer la covariance, <span class="math inline">\(X\)</span> est la matrice de données, <span class="math inline">\(\lambda\)</span> sont les valeurs propres et <span class="math inline">\(I\)</span> est une matrice d’identité.</p>
<p>Pour <span class="math inline">\(p\)</span> variables dans votre tableau <span class="math inline">\(X\)</span>, vous obtiendrex <span class="math inline">\(p\)</span> valeurs propres. Ensuite, on trouve les vecteurs propres en résolvant l’équation $ e = e $.</p>
<p>Bien qu’il soit possible d’<a href="https://www.youtube.com/watch?v=2fCBE7DWgd0&amp;list=PLBv09BD7ez_5_yapAg86Od6JeeypkS4YM">effectuer cette opération à la main</a> pour des cas très simples, vous aurez avantage à utiliser un langage de programmation.</p>
<p>Chargeons les données d’iris, puis isolons seulement les deux dimensions des sépales l’espèce <em>setosa</em>.</p>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span></span>
<span><span class="va">setosa_sepal</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Sepal"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">setosa_sepal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Sepal.Length Sepal.Width
1           5.1         3.5
2           4.9         3.0
3           4.7         3.2
4           4.6         3.1
5           5.0         3.6
6           5.4         3.9
7           4.6         3.4
8           5.0         3.4
9           4.4         2.9
10          4.9         3.1
11          5.4         3.7
12          4.8         3.4
13          4.8         3.0
14          4.3         3.0
15          5.8         4.0
16          5.7         4.4
17          5.4         3.9
18          5.1         3.5
19          5.7         3.8
20          5.1         3.8
21          5.4         3.4
22          5.1         3.7
23          4.6         3.6
24          5.1         3.3
25          4.8         3.4
26          5.0         3.0
27          5.0         3.4
28          5.2         3.5
29          5.2         3.4
30          4.7         3.2
31          4.8         3.1
32          5.4         3.4
33          5.2         4.1
34          5.5         4.2
35          4.9         3.1
36          5.0         3.2
37          5.5         3.5
38          4.9         3.6
39          4.4         3.0
40          5.1         3.4
41          5.0         3.5
42          4.5         2.3
43          4.4         3.2
44          5.0         3.5
45          5.1         3.8
46          4.8         3.0
47          5.1         3.8
48          4.6         3.2
49          5.3         3.7
50          5.0         3.3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"MVN"</span><span class="op">)</span></span>
<span><span class="va">setosa_sepal_mvn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MVN/man/mvn.html">mvn</a></span><span class="op">(</span><span class="va">setosa_sepal</span>, mvnTest <span class="op">=</span> <span class="st">"mardia"</span><span class="op">)</span></span>
<span><span class="va">setosa_sepal_mvn</span><span class="op">$</span><span class="va">multivariateNormality</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Test          Statistic           p value Result
1 Mardia Skewness  0.759503524380438 0.943793240544741    YES
2 Mardia Kurtosis 0.0934600553610254 0.925538081956867    YES
3             MVN               &lt;NA&gt;              &lt;NA&gt;    YES</code></pre>
</div>
</div>
<p>Pour considérer la distribution comme multinormale, la p-value de la distortion (<code>Mardia Skewness</code>) <strong>et</strong> la statistique de Kurtosis (<code>Mardia Kurtosis</code>) doit être égale ou plus élevée que 0.05 (<a href="https://www.rdocumentation.org/packages/MVN/versions/5.6/topics/mvn">Kormaz, 2019, fiche d’aide de la fonction <code>mvn</code> de R</a>). C’est bien le cas pour les données du tableau <code>setosa_sepal</code>.</p>
<p>Retirons de la matrice de covariance les valeurs et vecteurs propres avec la fonction <code>eigen</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">setosa_eigen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">setosa_sepal</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">setosa_eigenval</span> <span class="op">&lt;-</span> <span class="va">setosa_eigen</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="va">setosa_eigenvec</span> <span class="op">&lt;-</span> <span class="va">setosa_eigen</span><span class="op">$</span><span class="va">vectors</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le premier vecteur propre correspond à la première colonne, et le second à la deuxième. Les coordonnées x et y sont les premières et deuxièmes lignes. Les vecteurs propres ont une longueur unitaire (norme de 1). Ils peuvent être mis à l’échelles à la racine carrée des valeurs propres.</p>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">setosa_eigenvec_sc</span> <span class="op">&lt;-</span> <span class="va">setosa_eigenvec</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">setosa_eigen</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour effectuer une translation des vecteurs propres au centre du nuage de point, nous avons besoin du centroïde.</p>
<div class="cell">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">centroid</span> <span class="op">&lt;-</span> <span class="va">setosa_sepal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">setosa_sepal</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># vecteurs propres brutes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">setosa_eigenvec</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">setosa_eigenvec</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"green"</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># vecteur propre 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">setosa_eigenvec</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">setosa_eigenvec</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"green"</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># vecteur propre 1</span></span>
<span></span>
<span><span class="co"># vecteurs propres à l'échelle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">setosa_eigenvec_sc</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">setosa_eigenvec_sc</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="co"># vecteur propre 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">setosa_eigenvec_sc</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">setosa_eigenvec_sc</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="co"># vecteur propre 1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">centroid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y<span class="op">=</span><span class="va">centroid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">2</span>, col  <span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="co"># centroid</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-iris-sepal-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On peut observer que, comme je l’ai mentionné plus haut, <strong>les vecteurs propres indiquent l’orientation de la covariance, et les valeurs propres indique la longueur associée à cette direction</strong>.</p>
</section><section id="biplot" class="level5" data-number="10.4.1.1.2"><h5 data-number="10.4.1.1.2" class="anchored" data-anchor-id="biplot">
<span class="header-section-number">10.4.1.1.2</span> Biplot</h5>
<p>Imaginez un nuage de points en 3D, axes y compris. Vous tournez votre nuage de points pour trouver la perspective en 2D qui fera en sorte que vos données soient les plus dispersées possibles. Avec une lampe de poche, vous illuminez votre nuage de points dans l’axe de cette perspective: vous venez d’effectuer une analyse en composantes principales, et l’ombre des points et des axes sur le mur formera votre biplot.</p>
<p>Pour créer un biplot, on juxtapose les descripteurs (variables) en tant que vecteurs propres, représentés par des flèches, et les objets (observations) en tant que scores, représentés par des points. Les résultats d’une ordination peuvent être présentés selon deux types de biplots (<a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Legendre et Legendre, 2012</a>).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/07_biplot-meteo-sc2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
<center>
Biplot de corrélation permettant de visualiser les corrélations entre des variables météorologiques.
</center>
<p>Deux types de projection sont couramment utilisés.</p>
<p><strong>Biplot de distance</strong>. Ce type de projection permet de visualiser la position des objets entre eux et par rapport aux descripteurs et d’apprécier la contribution des descripteurs pour créer les composantes principales. Pour créer un biplot de distance, on projette directement les vecteurs propres (<span class="math inline">\(U\)</span>) en guise de descripteurs. Pour ce qui est des objets, on utilise les scores de l’ACP (<span class="math inline">\(F\)</span>). De cette manière,</p>
<ol type="1">
<li>les distances euclidiennes entre les scores sont des approximations des distances euclidiennes dans l’espace multidimensionnel,</li>
<li>la projection d’un objet sur un descripteur perpendiculairement à ce dernier est une approximation de la position de l’objet sur le descripteur et</li>
<li>la projection d’un descripteur sur un axe principal est proportionnelle à sa contribution pour générer l’axe.</li>
</ol>
<p><strong>Biplot de corrélation</strong>. Cette projection permet d’apprécier les corrélations entre les descripteurs. Pour ce faire, les objets et les valeurs propres doivent être transformés. Pour générer les descripteurs, les vecteurs propres (<span class="math inline">\(U\)</span>) doivent être multipliés par la matrice diagonalisée de la racine carrée des valeurs propres (<span class="math inline">\(\Lambda\)</span>), c’est-à-dire <span class="math inline">\(U \Lambda ^{\frac{1}{2}}\)</span>. En ce qui a trait aux objets, on multiplie les scores par (<span class="math inline">\(F\)</span>) par la racine carrée négative des valeurs propres diagonalisées, c’est-à-dire <span class="math inline">\(F \Lambda ^{- \frac{1}{2}}\)</span>. De cette manière,</p>
<ol type="1">
<li>tout comme c’est le cas pour le biplot de distance, la projection d’un objet sur un descripteur perpendiculairement à ce dernier est une approximation de la position de l’objet sur le descripteur,</li>
<li>la projection d’un descripteur sur un axe principal est proportionnelle à son écart-type et</li>
<li>les <strong>angles</strong> entre les descripteurs sont proportionnelles à leur corrélation (et non pas leur proximité).</li>
</ol>
<p>En d’autres mots, le bilot de distances devrait être utilisé pour apprécier la distance entre les objets et le biplot de corrélation devrait être utilisé pour apprécier les corrélations entre les descripteurs. Mais dans tous les cas, <strong>le type de biplot utilisé doit être indiqué</strong>.</p>
<p>Le <em>triplot</em> est une forme apparentée au biplot, auquel on ajoute des variables prédictives. Le triplot est utile pour représenter les résultats des ordinations contraignantes comme les analyses de redondance et les analyse de correspondance canoniques.</p>
</section><section id="application-3" class="level5" data-number="10.4.1.1.3"><h5 data-number="10.4.1.1.3" class="anchored" data-anchor-id="application-3">
<span class="header-section-number">10.4.1.1.3</span> Application</h5>
<p>Bien que l’ACP puisse être effectuée grâce à des modules de base de R, nous utiliserons le module vegan. Le tableau <a href="https://rdrr.io/rforge/vegan/man/varechem.html"><code>varechem</code></a> comprend des données issues d’analyse de sols identifiés par leur composition chimique, leur pH, leur profondeur totale et la profondeur de l’humus publiées dans <a href="http://onlinelibrary.wiley.com/doi/10.2307/3236351/abstract">Väre et al.&nbsp;(1995)</a> et exportées du module <a href="https://rdrr.io/rforge/vegan/">vegan</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/vegandevs/vegan">"vegan"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"varechem"</span><span class="op">)</span></span>
<span><span class="va">varechem</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      N    P     K    Ca    Mg    S    Al   Fe    Mn   Zn  Mo Baresoil Humdepth
27 20.6 60.8 233.7 834.0 127.2 40.7  15.4  4.4 132.0 10.7 0.2     18.7      2.9
28 29.8 73.5 260.0 748.6 105.3 42.5  17.9  2.4 106.6  9.3 0.3     17.6      3.0
18 19.8 42.1 139.9 519.4  90.0 32.3  39.0 40.9  58.1  4.5 0.3     43.9      2.2
5  33.1 22.7  43.6 240.3  25.7 14.9  39.0  8.4  26.8  8.4 0.2      8.1      1.0
6  19.1 26.4  61.1 259.1  37.0 21.4 155.1 81.4  20.6  4.0 0.6      5.8      1.9
    pH
27 2.8
28 2.8
18 2.7
5  3.1
6  3.0</code></pre>
</div>
</div>
<p>Comme nous l’avons vu précedemment, les données de concentration sont de type <em>compositionnelles</em>. Les données compositionnelles du tableau <code>varechem</code> mériteraient d’être transformées (<a href="http://doi.wiley.com/10.1111/1467-9876.00275">Aitchison et Greenacre, 2002</a>). Utilisons les log-ratios centrés (<em>clr</em>).</p>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://www.stat.boogaart.de/compositions/">"compositions"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to compositions, a package for compositional data analysis.
Find an intro with "? compositions"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'compositions'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    anova, cor, cov, dist, var</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    segments</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    %*%, norm, scale, scale.default</code></pre>
</div>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">varecomp</span> <span class="op">&lt;-</span> <span class="va">varechem</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Baresoil</span>, <span class="op">-</span><span class="va">Humdepth</span>, <span class="op">-</span><span class="va">pH</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Fv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1e6</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vareclr</span> <span class="op">&lt;-</span> <span class="va">varecomp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/acomp.html">acomp</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/clr.html">clr</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">varechem</span> <span class="op">|&gt;</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="va">Baresoil</span>, <span class="va">Humdepth</span>, <span class="va">pH</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vareclr</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 15
      N      P     K    Ca      Mg      S    Al     Fe     Mn    Zn    Mo    Fv
* &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 -1.88 -0.600 0.641  1.48 -0.684  -0.805 1.30  -0.156 -1.14  -2.52 -4.68  9.04
2 -1.69 -0.624 0.830  1.59 -0.0312 -0.729 0.189 -0.626 -0.331 -2.60 -5.49  9.53
3 -1.76 -0.553 0.565  2.11  0.575  -0.706 0.159 -1.20  -1.30  -1.95 -4.99  9.05
4 -1.78 -0.613 0.354  1.72 -0.174  -0.645 0.932 -1.02  -0.935 -2.31 -4.85  9.32
5 -1.34 -0.760 0.673  2.07  0.549  -0.762 0.181 -1.60  -0.696 -2.26 -5.39  9.34
# ℹ 3 more variables: Baresoil &lt;dbl&gt;, Humdepth &lt;dbl&gt;, pH &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Effectuons l’ACP. Pour cet exemple, nous standardiserons les données étant données que les colonnes Baresoil, Humedepth et pH ne sont pas à la même échelle que les colonnes des clr.</p>
<div class="cell">
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vareclr_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/scale.html">scale</a></span><span class="op">(</span><span class="va">vareclr</span><span class="op">)</span></span>
<span><span class="va">vare_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/cca.html">rda</a></span><span class="op">(</span><span class="va">vareclr_sc</span><span class="op">)</span> <span class="co"># ou bien rda(vareclr, scale = TRUE, mais la mise à l'échelle préalable est plus explicite)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>L’objet <code>vareclr_pca</code> contient l’information nécessaire pour mener notre ACP.</p>
<div class="cell">
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">vare_pca</span>, scaling <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># scaling = 2 pour obtenir les infos pour les biplots de corrélation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
rda(X = vareclr_sc) 

Partitioning of variance:
              Inertia Proportion
Total              15          1
Unconstrained      15          1

Eigenvalues, and their contribution to the variance 

Importance of components:
                         PC1    PC2    PC3     PC4     PC5     PC6     PC7
Eigenvalue            7.1523 2.4763 2.1122 0.93015 0.57977 0.48786 0.36646
Proportion Explained  0.4768 0.1651 0.1408 0.06201 0.03865 0.03252 0.02443
Cumulative Proportion 0.4768 0.6419 0.7827 0.84473 0.88338 0.91590 0.94034
                          PC8     PC9    PC10     PC11     PC12     PC13
Eigenvalue            0.29432 0.19686 0.15434 0.107357 0.095635 0.042245
Proportion Explained  0.01962 0.01312 0.01029 0.007157 0.006376 0.002816
Cumulative Proportion 0.95996 0.97308 0.98337 0.990527 0.996902 0.999719
                           PC14
Eigenvalue            0.0042200
Proportion Explained  0.0002813
Cumulative Proportion 1.0000000

Scaling 2 for species and site scores
* Species are scaled proportional to eigenvalues
* Sites are unscaled: weighted dispersion equal on all dimensions
* General scaling constant of scores:  4.309777 


Species scores

             PC1     PC2     PC3      PC4        PC5       PC6
N         0.1437  0.7606 -0.6792  0.19837  0.1128526 -0.050149
P         0.8670 -0.3214 -0.2950 -0.22940  0.1437960 -0.042884
K         0.9122 -0.3857  0.2357  0.03469  0.2737020  0.075717
Ca        0.9649 -0.3362 -0.2147  0.17757 -0.2188717  0.008051
Mg        0.8263 -0.2723  0.1035  0.52135 -0.1495399 -0.342214
S         0.8825 -0.3169  0.3539 -0.21216  0.1176279 -0.191386
Al       -1.0105 -0.2442  0.2146  0.02674 -0.1005560 -0.043569
Fe       -1.0338 -0.2464  0.1492  0.13162  0.1512218  0.081571
Mn        0.9556  0.1041 -0.1256 -0.21300  0.2565831  0.275275
Zn        0.7763 -0.1031 -0.3123 -0.36493 -0.5665691  0.153089
Mo       -0.2152  0.8717  0.4065 -0.33643 -0.2134335 -0.167725
Fv        0.2360  0.5776 -0.8112  0.12736  0.1280097 -0.109737
Baresoil  0.5147  0.4210  0.4472  0.54980 -0.1438570  0.463148
Humdepth  0.7455  0.4379  0.5194  0.16493  0.0004757 -0.273056
pH       -0.5754 -0.5864 -0.5957  0.23408 -0.1517661 -0.056641


Site scores (weighted sums of species scores)

        PC1       PC2      PC3      PC4      PC5      PC6
18  0.16862  0.423777  0.46731  0.91175  1.10380  1.06421
15 -0.09705 -0.097482  0.61143 -0.29049  1.14916  0.40622
24  0.02831 -0.795737  0.74176 -0.19097 -2.43337 -0.81762
27  1.39081 -0.354376 -0.19377 -0.45160  0.46020 -0.31446
23  1.30346  0.357866  0.29887  0.76856  0.20913 -0.64145
19  0.43636  0.495037  1.21722  1.18128 -0.98242 -0.74474
22  1.07306  0.467575 -0.32245  0.03717  0.13956 -0.64972
16  0.02545  0.659714 -0.28861 -0.01424  0.47105  0.45173
28  1.42005  0.007356 -0.29000 -0.78474  0.97592 -0.80263
13 -0.50638 -0.220909  1.52981  0.26289  0.42135  0.94054
14  0.45392  0.649297  0.44573 -0.26620 -0.74522 -0.53228
20  0.18623  0.259640  0.89112  0.21096 -0.51393  2.24361
25  1.26264  0.225744 -0.96668 -0.69334  0.61990  0.43312
7  -1.48685  0.739545 -0.20926  1.09256  0.61856 -0.87999
5  -0.50622  1.108685 -2.61287 -1.00433 -1.35383  1.21964
6  -1.28653  0.898663 -0.38778 -0.47556 -0.02449 -0.29419
3  -1.72773  0.476962 -0.48878  0.71156  1.06398 -1.33473
4  -0.82844 -0.296515  1.20315 -1.49821 -0.18330  1.05231
2  -1.00247 -0.609253  0.25185 -0.85420  0.71031  0.14854
9  -0.43405 -0.338912  0.55348 -1.35776 -0.81986 -1.02468
12 -0.05083  0.122645 -0.04611 -0.56047 -0.26151 -0.98053
10  0.17891 -2.315489 -0.69084 -0.19547  0.80628  0.04291
11 -0.46443 -2.592018 -1.21615  1.56359 -0.62334  0.28748
21  0.46316  0.728185 -0.49843  1.89726 -0.80791  0.72671</code></pre>
</div>
</div>
<p>La deuxième ligne de <code>Importance of components</code>, <code>Proportion Explained</code>, indique la proportion de la variance totale captée successivement par les axes principaux. Le premier axe principal comporte 47.68% de la variance. Le deuxième axe principal ajoutant une proportion de 16,51%, une représentation en deux axes principaux présentent 64.19 % de la variance.</p>
<div class="cell">
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prop_expl</span> <span class="op">&lt;-</span> <span class="va">vare_pca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">vare_pca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span></span>
<span><span class="va">prop_expl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         PC1          PC2          PC3          PC4          PC5          PC6 
0.4768180610 0.1650859388 0.1408156459 0.0620101490 0.0386511040 0.0325238535 
         PC7          PC8          PC9         PC10         PC11         PC12 
0.0244303815 0.0196215021 0.0131238464 0.0102890284 0.0071571089 0.0063756951 
        PC13         PC14 
0.0028163495 0.0002813359 </code></pre>
</div>
</div>
<p>La décision du nombre d’axes principaux à retenir est arbitraire. Elle peut dépendre d’un nombre maximal de paramètre à retenir pour éviter de surdimensionner un modèle (<em>curse of dimensionality</em>, section 11) ou d’un seuil de pourcentage de variance minimal à retenir, par exemple 75%. Ou bien, vous retiendrez deux composantes principales si vous désirez présenter un seul biplot.</p>
<p>L’approche de <em>Kaiser-Guttmann</em> (<a href="http://www.springer.com/us/book/9781441979759">Borcard et al., 2011</a>) consiste à sélectionner les composantes principales dont la valeur propre est supérieure à leur moyenne.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vare_pca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span>,</span>
<span>     y <span class="op">=</span> <span class="va">vare_pca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Rang de la valeur propre"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Valeur propre"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vare_pca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-varechem-pca-kaiser-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>L’approche du <em>broken stick</em> consiste à couper un bâton d’une longueur de 1 en n tranches. La première tranche est de longueur <span class="math inline">\(\frac{1}{n}\)</span>. La tranche suivante est d’une longueur de la tranche précédente à laquelle on aditionne <span class="math inline">\(\frac{1}{longueur~restante}\)</span>. Puis on place les longueurs en ordre décroissant. On retient les composantes principales dont les valeurs propres cumulées sont plus grandes que le broken stick.</p>
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">broken_stick</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bsm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"numeric"</span>, length <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">bsm</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">x</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">bsm</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">bsm</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="fl">1</span><span class="op">-</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">bsm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">bsm</span><span class="op">/</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">bsm</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le graphique du <em>broken stick</em>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vare_pca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span>,</span>
<span>     y <span class="op">=</span> <span class="va">prop_expl</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Rang de la valeur propre"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Valeur propre"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vare_pca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu">broken_stick</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vare_pca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>      lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-varechem-pca-bs-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Les approches <em>Kaiser-Guttmann</em> et <em>broken stick</em> suggèrent que les trois premières composantes sont suffisantes pour décrire la dispersion des données.</p>
<p>Examinons les <em>loadings</em> (vecteurs propres) plus en particulier. Dans le langage du module vegan, les vecteurs propres sont les espèces (<code>species</code>) et les scores sont les <code>sites</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vare_eigenvec</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/scores.html">scores</a></span><span class="op">(</span><span class="va">vare_pca</span>, scaling <span class="op">=</span> <span class="fl">2</span>, display <span class="op">=</span> <span class="st">"species"</span>, choices <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">vareclr</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vare_eigenvec</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                PC1        PC2        PC3        PC4           PC5          PC6
N         0.1437343  0.7606006 -0.6792046  0.1983670  0.1128526122 -0.050148980
P         0.8669892 -0.3213683 -0.2949864 -0.2294036  0.1437959857 -0.042883754
K         0.9122089 -0.3857245  0.2356904  0.0346904  0.2737019601  0.075717162
Ca        0.9648855 -0.3361651 -0.2147486  0.1775746 -0.2188716732  0.008050762
Mg        0.8263327 -0.2723055  0.1035276  0.5213484 -0.1495399242 -0.342213793
S         0.8824519 -0.3169039  0.3538854 -0.2121562  0.1176278503 -0.191386377
Al       -1.0105173 -0.2441785  0.2145614  0.0267422 -0.1005559874 -0.043569364
Fe       -1.0337676 -0.2463987  0.1491865  0.1316173  0.1512218115  0.081571443
Mn        0.9555632  0.1041030 -0.1256178 -0.2130047  0.2565830557  0.275275174
Zn        0.7763480 -0.1030878 -0.3122919 -0.3649341 -0.5665691228  0.153089144
Mo       -0.2152399  0.8717229  0.4064967 -0.3364279 -0.2134335302 -0.167725160
Fv        0.2360040  0.5775863 -0.8111953  0.1273582  0.1280096553 -0.109737235
Baresoil  0.5147445  0.4209983  0.4472351  0.5497950 -0.1438569673  0.463148072
Humdepth  0.7455213  0.4379436  0.5193895  0.1649306  0.0004756685 -0.273056212
pH       -0.5753858 -0.5863743 -0.5957495  0.2340826 -0.1517660977 -0.056640816
                 PC7         PC8          PC9        PC10         PC11
N        -0.09111164 -0.06122008  0.315645453  0.08090232  0.019251478
P         0.26894062  0.34111276  0.021124287  0.08756299  0.045741546
K        -0.21662612 -0.01641260  0.143099440 -0.08737113 -0.183005607
Ca        0.03630015  0.04775616 -0.073609828 -0.10601799 -0.161460554
Mg        0.04617838 -0.12098602 -0.051599273  0.18373857  0.009862571
S        -0.26825994  0.15822845  0.038378858  0.05100717  0.138785063
Al       -0.22737412  0.10598673  0.040586196 -0.14473132  0.089462074
Fe        0.10553041 -0.09254655 -0.079426433  0.09908706  0.006376211
Mn        0.20224538 -0.19347804 -0.038859808 -0.07637994  0.083300112
Zn       -0.12332232 -0.14862229  0.024026151  0.02643462  0.064973307
Mo        0.13788948  0.17165900  0.032981311  0.01419924 -0.128814989
Fv       -0.20911147  0.11289753 -0.281443886 -0.08391004  0.012456867
Baresoil -0.02103009  0.23028292  0.004554036  0.02604286  0.061147847
Humdepth  0.17061078 -0.11310394  0.027515405 -0.23068827  0.102189307
pH        0.19890884  0.12152266  0.150118818 -0.15240317  0.037691048
                 PC12        PC13         PC14
N         0.045420621 -0.05020956  0.002340519
P         0.145128883  0.03337551 -0.010109130
K         0.002260341  0.10566808  0.001169065
Ca        0.041210064 -0.14341793  0.007419161
Mg       -0.063493608  0.03782662 -0.023575986
S        -0.117144869 -0.06075094  0.025874035
Al        0.058212507 -0.01983102 -0.037901576
Fe        0.049837173  0.01169516  0.036048221
Mn       -0.133353213 -0.02679781 -0.021373612
Zn        0.051057277  0.06538348  0.010896560
Mo       -0.114803631  0.01989539 -0.001335923
Fv       -0.020157331  0.05448619  0.005707928
Baresoil -0.019696758  0.01640490  0.003823725
Humdepth  0.109293684  0.02485030  0.016559206
pH       -0.153813168  0.04523353  0.014193061
attr(,"const")
[1] 4.309777</code></pre>
</div>
</div>
<p>L’ordre d’importance des vecteurs propres est établi en ordre croissant des élément des vecteurs propres associées. Un vecteur propre est une combinaison linéaire des variables. Par exemple, le premier vecteur propre pointe surtout dans la direction du Fe (-1.497) et de l’Al (-1.463). Le deuxième pointe surtout vers le Mo (2.145). Les vecteurs (<em>loadings</em>) d’un biplot de distance présentant les des deux premières composantes principales prendront les coordonnées des deux premières colonnes. Le vecteur Al aura la coordonnée [-1.463 ; -0.601], le vecteur de Fe sera placé à [-1.497 ; -0.606] et le vecteur Mo à [-0.312 ; 2.145]. Il existe différentes fonctions d’affichage des biplots. Notez que leur longueur peut être magnifiée pour améliorer la visualisation.</p>
<p>Lançons la fonction <code>biplot</code> pour créer un biplot de distance et un autre de corrélation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/biplot.html">biplot</a></span><span class="op">(</span><span class="va">vare_pca</span>, scaling <span class="op">=</span> <span class="fl">1</span>, main <span class="op">=</span> <span class="st">"Biplot de distance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/biplot.html">biplot</a></span><span class="op">(</span><span class="va">vare_pca</span>, scaling <span class="op">=</span> <span class="fl">2</span>, main <span class="op">=</span> <span class="st">"Biplot de corrélation"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-varechem-pca-biplots-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le biplot de distance permet de dégager les variables qui expliquent davantage la variabilité dans notre tableau: les clr du Fe et de l’Al forment en grande partie le premier axe principal, alors que le clr du Mo forme en grande partie le second axe. Le biplot de corrélation montre que les clr du Fe et du Al sont corrélés dans le même sens, mais das le sens contraire du clr du Mn. L’information sur la teneur en Fe et celle de l’Al est en grande partie redondante. Toutefois, le clr du Mo est presque indépendant du clr du Fe, ceux-ci étant à angle presque droit (~90°). Ces relations peuvent être explorées directement.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vareclr</span><span class="op">$</span><span class="va">Al</span>, <span class="va">vareclr</span><span class="op">$</span><span class="va">Fe</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vareclr</span><span class="op">$</span><span class="va">Mo</span>, <span class="va">vareclr</span><span class="op">$</span><span class="va">Fe</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-varechem-pca-al-fe-mo-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Nous avons mentionné que l’ACP est une rotation. Prenons un second exemple pour bien en saisir les tenants et aboutissants. Le tableau de données que nous chargerons provient d’un infographie d’un dauphin, intitullée <em>Bottlenose Dolphin</em>, conçu par l’artiste <a href="https://www.blendswap.com/blends/view/83681">Tarnyloo</a>. Les points correspondent à la surface d’un dauphin. J’ai ajouté une colonne <code>anatomy</code>, qui indique à quelle partie anatomique le point appartient.</p>
<div class="cell">
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dolphin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/07_dolphin.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 12969 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): anatomy
dbl (3): x, y, z

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dolphin</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
        x      y       z anatomy   
    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     
1  0.0762 -0.521 -0.0803 Head      
2  0.472   1.00   1.28   Caudal fin
3 -0.172  -0.361  0.0223 Head      
4  0.0461 -0.571 -0.0907 Head      
5  0.0152 -0.710 -0.125  Head      </code></pre>
</div>
</div>
<p>Voici en vue isométrique ce en quoi consiste ce nuage de points.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"scatterplot3d"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/scatterplot3d/man/scatterplot3d.html">scatterplot3d</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dolphin</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">dolphin</span><span class="op">$</span><span class="va">y</span>, z <span class="op">=</span> <span class="va">dolphin</span><span class="op">$</span><span class="va">z</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex.symbols <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-pca-dauphin-3d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Effectuons l’ACP sur le dauphin.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dolph_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/cca.html">rda</a></span><span class="op">(</span><span class="va">dolphin</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/biplot.html">biplot</a></span><span class="op">(</span><span class="va">dolph_pca</span>, scaling <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-pca-dauphin-biplot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On n’y voit pas grand chose, mais si l’on extrait les scores et que l’on raccourcit les vecteurs:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dolph_scores</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/scores.html">scores</a></span><span class="op">(</span><span class="va">dolph_pca</span>, display <span class="op">=</span> <span class="st">"sites"</span><span class="op">)</span></span>
<span><span class="va">dolph_loads</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/scores.html">scores</a></span><span class="op">(</span><span class="va">dolph_pca</span>, display <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="va">dolph_loads</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          PC1         PC2
x -0.02990131  0.01608095
y -7.13731672 -1.43221776
z -4.56612084  2.23859843
attr(,"const")
[1] 9.089026</code></pre>
</div>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dolph_scores</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">0.24</span>, asp <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dolphin</span><span class="op">$</span><span class="va">anatomy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">segments</span><span class="op">(</span>x0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, y0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>         x1 <span class="op">=</span> <span class="va">dolph_loads</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">50</span>,</span>
<span>         y1 <span class="op">=</span> <span class="va">dolph_loads</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fl">50</span>,</span>
<span>         col <span class="op">=</span> <span class="st">"chocolate"</span>, lwd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-pca-dauphin-biplot2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La meilleure représentation du dauphin en 2D, selon la variance, est son profil - en effet, il est plus long et haut que large.</p>
<div class="alert alert-block alert-info">
<strong>Note</strong>. Une ACP effectue seulement une rotation des points. Les distances euclidiennes entre les points sont maintenues.
</div>
<div class="alert alert-block alert-info">
<strong>Note</strong>. L’ACP a été conçue pour projetter en un nombre moindre de dimensions des observations dont les distributions sont multinormales (ce n’est évidemment pas le cas du dauphin).
</div>
<div class="alert alert-block alert-info">
<strong>Note</strong>. Les axes principaux d’une ACP sont des variables aléatoires. Elles peuvent être assujetties à des tests ststistiques, des modèles, du partitionnement de données, etc.
</div>
<div class="alert alert-block alert-success">
<strong>Excercice</strong>. Effectuez maintenant une ACP avec les données d’iris.
</div>
</section></section><section id="analyse-de-correspondance-ac" class="level4" data-number="10.4.1.2"><h4 data-number="10.4.1.2" class="anchored" data-anchor-id="analyse-de-correspondance-ac">
<span class="header-section-number">10.4.1.2</span> Analyse de correspondance (AC)</h4>
<p>L’analyse de correspondance (AC) est particulièrement appropriée pour traiter des données d’abondance et d’occurrence. Tout comme l’analyse en composantes principales, les données apportés vers une AC doivent être dimensionnellement homogènes, c’est-à-dire que chaque variable doit être de même métrique: pour des données d’abondance, cela signifie que les décomptes réfèrent tous au même concept: individus, colonies, surfaces occupées, etc. Alors que la distance euclidienne est préservée avec l’ACP, l’AC préserve la distance du <span class="math inline">\(\chi^2\)</span>, qui est insensible aux double-zéros.</p>
<p>L’AC produit <span class="math inline">\(min(n,p)-1\)</span> axes principaux orthogonaux qui captent non pas le maximum de variance, mais la proportion de mesures aux carré par rapport à la somme des carrés de la matrice. Le biplot obtenu peut être présenté sous forme de biplot de site (<em>scaling 1</em>), où la distance du <span class="math inline">\(\chi^2\)</span> est préservée entre les sites ou biplot d’espèces (<em>scaling 2</em>), ou la distance du <span class="math inline">\(\chi^2\)</span> est préservée entre les espèces. L’AC hérite du coup une propriété importate de la distance du <span class="math inline">\(\chi^2\)</span>, qui accorde davantage de distance entre un compte de 0 et de 1 qu’entre 1 et 2, et davantage entre 1 et 2 qu’entre 2 et 3.</p>
<p>Par exemple, sur ces trois sites, on a compté un individu A de moins que d’individu B.</p>
<div class="cell">
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">abundance_0123</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Site 1"</span>, <span class="st">"Site 2"</span>, <span class="st">"Site 3"</span><span class="op">)</span>,</span>
<span>                        A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                        B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">abundance_0123</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Site       A     B
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Site 1     0     1
2 Site 2     1     2
3 Site 3     9    10</code></pre>
</div>
</div>
<p>Pourtant, la distance du <span class="math inline">\(\chi^2\)</span> est plus élevée entre le site 1 et le site 2 qu’entre le site 2 et le site 3.</p>
<div class="cell">
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">dist</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/decostand.html">decostand</a></span><span class="op">(</span><span class="va">abundance_0123</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Site</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"chi.square"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1         2
2 0.6724111          
3 0.9555316 0.2831205</code></pre>
</div>
</div>
<p>La distance du <span class="math inline">\(\chi^2\)</span> donne davantage d’importance aux espèces rares, ce dont une analyse doit tenir compte. Il pourrait être envisageable de retirer d’un tableau des espèces rare, ou bien prétransformer des données d’abondance par une transformation de chord ou de Hellinger (tel que discuté au chapitre 6), puis procéder à une ACP sur ces données (<a href="https://doi.org/10.1007/s004420100716">Legendre et Gallagher, 2001</a>).</p>
<section id="application-4" class="level5" data-number="10.4.1.2.1"><h5 data-number="10.4.1.2.1" class="anchored" data-anchor-id="application-4">
<span class="header-section-number">10.4.1.2.1</span> Application</h5>
<p>Le tableau <a href="https://rdrr.io/rforge/vegan/man/varechem.html"><code>varespec</code></a> comprend des données de surface de couverture de 44 espèces de plantes en lien avec les données environnementales du tableau <code>varechem</code>. Ces données ont été publiées dans <a href="http://onlinelibrary.wiley.com/doi/10.2307/3236351/abstract">Väre et al.&nbsp;(1995)</a> et exportées du module <a href="https://rdrr.io/rforge/vegan/">vegan</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"varespec"</span><span class="op">)</span></span>
<span><span class="va">varespec</span> <span class="op">|&gt;</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Callvulg Empenigr Rhodtome Vaccmyrt Vaccviti Pinusylv Descflex Betupube
27     0.00    15.13     2.42     5.92    15.97     0.00     3.70        0
6      0.30     5.75     0.00     0.00    10.50     0.10     0.00        0
7      0.00     5.30     0.00     0.00     8.20     0.00     0.05        0
5      0.00     0.13     0.00     0.00     2.75     0.03     0.00        0
2      0.05     9.30     0.00     0.00     8.50     0.03     0.00        0
   Vacculig Diphcomp Dicrsp Dicrfusc Dicrpoly Hylosple Pleuschr Polypili
27     1.12     0.00      0     3.63     0.00      6.7    58.07     0.00
6      0.00     0.00      0     0.85     0.00      0.0     0.05     0.03
7      8.10     0.28      0     0.45     0.03      0.0     0.10     0.00
5      0.00     0.00      0     0.25     0.03      0.0     0.03     0.18
2      0.00     0.00      0     0.03     0.00      0.0     0.75     0.00
   Polyjuni Polycomm Pohlnuta Ptilcili Barbhatc Cladarbu Cladrang Cladstel
27     0.00     0.13     0.02     0.08     0.08     1.42     7.63     2.55
6      0.08     0.00     0.00     0.08     0.00    39.00    37.50    11.30
7      0.25     0.00     0.03     0.00     0.00    35.00    42.50     0.28
5      0.65     0.00     0.00     0.00     0.00    18.50    59.00     0.98
2      0.03     0.00     0.00     0.03     0.00     0.48    24.50    75.00
   Cladunci Cladcocc Cladcorn Cladgrac Cladfimb Cladcris Cladchlo Cladbotr
27     0.15     0.00     0.38     0.12     0.10     0.03     0.00     0.02
6      3.45     0.18     0.20     0.25     0.25     0.23     0.03     0.00
7      0.35     0.08     0.20     0.25     0.18     0.13     0.08     0.00
5      0.28     0.23     0.23     0.23     0.10     0.05     0.00     0.00
2      0.20     0.00     0.03     0.03     0.05     0.03     0.03     0.00
   Cladamau Cladsp Cetreric Cetrisla Flavniva Nepharct Stersp Peltapht Icmaeric
27     0.00   0.02     0.00        0     0.00      0.0   0.00     0.07     0.00
6      0.00   0.03     0.35        0     0.08      0.0   0.03     0.00     0.00
7      0.00   0.00     0.05        0     0.23      0.2   0.93     0.00     0.03
5      0.03   0.00     0.18        0     0.28      0.0  10.28     0.00     0.10
2      0.00   0.00     0.00        0     0.00      0.0   0.00     0.00     0.00
   Cladcerv Claddefo Cladphyl
27     0.00     0.15        0
6      0.00     0.28        0
7      0.00     0.10        0
5      0.00     0.25        0
2      0.03     0.03        0</code></pre>
</div>
</div>
<p>Pour effectuer l’AC, nous utiliserons, comme pour l’ACP, le module vegan mais cette fois-ci avec la fonction <code>cca</code>. L’AC en <em>scaling 1</em> est effectuée sur le tableau des abondances avec les espèces comme colonnes et les sites comme lignes. Les matrices d’abondance transposées indique les sites où chaque espèce ont été dénombrées: pour une analyse en <em>scaling 2</em>, on effectue une analyse de correspondance sur la matrice d’abondance (ou d’occurrence) transposée.</p>
<p>Pour chacune des AC, je filtre pour m’assurer que toutes les lignes contiennent au moins une observation. Ce n’est pas nécessaire dans notre cas, mais je le laisse pour l’exemple.</p>
<div class="cell">
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vare_cca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/cca.html">cca</a></span><span class="op">(</span><span class="va">varespec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">vare_cca</span>, scaling <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
cca(X = varespec %&gt;% filter(rowSums(.) &gt; 0)) 

Partitioning of scaled Chi-square:
              Inertia Proportion
Total           2.083          1
Unconstrained   2.083          1

Eigenvalues, and their contribution to the scaled Chi-square 

Importance of components:
                         CA1    CA2    CA3     CA4     CA5     CA6     CA7
Eigenvalue            0.5249 0.3568 0.2344 0.19546 0.17762 0.12156 0.11549
Proportion Explained  0.2520 0.1713 0.1125 0.09383 0.08526 0.05835 0.05544
Cumulative Proportion 0.2520 0.4233 0.5358 0.62962 0.71489 0.77324 0.82868
                          CA8     CA9    CA10    CA11    CA12    CA13     CA14
Eigenvalue            0.08894 0.07318 0.05752 0.04434 0.02546 0.01710 0.014896
Proportion Explained  0.04269 0.03513 0.02761 0.02129 0.01222 0.00821 0.007151
Cumulative Proportion 0.87137 0.90650 0.93411 0.95539 0.96762 0.97583 0.982978
                          CA15     CA16     CA17     CA18     CA19      CA20
Eigenvalue            0.010160 0.007830 0.006032 0.004008 0.002865 0.0019275
Proportion Explained  0.004877 0.003759 0.002896 0.001924 0.001375 0.0009253
Cumulative Proportion 0.987855 0.991614 0.994510 0.996434 0.997809 0.9987341
                           CA21      CA22      CA23
Eigenvalue            0.0018074 0.0005864 0.0002434
Proportion Explained  0.0008676 0.0002815 0.0001168
Cumulative Proportion 0.9996017 0.9998832 1.0000000

Scaling 1 for species and site scores
* Sites are scaled proportional to eigenvalues
* Species are unscaled: weighted dispersion equal on all dimensions


Species scores

                CA1       CA2      CA3       CA4        CA5       CA6
Callvulg  0.0303167 -1.597460  0.11455 -2.894569  0.1376073  2.291129
Empenigr  0.0751030  0.379305  0.39303  0.023675  0.8568729 -0.400964
Rhodtome  1.1052309  1.499299  3.04284  0.120106  3.2324306 -0.283510
Vaccmyrt  1.4614812  1.622935  2.72375  0.231688  0.4604556  0.712538
Vaccviti  0.1468014  0.313436  0.14696  0.243505  0.6868371 -0.147815
Pinusylv -0.4820096  0.588517 -0.36020 -0.127094  0.4064754  0.386604
Descflex  1.5348239  1.218806  1.87562 -0.001340 -1.3136979 -0.070731
Betupube  0.6694503  1.951826  3.84017  1.389423  7.5959115 -0.244478
Vacculig -0.0830789 -1.629259  1.05063  0.802648 -0.3058811 -1.625341
Diphcomp -0.5446464 -1.037570  0.52282  0.940275  0.3682126 -1.082929
Dicrsp    1.8120408  0.360290 -4.92082  3.088562  1.3867372  0.157815
Dicrfusc  1.2704743 -0.562978 -0.39718 -2.929542  0.3848272 -2.408710
Dicrpoly  0.7248118  1.409347  0.80341  1.915549  4.5674148  1.295447
Hylosple  2.0062408  1.743883  2.27549  0.928884 -3.7648428  2.254851
Pleuschr  1.3102086  0.583036 -0.01004  0.137298 -1.1216144  0.200422
Polypili -0.3805097 -1.243904  0.54593  1.477188 -0.7276341 -0.387641
Polyjuni  1.0133795  0.099043 -2.24697  1.510641  0.7729714 -3.062378
Polycomm  0.8468241  1.321773  1.13585  1.140723  2.6836594 -0.605038
Pohlnuta -0.0136453  0.589290 -0.35542  0.135481  0.9369707  0.397246
Ptilcili  0.4223631  1.598584  3.43474  1.400065  6.3209491  0.198935
Barbhatc  0.5018348  2.119334  4.57303  1.693188  8.1101807  0.645995
Cladarbu -0.1531729 -1.483884  0.20024  0.193680  0.0734141  0.358926
Cladrang -0.5502561 -1.084008  0.40552  0.724060 -0.3357992 -0.335924
Cladstel -1.4373146  1.077753 -0.44397 -0.375926 -0.2421525  0.004212
Cladunci  0.8151727 -1.006186 -1.82587 -1.389523  1.6046713  3.675908
Cladcocc -0.2133215 -0.584429 -0.21434 -0.567886 -0.0003788 -0.145303
Cladcorn  0.2631227 -0.177858 -0.44464  0.272422  0.3992282 -0.306738
Cladgrac  0.1956947 -0.311167 -0.23894  0.379013  0.4933026  0.037581
Cladfimb  0.0009213 -0.161418  0.18463 -0.435908  0.4831233 -0.143751
Cladcris  0.3373031 -0.470369 -0.05093 -0.823855  0.7182250  0.636140
Cladchlo -0.6200021  1.207278  0.21889  0.426447  1.9506082  0.120722
Cladbotr  0.5647242  1.047333  2.65330  0.907734  4.4946805  1.201655
Cladamau -0.6598144 -1.512880  0.83251  1.577699 -0.0407227 -1.419139
Cladsp   -0.8209003  0.476164 -0.49752 -0.998241 -0.2393208  0.390785
Cetreric  0.2458192 -0.689228 -1.68427 -0.131681  0.7439412  2.374535
Cetrisla -0.3465221  1.362693  0.85897  0.396752  2.7526968  0.396591
Flavniva -1.4391907 -0.833589 -0.12919  0.007071 -1.4841375  2.956977
Nepharct  1.6813309  0.199484 -4.33509  2.229917  0.9561223 -5.472858
Stersp   -0.5172793 -2.280900  0.99775  2.377013 -0.8892757 -1.441228
Peltapht  0.4035858 -0.043265  0.04538  0.711040  0.1824679 -0.841227
Icmaeric  0.0378754 -2.419595  0.72135  0.361302 -0.3736424 -2.092136
Cladcerv -0.9232858 -0.005233 -1.22058  0.305290 -0.8142627  0.414135
Claddefo  0.5190399 -0.496632 -0.15271 -0.695927  0.9042143  0.909191
Cladphyl -1.2836161  1.155872 -0.79912 -0.741170 -0.1608002  0.490526


Site scores (weighted averages of species scores)

         CA1      CA2       CA3      CA4        CA5      CA6
18 -0.108122 -0.53705  0.229574  0.24412  0.1405624 -0.14253
15  0.697118 -0.14441 -0.031788 -0.21743 -0.2738522 -0.08146
24  0.987603  0.15042 -1.348447  0.80472  0.3095168  0.46773
27  0.851765  0.49901  0.443559  0.12277 -0.4814871  0.07589
23  0.359881 -0.05608  0.145813  0.15087  0.2405263 -0.17770
19  0.003545  0.37017  0.027760  0.06168 -0.1158930 -0.03413
22  0.860732 -0.11504  0.110869 -1.02169  0.0772348 -0.60530
16  0.636936 -0.33250  0.001120 -0.79797  0.0130769 -0.54049
28  1.279352  0.81557  0.670053  0.23137 -0.8929976  0.41783
13 -0.195009 -0.80564  0.117686 -0.58286 -0.0007212  0.53071
14  0.528532 -0.70420 -0.517771 -0.86836  0.5713441  0.91671
20  0.382866 -0.18686 -0.004789  0.10156  0.0458125  0.21087
25  0.990715  0.11967 -1.110040  0.44929  0.1885902 -0.70694
7  -0.264704 -1.06013  0.334900  0.45973 -0.0326631 -0.19945
5  -0.428410 -1.20765  0.374344  0.74970 -0.2596294 -0.30467
6  -0.330534 -0.77498  0.130760  0.22391  0.0632686  0.09060
3  -0.899601  0.12075 -0.075742  0.03842 -0.1489585 -0.12031
4  -0.770294 -0.35351 -0.033779 -0.01795 -0.3007839  0.44303
2  -0.992193  0.50319 -0.157505 -0.07070 -0.1065172 -0.09928
9  -0.937173  0.78688 -0.258119 -0.19377 -0.0343535 -0.01259
12 -0.726413  0.49163 -0.157235 -0.08698 -0.0105774 -0.02801
10 -1.002083  0.71239 -0.236526 -0.18643 -0.0231666 -0.04928
11 -0.322647 -0.03871 -0.001297  0.09029 -0.1481448  0.06934
21  0.259527  0.80746  1.124258  0.36083  1.5437866  0.07051</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">varespec_eigenval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/eigenvals.html">eigenvals</a></span><span class="op">(</span><span class="va">vare_cca</span>, scaling <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prop_expl</span> <span class="op">&lt;-</span> <span class="va">varespec_eigenval</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span>,</span>
<span>     y <span class="op">=</span> <span class="va">vare_cca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Rang de la valeur propre"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Valeur propre"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span>,</span>
<span>     y <span class="op">=</span> <span class="va">prop_expl</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Rang de la valeur propre"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Valeur propre"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu">broken_stick</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>      lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-varespec-cca-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Créons les biplots.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vare_cca</span>, scaling <span class="op">=</span> <span class="fl">1</span>, main <span class="op">=</span> <span class="st">"Biplot des espèces"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vare_cca</span>, scaling <span class="op">=</span> <span class="fl">2</span>, main <span class="op">=</span> <span class="st">"Biplot des sites"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-varespec-cca-biplot-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Le <strong>biplot des espèces</strong>, à gauche (<code>scaling = 1</code>), montre la distribution des sites selon les espèces. Les emplacements des scores (en noir) montrent les contrastes entre sites selon les espèces qui les recouvrent. Les sites 14 et 15, par exemple, contrastent les sites 19, 20, 21 et 22 selon le 2ième axe principal. Par ailleurs, les axes principaux sont formé de plusieurs espèces dont aucune ne domine clairement.</p>
<p>Le <strong>biplot des sites</strong>, à droite (<code>scaling = 2</code>), montre la distribution des recouvrements d’espèces selon les sites. Par exemple, les espèces Betupube (<a href="https://fr.wikipedia.org/wiki/Betula_pubescens"><em>Betula pubescens</em></a>) et Barbhatc (<a href="https://en.wikipedia.org/wiki/Marchantiophyta"><em>Barbilophozia hatcheri </em></a>) se recouvrent en particulier le site 24. Le site 1 est difficile à identifier, car il est couvert par plusieurs noms d’espèces, au bas au centre. Les sites 3 et 13 se confondent avec Dicrsp (une espèce de <a href="https://en.wikipedia.org/wiki/Dicranum"><em>Dicranum</em></a>) qui le recouvre amplement.</p>
<p>Pour les deux types de biplot, les sites où les espèces situés près de l’origine, car ils peuvent être soit près de la moyenne, soit distribués uniformément.</p>
<p>Le nombre de composantes à retenir peut être évalué par les approches <em>Kaiser-Guttmann</em> et <em>broken-stick</em>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scaling</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">varespec_eigenval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/eigenvals.html">eigenvals</a></span><span class="op">(</span><span class="va">vare_cca</span>, scaling <span class="op">=</span> <span class="va">scaling</span><span class="op">)</span> <span class="co"># peut être effectué sur les deux types de scaling</span></span>
<span></span>
<span><span class="va">prop_expl</span> <span class="op">&lt;-</span> <span class="va">varespec_eigenval</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span>,</span>
<span>     y <span class="op">=</span> <span class="va">vare_cca</span><span class="op">$</span><span class="va">CA</span><span class="op">$</span><span class="va">eig</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Rang de la valeur propre"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Valeur propre"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Eigenvalue - Kaiser-Guttmann, scaling ="</span>, <span class="va">scaling</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span>,</span>
<span>     y <span class="op">=</span> <span class="va">prop_expl</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Rang de la valeur propre"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Valeur propre"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Proportion - broken stick, scaling ="</span>, <span class="va">scaling</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu">broken_stick</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">varespec_eigenval</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>      lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-varespec-cca-analysis-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Pour les deux scalings, l’approche <em>Kaiser-Guttmann</em> propose 7 axes, tandis que l’approche <em>broken-stick</em> en propose 5.</p>
<p>Les représentations biplot d’analyse de correspondance peuvent prendre la forme d’un boomerang, en particulier celles qui sont basées sur des données d’occurrence. Le tableau suivant initialement de <a href="http://pbil.univ-lyon1.fr/R/pdf/pps047.pdf">Chessel et al.&nbsp;(1987)</a> et est distribué dans le module ade4.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://pbil.univ-lyon1.fr/ADE-4/">"ade4"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"doubs"</span><span class="op">)</span></span>
<span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="va">doubs</span><span class="op">$</span><span class="va">fish</span></span>
<span><span class="va">doubs_cca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/cca.html">cca</a></span><span class="op">(</span><span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">doubs_cca</span>, scaling <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-doubs-cca-biplot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Les numéros de sites correspondent à la position dans une rivière, 1 étant en amont et 30 en aval. Le premier axe discrimine l’amont et l’aval, tandis que le deuxième montre deux niches en amont. Bien que l’on observe une discontinuité dans le cours d’eau, il y a une continuité dans les abondances. Cet effet peut être corrigé en retirant la tendance de l’analyse de correspondance par une <em>detrended correspondance analysis</em>. Pour cela, il faudra utiliser la fonction <code>decorana</code>, ce qui ne sera pas couvert ici.</p>
<p>L’<em>analyse des correspondances multiples</em> (ACM) est utile pour l’ordination des données catégorielles. Le module <a href="https://larmarange.github.io/analyse-R/analyse-des-correspondances-multiples.html#acm-avec-ade4"><em>ade4</em></a> est en mesure d’effectuer des AMC, mais n’est pas couvert dans ce manuel.</p>
<div class="alert alert-block alert-success">
<strong>Excercice</strong>. Effectuez et analysez une AC avec les données de recouvrement <code>varespec</code>.
</div>
</section></section><section id="positionnement-multidimensionnel-pomd" class="level4" data-number="10.4.1.3"><h4 data-number="10.4.1.3" class="anchored" data-anchor-id="positionnement-multidimensionnel-pomd">
<span class="header-section-number">10.4.1.3</span> Positionnement multidimensionnel (PoMd)</h4>
<p>Le positionnement multidimensionnel (PoMd), ou <a href="http://scikit-learn.org/stable/modules/manifold.html"><em>manifold analysis</em></a>, se base sur les associations entre les objets (mode Q) ou les variables (mode R) pour en réduire les dimensions. Alors que l’analyse en composantes principales conserve la distance euclidienne et que l’analyse de correspondance conserve la distance du <span class="math inline">\(\chi^2\)</span>, le PoMd conserve l’association que vous sélectionnerez à votre convenance. Le PoMd vise à représenter en un nombre limité de dimensions (souvent 2) la distance (ou dissimilarité) qu’ont les objets (ou des variables) les uns par rapport aux autres dans l’espace multidimensionnel.</p>
<p>Il existe deux types d’AEM. Le <strong>PoMd-métrique</strong> (<em>metric multidimentional scaling</em> MMDS, parfois le <em>metric</em> est retiré, MDS, et parfois l’on parle de <em>classic MDS</em>) vise à représenter fidèlement la distance entre les objets ou les variables. Le PoMd-métrique ne devrait être utilisée que lorsque la métrique n’est ni euclidienne, ni de <span class="math inline">\(\chi^2\)</span> et que l’on désire préserver les distances entre les objets. L’PoMd-métrique aussi appelée <em>analyse en coordonnées principales</em> (ACoP ou de l’anglais <em>PCoA</em>) .</p>
<p>Le <strong>PoMd-non-métrique</strong> (<em>nonmetric multidimentional scaling</em>, NMDS) vise quant à lui à représenter l’ordre des distances entre les objets ou les variables. C’est une approche par rang: le PoMd-non-métrique vise représenter les objets sont plus proches ou plus éloignées les uns des autres plutôt que de représenter leur similarité dans l’espace multidimentionnelle.</p>
<p>L’<strong>IsoMap</strong>, pour <em>isometric feature mapping</em>, est une extension du PoMd qui reconstruit les distances selon les points retrouvés dans le voisinage. Les isomaps sont en mesure d’aplatir des données ayant des formes complexes.</p>
<p>Nous ne traitons pour l’instant que de l’PoMd-métrique (fonction <code>vegan::cmdscale</code>) et des PoMd-non-métrique (fonction <code><a href="https://rdrr.io/pkg/vegan/man/metaMDS.html">vegan::metaMDS</a></code>).</p>
<section id="application-5" class="level5" data-number="10.4.1.3.1"><h5 data-number="10.4.1.3.1" class="anchored" data-anchor-id="application-5">
<span class="header-section-number">10.4.1.3.1</span> Application</h5>
<p>Utilisons les données d’abondance que nous avions au tout début de ce chapitre. La matrice d’association de Bray-Curtis sera utilisée.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">assoc_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html">vegdist</a></span><span class="op">(</span><span class="va">abundance</span>, method <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">assoc_mat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>, cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>, cluster_cols <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         display_numbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">assoc_mat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/aop-pomd-abun-data-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<p>Les sites 2 et 3 devraient être plus près l’un et l’autre, puis les sites 3 et 4. Les autres associations sont éloignés d’environ la même distance. Lançons le calcul de la PoMd-métrique.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pcoa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html">cmdscale</a></span><span class="op">(</span><span class="va">assoc_mat</span>, k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, eig <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">spec_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/wascores.html">wascores</a></span><span class="op">(</span><span class="va">pcoa</span><span class="op">$</span><span class="va">points</span>, <span class="va">abundance</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/scores.html">scores</a></span><span class="op">(</span><span class="va">pcoa</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'t'</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>species scores not available</code></pre>
</div>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">spec_scores</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">spec_scores</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/aop-pomd-abun-compute-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On observe en effet que les sites 2 et 3 sont les plus près. Les sites 3 et 4sont plus éloignés. Les sites 1, 2 et 4 font à peu près un triangle équilatéral, ce qui correspond à ce à quoi on devrait s’attendre. Les wa-scores permettent de juxtaposer les espèces sur les sites, pour référence. Le colibri n’est présent que sur le site 2. Le site 1 est populé par des jaseurs et des mésanges, et c’est le seul site où l’on a observé une citelle. On a observé des chardonnerets sur les sites 2 et 3. Sur le site 4, on n’a observé que des bruants, que l’on a aussi observé ailleurs, sauf au site 2.</p>
<p>Le PoMd-non-métrique (<em>non metric dimensional scaling, NMDS</em>) fonctionne de la même manière que la PoMd-métrique, à la différence que la distance est basée sur les rangs. À cet égard, le site 4 à une distance de 0.76 du site 3, mais plutôt le deuxième plus loin, après le site 2 et avant le site 1. Utilisons la fonction <code>metaMDS</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nmds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/metaMDS.html">metaMDS</a></span><span class="op">(</span><span class="va">assoc_mat</span>, k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, eig <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Run 0 stress 0 
Run 1 stress 0 
... Procrustes: rmse 0.1216366  max resid 0.1634103 
Run 2 stress 0 
... Procrustes: rmse 0.1403208  max resid 0.1888214 
Run 3 stress 0 
... Procrustes: rmse 0.115492  max resid 0.1523862 
Run 4 stress 0 
... Procrustes: rmse 0.1551062  max resid 0.202592 
Run 5 stress 0 
... Procrustes: rmse 0.09908794  max resid 0.1384734 
Run 6 stress 0 
... Procrustes: rmse 0.0987008  max resid 0.1454209 
Run 7 stress 0 
... Procrustes: rmse 0.1164685  max resid 0.1501751 
Run 8 stress 0 
... Procrustes: rmse 0.0831961  max resid 0.09943451 
Run 9 stress 0 
... Procrustes: rmse 0.1429865  max resid 0.1921223 
Run 10 stress 0 
... Procrustes: rmse 0.09337227  max resid 0.1214715 
Run 11 stress 0 
... Procrustes: rmse 0.06970139  max resid 0.1001732 
Run 12 stress 0 
... Procrustes: rmse 0.08842632  max resid 0.1314237 
Run 13 stress 0 
... Procrustes: rmse 0.08200456  max resid 0.1163193 
Run 14 stress 0 
... Procrustes: rmse 0.09483784  max resid 0.1239188 
Run 15 stress 0 
... Procrustes: rmse 0.1513612  max resid 0.1946446 
Run 16 stress 0 
... Procrustes: rmse 0.08664967  max resid 0.1141698 
Run 17 stress 0 
... Procrustes: rmse 0.1179912  max resid 0.1610405 
Run 18 stress 0 
... Procrustes: rmse 0.1099474  max resid 0.1455303 
Run 19 stress 0 
... Procrustes: rmse 0.1063117  max resid 0.1398709 
Run 20 stress 0 
... Procrustes: rmse 0.1009788  max resid 0.1310601 
*** Best solution was not repeated -- monoMDS stopping criteria:
    20: stress &lt; smin</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in metaMDS(assoc_mat, k = nrow(abundance) - 1, eig = TRUE): stress is
(nearly) zero: you may have insufficient data</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in postMDS(out$points, dis, plot = max(0, plot - 1), ...): skipping
half-change scaling: too few points below threshold</code></pre>
</div>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spec_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/wascores.html">wascores</a></span><span class="op">(</span><span class="va">nmds</span><span class="op">$</span><span class="va">points</span>, <span class="va">abundance</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/scores.html">scores</a></span><span class="op">(</span><span class="va">nmds</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'t'</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>species scores not available</code></pre>
</div>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">spec_scores</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">spec_scores</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/aop-pomd-abun-compute-nmds-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Dans ce cas, entre PoMd-métrique et non-métrique, les résultats peuvent être interprétés de manière similaire.</p>
<p>En ce qui a trait au dauphin,</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/aop-pomd-dauphin-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Pour plus de détails, je vous invite à vous référer à <a href="http://www.springer.com/us/book/9781441979759">Borcard et al.&nbsp;(2011)</a>) ou de consulter l’excellent site <a href="https://mb3is.megx.net/gustame/dissimilarity-based-methods/nmds">GUSTA ME</a>.</p>
</section></section><section id="conclusion-sur-lordination-non-contraignante" class="level4" data-number="10.4.1.4"><h4 data-number="10.4.1.4" class="anchored" data-anchor-id="conclusion-sur-lordination-non-contraignante">
<span class="header-section-number">10.4.1.4</span> Conclusion sur l’ordination non contraignante</h4>
<p>Lorsque les données sont euclidiennes, l’analyse en composantes principales (ACP) devrait être utilisée. Lorsque la métrique est celle du <span class="math inline">\(\chi^2\)</span>, on préférera l’analyse de correspondance (AC). Si la métrique est autre, le positionnement multidimensionel (PoMd) est préférable. Dans ce dernier cas, si l’on recherche une représentation simplifiée de la distance entre les objets ou variables, on utilisera un PoMd-métrique. À l’inverse, si l’on désire une représentation plus fidèle au rang des distances, on préférera l’PoMd-non-métrique.</p>
</section></section><section id="ordination-contraignante" class="level3" data-number="10.4.2"><h3 data-number="10.4.2" class="anchored" data-anchor-id="ordination-contraignante">
<span class="header-section-number">10.4.2</span> Ordination contraignante</h3>
<p>Alors que l’ordination non contraignante vous permet de dresser un portrait de vos variables, l’ordination contraignante (ou canonique) permet de tester statistiquement ainsi que de représenter la relation entre plusieurs variables explicatives (par exemple, des conditions environnementales) et une ou plusieurs variables réponses (par exemple, les espèces observées).</p>
<ul>
<li>L’analyse discriminante n’a fondamentalement qu’une seulement variable réponse, et celle-ci doit décrire l’appartenance à une catégorie.</li>
<li>L’analyse de redondance sera préférée lorsque le nombre de variable est plus restreint (variables ionomiques et indicateurs de performance des cultures). Les détails, ainsi que les tenants et aboutissants de ces méthodes, sont présentés dans <a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Numerical Ecology (Legendre et Legendre, 2012)</a>.</li>
<li>L’analyse canonique des corrélations sera préférée lorsque les variables sont parsemées (beaucoup de colonnes avec beaucoup de zéros, comme les variables d’abondance).</li>
</ul>
<section id="analyse-discriminante" class="level4" data-number="10.4.2.1"><h4 data-number="10.4.2.1" class="anchored" data-anchor-id="analyse-discriminante">
<span class="header-section-number">10.4.2.1</span> Analyse discriminante</h4>
<p>Alors que l’analyse en composante principale vise à présenter la perspective (les axes) selon laquelle les points sont les plus éclatées, l’analyse discriminante, le plus souvent utilisé dans sa forme linéaire (ADL) et quadratique (ADQ), vise à présenter la perspective selon laquelle les groupes sont les plus éclatés, les groupes formant la variable contraignante. Ces groupes peuvent être connus (e.g.&nbsp;cultivar, région géographique) ou attribués (exemple: par partitionnement). L’ADL est parfois nommée <em>analyse canonique de la variance</em>.</p>
<p>L’AD vise à représenter des différences entre des groupes aux moyens de combinaisons linéaires (ADL) ou quadratique (ADQ) de variables mesurées. Sa représentation sous forme de biplot permet d’apprécier les différences entre les groupes d’identifier les variables qui sont responsables de la discrimination.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/07_ionome-revisited-figure4d.png" class="img-fluid figure-img" alt="&quot;" width="600"></p>
</figure>
</div>
<center>
Biplot de distance de l’analyse discriminante des ionomes d’espèces de plantes à fruits cultivées sauvages et domestiquées, Source: <a href="https://doi.org/10.3389/fpls.2013.00039">Parent et al.&nbsp;(2013)</a>
</center>
<p>L’ADL a été développée par <a href="http://onlinelibrary.wiley.com/doi/10.1111/j.1469-1809.1936.tb02137.x/abstract">Fisher (1936)</a>, qui à titre d’exemple d’application a utilisé un jeu de données de dimensions d’iris collectées par Edgar Anderson, du Jardin botanique du Missouri, sur 150 spécimens d’iris collectés en Gaspésie (Est du Québec), ma région natale (suis-je assez chauvin?). Ce jeu de données est amplement utilisé à titre d’exemple en analyse multivariée.</p>
<p><a href="http://www.jstor.org/stable/1937836">Williams (1983)</a> a présenté les tenants et aboutissants de l’ADL en écologie. Tout comme les données passant pas une ACP doivent suivre une distribution multinormale pour être statistiquement valide, les distributions des groupes dans une ADL doivent être multinormales et les variances des points par groupe doivent être homogènes… ce qui est rarement le cas en science. Néanmoins:</p>
<blockquote class="blockquote">
<p>Heureusement, il y a des évidences dans la littérature que certaines d’entre [ces règles] peuvent être transgressées modérément sans de grands changement dans les taux de classification. Cette conclusion dépends, toutefois, de la sévérité des transgressions, et de facteurs structueaux comme la position relative des moyennes des populations et de la nature des dispersions. - <a href="http://www.jstor.org/stable/1937836">Williams (1983)</a></p>
</blockquote>
<p>L’ADL peut servir autant d’outil d’interprétation que d’outil de classification, c’est à dire de prédire une catégorie selon les variables (<a href="12-autoapprentissage.html">chapitre&nbsp;<span>13</span></a>). Dans les deux cas, lorsque le nombre de variables approchent le nombre d’observation, les résultats d’une ADL risque d’être difficilement interprétables. Le test approprié pour évaluer l’homodénéité de la covariance est le M-test de Box. Ce test est peu documenté dans la littérature, est rarement utilisé mais a la <a href="https://en.wikiversity.org/wiki/Box%27s_M">réputation</a> d’être particulièrement sévère.</p>
<p>Il est rare que des données écologiques aient des dispersions (covariances) homogènes. Contrairement à l’ADL, l’ADQ ne demande pas à ce que les dispersions (covariances) soient homogènes. Néanmoins, l’ADQ ne génère ni de scores, ni de loadings: il s’agit d’un outil pour prédire des catégories (classification), non pas d’un outil d’ordination.</p>
<section id="application-6" class="level5" data-number="10.4.2.1.1"><h5 data-number="10.4.2.1.1" class="anchored" data-anchor-id="application-6">
<span class="header-section-number">10.4.2.1.1</span> Application</h5>
<p>Utilisons les données d’iris.</p>
<div class="cell">
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Testons la multinormalité par groupe. Rappelons-nous que pour considérer la distribution comme multinormale, la p-value de la distorsion ainsi que la statistique de Kurtosis doivent être égale ou plus élevée que 0.05. La fonction <code>split</code> sépare le tableau en listes et la fonction <code>map</code> applique la fonction spécifiée à chaque élément de la liste. Cela permet d’effectuer des tests de multinormalité sur chacune des espèces d’iris.</p>
<div class="cell">
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/MVN/man/mvn.html">mvn</a></span><span class="op">(</span><span class="va">.x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span>,</span>
<span>            mvnTest <span class="op">=</span> <span class="st">"mardia"</span><span class="op">)</span><span class="op">$</span><span class="va">multivariateNormality</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$setosa
             Test        Statistic           p value Result
1 Mardia Skewness 25.6643445196298 0.177185884467652    YES
2 Mardia Kurtosis 1.29499223711605 0.195322907441935    YES
3             MVN             &lt;NA&gt;              &lt;NA&gt;    YES

$versicolor
             Test         Statistic           p value Result
1 Mardia Skewness  25.1850115362466 0.194444483140265    YES
2 Mardia Kurtosis -0.57186635893429 0.567412516528727    YES
3             MVN              &lt;NA&gt;              &lt;NA&gt;    YES

$virginica
             Test         Statistic           p value Result
1 Mardia Skewness  26.2705981752915 0.157059707690356    YES
2 Mardia Kurtosis 0.152614173978342 0.878702546726567    YES
3             MVN              &lt;NA&gt;              &lt;NA&gt;    YES</code></pre>
</div>
</div>
<p>Le test est passé pour toutes les espèces. Voyons maintenant l’homogénéité de la covariance. Pour ce faire, nous aurons besoin de la fonction <code>boxM</code>, disponible avec le module <code>biotools</code>. Pour que les covariances soient considérées comme égales, la p-vaule doit être supérieure à 0.05.</p>
<div class="cell">
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://friendly.github.io/heplots/">"heplots"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: broom</code></pre>
</div>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/boxM.html">boxM</a></span><span class="op">(</span><span class="va">iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span>,</span>
<span>     group <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box's M-test for Homogeneity of Covariance Matrices

data:  select(iris, -Species)
Chi-Sq (approx.) = 140.94, df = 20, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>On est loin d’un cas où les distributions sont homogènes. Nous allons néanmoins procéder à l’analyse discriminante avec le module ade4. Nous aurons d’abord besoin d’effectuer une ACP avec la fonction <code>dudi.pca</code> de ade4 (en spécifiant une mise à l’échelle), que nous projetterons en ADL avec <code>discrimin</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://pbil.univ-lyon1.fr/ADE-4/">"ade4"</a></span><span class="op">)</span></span>
<span><span class="va">iris_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ade4/man/dudi.pca.html">dudi.pca</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span>,</span>
<span>                     scannf <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># ne pas générer de graphique</span></span>
<span>                     scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">iris_lda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ade4/man/discrimin.html">discrimin</a></span><span class="op">(</span>dudi <span class="op">=</span> <span class="va">iris_pca</span>,</span>
<span>                      fac <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>,</span>
<span>                      scannf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La visualisation peut être effectuée directement sur l’objet issu de la fonction <code>discrimin</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">iris_lda</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-lda-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Il s’agit toutefois d’une visualisation pour le diagnostic davantage que pour la publication. Si l’objectif est la publication, vous pourriez utiliser la fonction <code>plotDA</code> que j’ai conçue à cet effet. J’ai aussi conçu une <a href="https://raw.githubusercontent.com/essicolo/AgFun/master/plotDA_trad.R">fonction similaire qui utilise le module graphique de base de R</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/essicolo/AgFun/master/plotDA_gg.R"</span><span class="op">)</span></span>
<span><span class="fu">plotDA</span><span class="op">(</span>scores <span class="op">=</span> <span class="va">iris_lda</span><span class="op">$</span><span class="va">li</span>,</span>
<span>       loadings <span class="op">=</span> <span class="va">iris_lda</span><span class="op">$</span><span class="va">fa</span>,</span>
<span>       fac <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>,</span>
<span>       level<span class="op">=</span><span class="fl">0.95</span>,</span>
<span>       facname <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>       propLoadings <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ellipse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ellipse'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:car':

    ellipse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    pairs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: plyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>You have loaded plyr after dplyr - this is likely to cause problems.
If you need functions from both plyr and dplyr, please load plyr first, then dplyr:
library(plyr); library(dplyr)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    compact</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-lda-biplot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>À la différence de l’ACP, l’ADL maximise la séparation des groupes. Nous avions noté avec l’ACP que les dimensions des pétales distinguaient les groupes. Puisque nous avions justement des informations sur les groupes, nous aurions pu procéder directement à un ADL pour obtenir des conclusions plus directes. Si la longueur des pétales permet de distinguer l’espèce <em>setosa</em> des deux autres, la largeur des pétales permet de distinguer <em>virginica</em> et <em>versicolor</em>, bien que les nuages de points se superposent. De manière bivariée, les régions de confiance des moyennes des scores discriminants (petites ellipses) montrent des différence significatives au seuil 0.05.</p>
<div class="alert alert-block alert-success">
<strong>Excercice</strong>. Si l’on effectuait l’ADL sur notre dauphin, avec la colonne <code>anatomy</code> comme variable de regroupement, qu’obtiendrions-nous? Si l’on considère la nageoire codale (queue) comme faisant partie du corps? Quelles sont les limitations?
</div>
</section></section><section id="analyse-de-redondance-rda" class="level4" data-number="10.4.2.2"><h4 data-number="10.4.2.2" class="anchored" data-anchor-id="analyse-de-redondance-rda">
<span class="header-section-number">10.4.2.2</span> Analyse de redondance (RDA)</h4>
<p>En anglais, on la nomme <em>redundancy analysis</em>, souvent abrégée RDA. Elle est utilisée pour résumer les relations linéaires entre des variables réponse et des variables explicatives. La “redondance” se situe dans l’utilisation de deux tableaux de données contenant de l’information concordante. L’analyse de redondance est une manière élégante d’effectuer une régression linéaire multiple, où la matrice de valeurs prédites par la régression est assujettie à une analyse en composantes principales. Il est ainsi possible de superposer les scores des variables explicatives à ceux des variables réponse.</p>
<p>Plus précisément, une RDA effectue les étapes suivantes (<a href="http://www.springer.com/us/book/9781441979759">Borcard et al.&nbsp;(2011)</a>) entre une matrice de variables indépendantes (explicatives) <span class="math inline">\(X\)</span> et une matrice de variables dépendantes (réponse) <span class="math inline">\(Y\)</span>.</p>
<section id="régression-entre-y-et-x" class="level5" data-number="10.4.2.2.1"><h5 data-number="10.4.2.2.1" class="anchored" data-anchor-id="régression-entre-y-et-x">
<span class="header-section-number">10.4.2.2.1</span> 1. Régression entre <span class="math inline">\(Y\)</span> et <span class="math inline">\(X\)</span>
</h5>
<p>Pour chacune des variables réponse de <span class="math inline">\(Y\)</span> (<span class="math inline">\(y_1\)</span>, <span class="math inline">\(y_2\)</span>, , <span class="math inline">\(y_j\)</span>), effectuer une régression linéaire sur les variables explicatives <span class="math inline">\(X\)</span>.</p>
<p><span class="math display">\[\hat{y}_j = b_j + m_{1, j} \times x_1 + m_{2, j} \times x_2 + ... + m_{i, j} \times x_i\]</span></p>
<p><span class="math display">\[\hat{y}_j = y_j + y_{res, j}\]</span></p>
<p>Pour chaque observation (<span class="math inline">\(n\)</span>), nous obtenons une série de valeurs de <span class="math inline">\(\hat{y}_j\)</span> et de <span class="math inline">\(y_{res, j}\)</span>. Donc chaque cellule de la matrice <span class="math inline">\(Y\)</span> a ses pendant <span class="math inline">\(\hat{y}\)</span> et <span class="math inline">\(y_{res}\)</span>. Nous obtenons ainsi une matrice de prédiction <span class="math inline">\(\hat{Y}\)</span> et une matrice des résidus <span class="math inline">\(Y_{res} = Y - \hat{Y}\)</span>.</p>
</section><section id="analyse-en-composantes-principales-1" class="level5" data-number="10.4.2.2.2"><h5 data-number="10.4.2.2.2" class="anchored" data-anchor-id="analyse-en-composantes-principales-1">
<span class="header-section-number">10.4.2.2.2</span> 2. Analyse en composantes principales</h5>
<p>Ensuite, on effectue une analyse en composantes principales (ACP) sur la matrice des prédictions <span class="math inline">\(\hat{Y}\)</span>. On obtient ainsi ses valeurs et vecteurs propres. Nommons <span class="math inline">\(U\)</span> ses vecteurs propres. Les fonctions de RDA mettent souvent ces vecteurs à l’échelle avant de les retourner à l’utilisateur. En ordination écologique, ces vecteurs mis à l’échelle sont souvent appelés les <em>scores des espèces</em>, bien qu’il ne s’agisse pas nécessairement d’espèces, mais plus généralement des variables de la matrice dépendante <span class="math inline">\(Y\)</span>.</p>
<p>Il est aussi possible d’effectuer une ACP sur <span class="math inline">\(Y_{res}\)</span>.</p>
</section><section id="calculer-les-scores" class="level5" data-number="10.4.2.2.3"><h5 data-number="10.4.2.2.3" class="anchored" data-anchor-id="calculer-les-scores">
<span class="header-section-number">10.4.2.2.3</span> 3. Calculer les scores</h5>
<p>Les vecteurs propres <span class="math inline">\(U\)</span> sont utilisés pour calculer les <em>scores des sites</em>, <span class="math inline">\(Y \times U\)</span>, ainsi que les <em>contraintes de site</em> <span class="math inline">\(\hat{Y} \times U\)</span>.</p>
</section><section id="application-7" class="level5" data-number="10.4.2.2.4"><h5 data-number="10.4.2.2.4" class="anchored" data-anchor-id="application-7">
<span class="header-section-number">10.4.2.2.4</span> Application</h5>
<p>Nous allons utiliser la fonction <code>rda</code> du module vegan. En ce qui a trait aux données, utilisons les données varespec (matrice Y) et varechem (matrice X). La fonction <code>rda</code> peut fonctionner avec l’interface-formule de R, où à gauche du <code>~</code> on retrouve le Y (la matrice de la communauté écologique, i.e.&nbsp;les abondances d’espèces) contre le X (l), à gauche, ce qui peut être pratique pour l’analyse d’interactions. Mais pour comparer deux matrices, nous pouvons définir X et Y. Ce qui est mélangeant, c’est que vegan, contrairement aux conventions, défini X comme étant la matrice réponse et Y comme étant la matrice explicative.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vare_rda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/cca.html">rda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">varespec</span>, Y <span class="op">=</span> <span class="va">vareclr</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="va">vare_rda</span>, scaling <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"text"</span>, main <span class="op">=</span> <span class="st">"Scaling 1: triplot de distance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="va">vare_rda</span>, scaling <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"text"</span>, main <span class="op">=</span> <span class="st">"Scaling 2: triplot de corrélation"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-vare-rda-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>La fonction <code>ordiplot</code> permet de créer un triplot de base. La représentation des wascores est réputée plus robuste (moins susceptible d’être bruitée), mais leur interprétation porte à confusion (<a href="http://www.springer.com/us/book/9781441979759">Borcard et al.&nbsp;(2011)</a>).</p>
<p><strong>Triplot de distance (scaling 1)</strong>. Les angles entre les variables explicatives représentent leur corrélation (non pas les variables réponse).</p>
<p><strong>Triplot de corrélation (scaling 2)</strong>. Les angles entre les variables représentent leurs corrélation, que les variables soient réponse ou explicative, ou entre variables réponses et variables explicatives. Les distances entre les objets sur le triplot ne sont pas des approximation de leur distance euclidienne.</p>
<p>Les triplots montrent que les variables ont toutes un rôle important sur la dispersion des sites autour des axes principaux. Le premier axe principal est composé de manière plus marquée par le clr de l’Al et celui du Fe. Le deuxième axe principal est composé de manière plus marquée par le clr du S, du P et du K. Le triplot de corrélation ne présente pas de tendance appréciable pour la plupart des espèces, qui ne possèdent pas de niche particulière. Toutefois, l’espèce Cladstel, présente surtout dans les sites 9 et 10, est liée à de basses teneurs en N et à de faibles valeurs de Baresoil (sol nu). L’espèce Pleuschr est liée à des sols où l’on retrouve une grande épaisseur d’humus, ainsi que des teneurs élevées en nutriment K, P, S, Ca, Mg et Zn. Elle semble apprécier les sols à bas pH, mais à faible teneur en Fe et Al. La teneur en N lui semble plus indifférente (son vecteur étant presque perpendiculaire).</p>
<p>On pourra personnaliser les graphiques en extrayant les scores.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scaling</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/scores.html">scores</a></span><span class="op">(</span><span class="va">vare_rda</span>, display <span class="op">=</span> <span class="st">"wa"</span>, scaling <span class="op">=</span> <span class="va">scaling</span><span class="op">)</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/scores.html">scores</a></span><span class="op">(</span><span class="va">vare_rda</span>, display <span class="op">=</span> <span class="st">"species"</span>, scaling <span class="op">=</span> <span class="va">scaling</span><span class="op">)</span></span>
<span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/scores.html">scores</a></span><span class="op">(</span><span class="va">vare_rda</span>, display <span class="op">=</span> <span class="st">"reg"</span>, scaling <span class="op">=</span> <span class="va">scaling</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, type <span class="op">=</span> <span class="st">"n"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, v <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">sites</span><span class="op">/</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.7</span>, col <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">species</span><span class="op">/</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"green"</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="fu">segments</span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span>, y0 <span class="op">=</span> <span class="fl">0</span>, x1 <span class="op">=</span> <span class="va">env</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="va">env</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">env</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-vare-rda-plot-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>On pourra effectuer une analyse de Kaiser-Guttmann ou de broken-stick de la même manière que précédemment. Étant une collection de régressions, une RDA est en mesure d’effectuer des tests statistiques sur les coefficients de la régression en utilisant des permutations pour tester la signification des coefficients et des axes d’une RDA. On doit néanmoins obligatoirement effectuer la RDA avec l’interface formule. La variable à gauche du <code>~</code> peut être une matrice ou un tableau, et celui de droite est défini dans <code>data</code>. Le <code>.</code> dans l’interface formule signifie “une combinaison linéaire de toutes les variables, sans interaction”.</p>
<div class="cell">
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vare_rda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/cca.html">rda</a></span><span class="op">(</span><span class="va">varespec</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">vareclr</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">perm_test_term</span> <span class="op">&lt;-</span> <span class="fu">anova</span><span class="op">(</span><span class="va">vare_rda</span>, by <span class="op">=</span> <span class="st">"term"</span><span class="op">)</span></span>
<span><span class="co">#perm_test_axis &lt;- anova(vare_rda, by = "axis")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La signification des axes est difficile à interpréter. Toutefois, celui des variables présente un intérêt.</p>
<div class="cell">
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">perm_test_term</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for rda under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

Model: rda(formula = varespec ~ N + P + K + Ca + Mg + S + Al + Fe + Mn + Zn + Mo + Fv + Baresoil + Humdepth + pH, data = vareclr, scale = FALSE)
         Df Variance      F Pr(&gt;F)   
N         1   216.13 4.8470  0.006 **
P         1   272.71 6.1159  0.005 **
K         1   194.97 4.3724  0.012 * 
Ca        1    24.92 0.5589  0.661   
Mg        1    52.61 1.1799  0.310   
S         1   100.07 2.2441  0.089 . 
Al        1   177.91 3.9900  0.008 **
Fe        1   118.59 2.6595  0.050 * 
Mn        1    25.96 0.5822  0.638   
Zn        1    35.81 0.8030  0.483   
Mo        1    23.51 0.5273  0.678   
Baresoil  1    98.64 2.2122  0.103   
Humdepth  1    43.59 0.9777  0.393   
pH        1    38.93 0.8730  0.447   
Residual  9   401.31                 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>La p-value est la probabilité que les pentes calculées pour les variables émergent de distributions dont la moyenne est nulle. Au seuil 0.05, les variables significatives sont (les clr de) l’azote, le phosphore, le potassium et l’aluminium.</p>
<p>Dans le cas des matrices d’abondance (ce n’est pas le cas de varespec, constituée de données de recouvrement), il est préférable avec les RDA de les transformer préalablement avec la transformation compositionnelle, de chord ou de Hellinger (<a href="08-explorer.html">chapitre&nbsp;<span>9</span></a>). Une autre option est d’effectuer une RDA sur des matrices d’association en passant par une analyse en coordonnées principales (<a href="http://www.jstor.org/stable/2657192">Legendre et Anderson, 1999</a>). Enfin, les données d’abondance à l’état brutes devraient plutôt passer utiliser une analyse canonique des corrélations.</p>
</section></section><section id="analyse-canonique-des-correspondances-acc" class="level4" data-number="10.4.2.3"><h4 data-number="10.4.2.3" class="anchored" data-anchor-id="analyse-canonique-des-correspondances-acc">
<span class="header-section-number">10.4.2.3</span> Analyse canonique des correspondances (ACC)</h4>
<p>L’analyse canonique des correspondances (<em>Canonical correspondance analysis</em>), ACC, a été à l’origine conçue pour étudier les liens entre des variables environnementales et l’abondance (décompte) ou l’occurrence (présence-absence) d’espèces (<a href="https://www.ohio.edu/plantbio/staff/mccarthy/multivariate/terBraak1986.pdf">ter Braak, 1986</a>). L’ACC est à la RDA ce que la CA est à l’ACP. Alors que la RDA préserve les distance euclidiennes entre variables dépendantes et indépendantes, l’ACC préserve les distances du <span class="math inline">\(\chi^2\)</span>. Tout comme l’AC, elle hérite du coup une propriété importante de la distance du <span class="math inline">\(\chi^2\)</span>: il y a davantage davantage d’importance aux espèces rares.</p>
<p>L’analyse des correspondances canoniques est souvent utilisée dans la littérature, mais dans bien des cas une RDA sur des données d’abondance transformées donnera des résultats davantage interprétables (<a href="https://doi.org/10.1007/s004420100716">Legendre et Gallagher, 2001</a>).</p>
<section id="application-8" class="level5" data-number="10.4.2.3.1"><h5 data-number="10.4.2.3.1" class="anchored" data-anchor-id="application-8">
<span class="header-section-number">10.4.2.3.1</span> Application</h5>
<p>Cet exemple d’application concerne des données d’abondance. Nous allons conséquemment utiliser une CCA avec la fonction <code>cca</code>, toujours avec le module vegan.</p>
<p>Les tableaux <a href="https://rdrr.io/cran/ade4/man/doubs.html"><code>doubs_fish</code> et <code>doubs_env</code></a> comprennent respectivement des données d’abondance d’espèces de poissons et dans différents environnements de la rivière Doubs (Europe) publiées dans <a href="https://www.worldcat.org/title/cours-deau-de-franche-comte-massif-du-jura-recherches-ecologiques-sur-le-reseau-hydrographique-du-doubs-essai-de-biotypologie/oclc/496763306">Verneaux. (1973)</a> et exportées du module <a href="https://rdrr.io/rforge/ade4/"><code>ade4</code></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"doubs"</span><span class="op">)</span></span>
<span><span class="va">doubs_fish</span> <span class="op">&lt;-</span> <span class="va">doubs</span><span class="op">$</span><span class="va">fish</span></span>
<span><span class="va">doubs_env</span> <span class="op">&lt;-</span> <span class="va">doubs</span><span class="op">$</span><span class="va">env</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sur le site no 8, aucun poisson n’a pas été observé. Les observations ne comprenant que des zéro doivent être préalablement retirées.</p>
<div class="cell">
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tot_spec</span> <span class="op">&lt;-</span> <span class="va">doubs_fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute</a></span><span class="op">(</span>tot_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">doubs_fish</span> <span class="op">&lt;-</span> <span class="va">doubs_fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">tot_spec</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using one column matrices in `filter()` was deprecated in dplyr 1.1.0.
ℹ Please use one dimensional logical vectors instead.</code></pre>
</div>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doubs_env</span> <span class="op">&lt;-</span> <span class="va">doubs_env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">tot_spec</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>De la même manière qu’avec la fonction <code>rda</code> de vegan, nous utilisons <code>cca</code> pour l’ACC.</p>
<div class="cell">
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doubs_cca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/cca.html">cca</a></span><span class="op">(</span><span class="va">doubs_fish</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">doubs_env</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comparons les résultats</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="va">doubs_cca</span>, scaling <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"text"</span>, main <span class="op">=</span> <span class="st">"CCA - Scaling 1 - Triplot de distance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="va">doubs_cca</span>, scaling <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"text"</span>, main <span class="op">=</span> <span class="st">"CCA - Scaling 2 - Triplot de corrélation"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-ordination_files/figure-html/apo-doubs-cca-ordiplot-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Triplot de distance (scaling 1)</strong>.</p>
<blockquote class="blockquote">
<ol type="1">
<li>La projection des variables réponse à angle droit sur les variables explicatives est une approximation de la réponse sur l’explication. (2) Un objet (site ou réponse) situé près d’une variable explicative est plus susceptible d’avoir le décompte <code>1</code>. (3) Les distances entre les variables (réponse et explicatives) approximent la distance du <span class="math inline">\(\chi^2\)</span> (traduction adaptée de <a href="http://www.springer.com/us/book/9781441979759">Borcard et al.&nbsp;(2011)</a>).</li>
</ol>
</blockquote>
<p><strong>Triplot de corrélation (scaling 2)</strong>.</p>
<blockquote class="blockquote">
<ol type="1">
<li>La valeur optmiale de l’espèce sur une variable environnementale quantitative peut être obtenue en projetant l’espèce à angle droit sur la variable. (2) Une espèce se trouvant près d’une variable environnementale est susceptible de se trouver en plus grande abondance aux sites de statut <code>1</code> pour cette variable. (3) Les distances n’approximent pas la distance du <span class="math inline">\(\chi^2\)</span> (traduction adaptée de <a href="http://www.springer.com/us/book/9781441979759">Borcard et al.&nbsp;(2011)</a>).</li>
</ol>
</blockquote>


</section></section></section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./08-explorer.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Explorer R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10-imputation.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Détection de valeurs aberrantes et imputation de données manquantes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Analyse et modélisation d’agroécosystèmes est construit avec <a href="https://quarto.org/">Quarto</a>.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Lien vers le <a href="https://essicolo.github.io/ecologie-mathematique-R/">manuel original</a>.</div>
  </div>
</footer>


</body></html>