<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Analyse et modélisation d’agroécosystèmes sur R - 13&nbsp; Introduction à l’autoapprentissage</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13-donnees-spatiales.html" rel="next">
<link href="./11-series-temporelles.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-autoapprentissage.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction à l'autoapprentissage</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Analyse et modélisation d’agroécosystèmes sur R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/chavalli/ecologie-mathematique-R/tree/h2024" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">La science des données avec R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-tableaux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Organisation des données et opérations sur des tableaux</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Science ouverte et reproductibilité</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction à Python</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07a-biostats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Biostatistiques</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07b-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction à l’analyse bayésienne en écologie</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-explorer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Explorer R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Association, partitionnement et ordination</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Détection de valeurs aberrantes et imputation de données manquantes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-series-temporelles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Les séries temporelles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-autoapprentissage.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction à l’autoapprentissage</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-donnees-spatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Les données géospatiales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-modelisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Modélisation de mécanismes écologiques</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#lexique" id="toc-lexique" class="nav-link active" data-scroll-target="#lexique"><span class="header-section-number">13.1</span> Lexique</a></li>
  <li>
<a href="#d%C3%A9marche" id="toc-démarche" class="nav-link" data-scroll-target="#d%C3%A9marche"><span class="header-section-number">13.2</span> Démarche</a>
  <ul class="collapse">
<li><a href="#pr%C3%A9traitement" id="toc-prétraitement" class="nav-link" data-scroll-target="#pr%C3%A9traitement"><span class="header-section-number">13.2.1</span> Prétraitement</a></li>
  <li><a href="#entra%C3%AEnement-et-test" id="toc-entraînement-et-test" class="nav-link" data-scroll-target="#entra%C3%AEnement-et-test"><span class="header-section-number">13.2.2</span> Entraînement et test</a></li>
  <li><a href="#sousapprentissage-et-surapprentissage" id="toc-sousapprentissage-et-surapprentissage" class="nav-link" data-scroll-target="#sousapprentissage-et-surapprentissage"><span class="header-section-number">13.2.3</span> Sousapprentissage et surapprentissage</a></li>
  <li><a href="#validation-crois%C3%A9e" id="toc-validation-croisée" class="nav-link" data-scroll-target="#validation-crois%C3%A9e"><span class="header-section-number">13.2.4</span> Validation croisée</a></li>
  <li><a href="#choix-de-lalgorithme-dapprentissage" id="toc-choix-de-lalgorithme-dapprentissage" class="nav-link" data-scroll-target="#choix-de-lalgorithme-dapprentissage"><span class="header-section-number">13.2.5</span> Choix de l’algorithme d’apprentissage</a></li>
  <li><a href="#d%C3%A9ploiement" id="toc-déploiement" class="nav-link" data-scroll-target="#d%C3%A9ploiement"><span class="header-section-number">13.2.6</span> Déploiement</a></li>
  </ul>
</li>
  <li><a href="#lautoapprentissage-en-r" id="toc-lautoapprentissage-en-r" class="nav-link" data-scroll-target="#lautoapprentissage-en-r"><span class="header-section-number">13.3</span> L’autoapprentissage en R</a></li>
  <li>
<a href="#algorithmes" id="toc-algorithmes" class="nav-link" data-scroll-target="#algorithmes"><span class="header-section-number">13.4</span> Algorithmes</a>
  <ul class="collapse">
<li><a href="#les-k-plus-proches-voisins" id="toc-les-k-plus-proches-voisins" class="nav-link" data-scroll-target="#les-k-plus-proches-voisins"><span class="header-section-number">13.4.1</span> Les <em>k</em> plus proches voisins</a></li>
  <li><a href="#les-arbres-d%C3%A9cisionnels" id="toc-les-arbres-décisionnels" class="nav-link" data-scroll-target="#les-arbres-d%C3%A9cisionnels"><span class="header-section-number">13.4.2</span> Les arbres décisionnels</a></li>
  <li><a href="#les-r%C3%A9seaux-neuronaux" id="toc-les-réseaux-neuronaux" class="nav-link" data-scroll-target="#les-r%C3%A9seaux-neuronaux"><span class="header-section-number">13.4.3</span> Les réseaux neuronaux</a></li>
  <li><a href="#les-processus-gaussiens" id="toc-les-processus-gaussiens" class="nav-link" data-scroll-target="#les-processus-gaussiens"><span class="header-section-number">13.4.4</span> Les processus gaussiens</a></li>
  <li><a href="#les-processus-gaussiens-en-r" id="toc-les-processus-gaussiens-en-r" class="nav-link" data-scroll-target="#les-processus-gaussiens-en-r"><span class="header-section-number">13.4.5</span> Les processus gaussiens en <code>R</code></a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-ia" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction à l’autoapprentissage</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><hr>
<hr>
<p>️&nbsp;<strong>Objectifs spécifiques</strong>:</p>
<p>À la fin de ce chapitre, vous</p>
<ul>
<li>saurez établir un plan de modélisation par autoapprentissage</li>
<li>saurez définir le sous-apprentissage et le surapprentissage</li>
<li>serez en mesure d’effectuer un autoapprentissage avec les techniques des <em>k</em>-proches voisins, les arbres de décision, les forêts aléatoires, les réseaux neuronaux et les processus gaussiens</li>
</ul>
<hr>
<p>Plusieurs cas d’espèces en sciences et génies peuvent être approchés en liant un variable avec une ou plusieurs autres à l’aide de régressions linéaires, polynomiales, sinusoïdales, exponentielle, sigmoïdales, <a href="https://dl.sciencesocieties.org/publications/aj/pdfs/107/2/786">etc</a>. Encore faut-il s’assurer que ces formes préétablies représentent le phénomène de manière fiable.</p>
<p>Lorsque la forme de la réponse est difficile à envisager, en particulier dans des cas non-linéaires ou impliquant plusieurs variables, on pourra faire appel à des modèles dont la structure n’est pas contrôlée par une équation rigide gouvernée par des paramètres (comme la pente ou l’intercept).</p>
<p>L’<strong>autoapprentissage</strong>, apprentissage automatique, ou <em>machine learning</em>, vise à détecter des structures complexes émergeant d’ensembles de données à l’aide des mathématiques et de processus automatisés afin de prédire l’émergence de futures occurrences. Comme ensemble de techniques empiriques, l’autoapprentissage est un cas particulier de l’<strong>intelligence artificielle</strong>, qui elle inclut aussi les mécanismes déterministes et des ensembles d’opérations logiques. Par exemple, les premiers ordinateurs à compétitionner aux échecs se basaient sur des règles de logique (si la reine noire est positionnée en c3 et qu’un le fou blanc est en position f6 et que … alors bouge la tour en g5 - j’écris n’importe quoi). Un jeu simple d’intelligence artificielle consiste à lancer une marche aléatoire, par exemple bouger à chaque pas d’une distance au hasard en x et y, puis de recalculer le pas s’il arrive dans une boîte définie (<a href="#fig-ml_random_walk">figure&nbsp;<span>13.1</span></a>). Dans les deux cas, il s’agit d’intelligence artificielle, mais pas d’autoapprentissage.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ml_random_walk" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="12-autoapprentissage_files/figure-html/fig-ml_random_walk-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;13.1: Petite tortue, n’entre pas dans la boîte!</figcaption></figure>
</div>
</div>
</div>
<p>L’autoapprentissage passera davantage par la simulation de nombreuses parties et dégagera la structure optimale pour l’emporter considérant les positions des pièces sur l’échiquier.</p>
<section id="lexique" class="level2" data-number="13.1"><h2 data-number="13.1" class="anchored" data-anchor-id="lexique">
<span class="header-section-number">13.1</span> Lexique</h2>
<p>L’autoapprentissage possède son jargon particulier. Puisque certains termes peuvent porter à confusion, voici quelques définitions de termes que j’utiliserai dans ce chapitre.</p>
<ul>
<li>
<strong>Réponse</strong>. La variable que l’on cherche à obtenir. Il peut s’agir d’une variable continue comme d’une variable catégorielle. On la nomme aussi la <em>cible</em>.</li>
<li>
<strong>Prédicteur</strong>. Une variable utilisée pour prédire une réponse. Les prédicteurs sont des variables continues. Les prédicteurs de type catégoriel doivent préalablement être dummifiés (voir chapitre 5). On nomme les prédicteurs les <em>entrées</em>.</li>
<li>
<strong>Apprentissage supervisé</strong> et <strong>non-supervisé</strong>. Si vous avez suivi le cours jusqu’ici, vous avez déjà utilisé des outils entrant dans la grande famille de l’apprentissage automatique. La régression linéaire, par exemple, vise à minimiser l’erreur sur la réponse en optimisant les coefficients de pente et l’intercept. Un apprentissage supervisé a une cible, comme c’est le cas de la régression linéaire. En revanche, un apprentissage non supervisé n’en a pas: on laisse l’algorithme le soin de détecter des structures intéressantes. Nous avons déjà utilisé cette approche. Pensez-y un peu… l’analyse en composante principale ou en coordonnées principales, ainsi que le partitionnement hiérarchique ou non, couverts au <a href="09-ordination.html">chapitre&nbsp;<span>10</span></a>, sont des exemples d’apprentissage non supervisé. En revanche, l’analyse de redondance a une réponse. L’analyse discriminante aussi, bien que sa réponse soit catégorielle. L’apprentissage non supervisé ayant déjà été couvert (sans le nommer) au <a href="09-ordination.html">chapitre&nbsp;<span>10</span></a>, ce chapitre ne s’intéresse qu’à l’apprentissage supervisé.</li>
<li>
<strong>Régression</strong> et <strong>Classification</strong>. Alors que la régression est un type d’apprentissage automatique pour les réponses continues, la classification vise à prédire une réponse catégorielle. Il existe des algorithmes uniquement application à la régression, uniquement applicables à la classification, et plusieurs autres adaptable aux deux situations.</li>
<li>
<strong>Données d’entraînement</strong> et <strong>données de test</strong>. Lorsque l’on génère un modèle, on désire qu’il sache comment réagir à ses prédicteurs. Cela se fait avec des données d’entraînement, sur lesquelles on <strong>calibre</strong> et <strong>valide</strong> le modèle. Les données de test servent à vérifier si le modèle est en mesure de prédire des réponses sur lesquelles il n’a pas été entraîné.</li>
<li>
<strong>Fonction de perte</strong>. Une fonction qui mesure l’erreur d’un modèle.</li>
</ul></section><section id="démarche" class="level2" data-number="13.2"><h2 data-number="13.2" class="anchored" data-anchor-id="démarche">
<span class="header-section-number">13.2</span> Démarche</h2>
<p>La première tâche est d’explorer les données, ce que nous avons couvert au chapitres <a href="03-tableaux.html"><span>3</span></a> et <a href="04-visualisation.html"><span>4</span></a>.</p>
<section id="prétraitement" class="level3" data-number="13.2.1"><h3 data-number="13.2.1" class="anchored" data-anchor-id="prétraitement">
<span class="header-section-number">13.2.1</span> Prétraitement</h3>
<p>Pour la plupart des techniques d’autoapprentissage, le choix de l’échelle de mesure est déterminant sur la modélisation subséquente. Par exemple, un algorithme basé sur la distance comme les <em>k</em> plus proches voisins ne mesurera pas les mêmes distances entre deux observations si l’on change l’unité de mesure d’une variable du mètre au kilomètre. Il est donc important d’effectuer, ou d’envisager la possibilité d’effectuer un prétraitement sur les données. Je vous réfère au <a href="08-explorer.html">chapitre&nbsp;<span>9</span></a> pour plus de détails sur le prétraitement.</p>
</section><section id="entraînement-et-test" class="level3" data-number="13.2.2"><h3 data-number="13.2.2" class="anchored" data-anchor-id="entraînement-et-test">
<span class="header-section-number">13.2.2</span> Entraînement et test</h3>
<p>Vous connaissez peut-être l’expression sportive “avoir l’avantage du terrain”. Il s’agit d’un principe prétendant que les athlètes performent mieux en terrain connu. Idem pour les modèles phénoménologiques. Il est possible qu’un modèle fonctionne très bien sur les données avec lesquelles il a été entraîné, mais très mal sur des données externes. De mauvaises prédictions effectuées à partir d’un modèle qui semblait bien se comporter peut mener à des décisions qui, pourtant prises de manière confiante, se révèlent fallacieuses au point d’aboutir à de graves conséquences. C’est pourquoi, <strong>en mode prédictif, on doit évaluer la précision et l’exactitude d’un modèle sur des données qui n’ont pas été utilisés dans son entraînement</strong>.</p>
<p>En pratique, il convient de séparer un tableau de données en deux: un tableau d’entraînement et un tableau de test. Il n’existe pas de standards sur la proportion à utiliser dans l’un et l’autre. Cela dépend de la prudence de l’analyse et de l’ampleur de son tableau de données. Dans certains cas, nous préférerons couper le tableau à 50%. Dans d’autres, nous préférerons réserver le deux-tiers des données pour l’entraînement, ou 70%, 75%. Rarement, toutefois, réservera-t-on moins plus de 50% et moins de 20% à la phase de test.</p>
<p>Si les données sont peu équilibrées (par exemple, on retrouve peu de données de l’espèce <span class="math inline">\(A\)</span>, que l’on retrouve peu de données à un pH inférieur à 5 ou que l’on a peu de données croisées de l’espèce <span class="math inline">\(A\)</span> à pH inférieur à 5), il y a un danger qu’une trop grande part, voire toute les données, se retrouvent dans le tableau d’entraînement (certaines situations ne seront ainsi pas testées) ou dans le tableau de test (certaines situations ne seront pas couvertes par le modèle). L’analyste doit s’assurer de séparer le tableau au hasard, mais de manière consciencieuse.</p>
</section><section id="sousapprentissage-et-surapprentissage" class="level3" data-number="13.2.3"><h3 data-number="13.2.3" class="anchored" data-anchor-id="sousapprentissage-et-surapprentissage">
<span class="header-section-number">13.2.3</span> Sousapprentissage et surapprentissage</h3>
<p>Une difficulté en modélisation phénoménologique est de discerner ce qui tient de la structure de ce qui tient du bruit. Lorsque l’on considère une structure comme du bruit, on est dans un cas de sousapprentissage. Lorsque, au contraire, on interprète du bruit comme une structure, on est en cas de surapprentissage. Les graphiques de la figure <a href="#fig-mesapprentissage">Figure&nbsp;<span>13.2</span></a> présentent ces deux cas, avec au centre un cas d’apprentissage conforme.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-mesapprentissage" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="12-autoapprentissage_files/figure-html/fig-mesapprentissage-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;13.2: Cas de figure de mésapprentissage. À gauche, sous-apprentissage. Au centre, apprentissage valide. À droite, surapprentissage.</figcaption></figure>
</div>
</div>
</div>
<p>Il est néanmoins difficile d’inspecter un modèle comprenant plusieurs entrées. On détectera le mésapprentissage lorsque la précision d’un modèle est lourdement altérée en phase de test. Une manière de limiter le <em>mésapprentissage</em> est d’avoir recours à la validation croisée.</p>
</section><section id="validation-croisée" class="level3" data-number="13.2.4"><h3 data-number="13.2.4" class="anchored" data-anchor-id="validation-croisée">
<span class="header-section-number">13.2.4</span> Validation croisée</h3>
<p>Souvent confondue avec le fait de séparer le tableau en phases d’entraînement et de test, la validation croisée est un principe incluant plusieurs algorithmes qui consistent à entraîner le modèle sur un échantillonnage aléatoire des données d’entraînement. La technique la plus utilisée est le <em>k-fold</em>, où l’on sépare aléatoirement le tableau d’entraînement en un nombre <em>k</em> de tableaux. À chaque étape de la validation croisée, on calibre le modèle sur tous les tableaux sauf un, puis on valide le modèle sur le tableau exclu. La performance du modèle en entraînement est jugée sur les validations.</p>
</section><section id="choix-de-lalgorithme-dapprentissage" class="level3" data-number="13.2.5"><h3 data-number="13.2.5" class="anchored" data-anchor-id="choix-de-lalgorithme-dapprentissage">
<span class="header-section-number">13.2.5</span> Choix de l’algorithme d’apprentissage</h3>
<p>Face aux <a href="https://topepo.github.io/caret/available-models.html">centaines d’algorithmes d’apprentissages qui vous sont offertes</a>, choisir l’algorithme (ou les algorithmes) adéquats pour votre problème n’est pas une tâche facile. Ce choix sera motivé par les tenants et aboutissants des algorithmes, votre expérience, l’expérience de la littérature, l’expérience de vos collègues, etc. À moins d’être particulièrement surdoué.e, il vous sera pratiquement impossible de maîtriser la mathématique de chacun d’eux. Une approche raisonnable est de tester plusieurs modèles, de retenir les modèles qui semblent les plus pertinents, et d’approfondir si ce n’est déjà fait la mathématique des options retenues. Ajoutons qu’il existe des algorithmes génétiques, qui ne sont pas couverts ici, qui permettent de sélectionner des modèles d’autoapprentissage optimaux. Un de ces algorithmes est offert par le module Python <a href="https://epistasislab.github.io/tpot/"><code>tpot</code></a>.</p>
</section><section id="déploiement" class="level3" data-number="13.2.6"><h3 data-number="13.2.6" class="anchored" data-anchor-id="déploiement">
<span class="header-section-number">13.2.6</span> Déploiement</h3>
<p>Nous ne couvrirons pas la phase de déploiement d’un modèle. Notons seulement qu’il est possible, en R, d’exporter un modèle dans un fichier <code>.Rdata</code>, qui pourra être chargé dans un autre environnement R. Cet environnement peut être une feuille de calcul comme une interface visuelle montée, par exemple, avec <a href="https://shiny.posit.co/">Shiny</a> (<a href="08-explorer.html">chapitre&nbsp;<span>9</span></a>).</p>
<hr>
<p>En résumé,</p>
<ol type="1">
<li>Explorer les données</li>
<li>Sélectionner des algorithmes</li>
<li>Effectuer un prétraitement</li>
<li>Créer un ensemble d’entraînement et un ensemble de test</li>
<li>Lisser les données sur les données d’entraînement avec validation croisée</li>
<li>Tester le modèle</li>
<li>Déployer le modèle</li>
</ol></section></section><section id="lautoapprentissage-en-r" class="level2" data-number="13.3"><h2 data-number="13.3" class="anchored" data-anchor-id="lautoapprentissage-en-r">
<span class="header-section-number">13.3</span> L’autoapprentissage en R</h2>
<p>Plusieurs options sont disponibles.</p>
<ol type="1">
<li>Les modules que l’on retrouve en R pour l’autoapprentissage sont nombreux, et parfois spécialisés. Il est possible de les utiliser individuellement.</li>
<li>Chacun de ces modules fonctionne à sa façon. Le module <strong><code>caret</code></strong> de R a été conçu pour donner accès à des centaines de fonctions d’autoapprentissage via une interface commune. <strong><code>caret</code></strong> est très efficace, mais prend de l’âge. Une refonte complète, nommée <a href="https://tidymodels.github.io/parsnip/"><strong><code>parsnip</code></strong></a> (panais en français) est en cours sous l’ombrelle du méta-module de modélisation <a href="https://github.com/tidymodels/tidymodels"><strong><code>tidymodels</code></strong></a>, mais n’est à ce jour pas encore aboutie.</li>
<li>Le module <strong><code>mlr3</code></strong>, connu ancienment comme <strong><code>mlr</code></strong> (<strong>M</strong>achine <strong>L</strong>earning in <strong>R</strong>), occupe sensiblement le même créneau que <strong><code>caret</code></strong>, mais utilise plutôt une approche par objets connectés. Le livre « <a href="https://mlr3book.mlr-org.com/">Applied machine learning using mlr3 in R</a> » disponible sur internet, offre une introduction à ce module avec des exemples pratiques.</li>
<li>En Python, le module <strong><code>scikit-learn</code></strong> offre un interface unique pour l’utilisation de nombreuses techniques d’autoapprentissage. Il est possible d’appeler des fonctions de Python à partir de R grâce au module <strong><code>reticulate</code></strong>.</li>
</ol>
<p>Dans ce chapitre, nous verrons comment fonctionnent certains algorithmes sélectionnés, puis nous les appliquerons avec le module respectif qui m’a semblé le plus approprié. Nous utiliserons <strong><code>caret</code></strong> ainsi que quelques outils de <strong><code>tidymodels</code></strong>, dont les recettes pour le prétraitement (module <strong><code>recipes</code></strong>).</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span> <span class="co"># évidemment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidymodels.tidymodels.org">"tidymodels"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.1.1 ──
✔ broom        1.0.5      ✔ rsample      1.2.0 
✔ dials        1.2.1      ✔ tune         1.1.2 
✔ infer        1.0.6      ✔ workflows    1.1.4 
✔ modeldata    1.3.0      ✔ workflowsets 1.0.1 
✔ parsnip      1.2.0      ✔ yardstick    1.3.0 
✔ recipes      1.0.10     
── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()
• Dig deeper into tidy modeling with R at https://www.tmwr.org</code></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/topepo/caret/">"caret"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice

Attaching package: 'caret'

The following objects are masked from 'package:yardstick':

    precision, recall, sensitivity, specificity

The following object is masked from 'package:purrr':

    lift</code></pre>
</div>
</div>
</section><section id="algorithmes" class="level2" data-number="13.4"><h2 data-number="13.4" class="anchored" data-anchor-id="algorithmes">
<span class="header-section-number">13.4</span> Algorithmes</h2>
<p>Il existe des centaines d’algorithmes d’autoapprentissage. Je n’en couvrirai que quatre, qui me semblent être appropriés pour la modélisation phénoménologique en agroécologie, et utilisables autant pour la régression et la classification.</p>
<ul>
<li>Les <em>k</em> plus proches voisins</li>
<li>Les arbres de décision</li>
<li>Les réseaux neuronaux</li>
<li>Les processus gaussiens</li>
</ul>
<section id="les-k-plus-proches-voisins" class="level3" data-number="13.4.1"><h3 data-number="13.4.1" class="anchored" data-anchor-id="les-k-plus-proches-voisins">
<span class="header-section-number">13.4.1</span> Les <em>k</em> plus proches voisins</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ml_les-voisons" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/11_les-voisins.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.3: &lt;&lt; Le… l’idée en arrière pour être… euh… simpliste, là c’est que c’est un peu de… euhmm… de la vitamine de vinyle.&gt;&gt; - Georges (<a href="https://youtu.be/-RpYi_Vuviw?t=6m40s">Les voisins</a>, une pièce de Claude Meunier).</figcaption></figure>
</div>
</div>
</div>
<p>Pour dire comme Georges, le… l’idée en arrière des KNN pour être… euh… <em>simpliste</em>, c’est qu’un objet va ressembler à ce qui se trouve dans son voisinage. Les KNN se basent en effet sur une métrique de distance pour rechercher un nombre <em>k</em> de points situés à proximité de la mesure. Les <em>k</em> points les plus proches sont retenus, <em>k</em> étant un entier non nul à optimiser. Un autre paramètre parfois utilisé est la distance maximale des voisins à considérer: un voisin trop éloigné pourra être discarté. La réponse attribuée à la mesure est calculée à partir de la réponse des <em>k</em> voisins retenus. Dans le cas d’une régression, on utiliser généralement la moyenne. Dans le cas de la classification, la mesure prendra la catégorie qui sera la plus présente chez les <em>k</em> plus proches voisins.</p>
<p>L’algorithme des <em>k</em> plus proches voisins est relativement simple à comprendre. Certains pièges sont, de même, peuvent être contournés facilement. Imaginez que vous rechercher les points les plus rapprochés dans un système de coordonnées géographiques où les coordonnées <span class="math inline">\(x\)</span> sont exprimées en mètres et les coordonnées <span class="math inline">\(y\)</span>, en centimètres. Vous y projetez trois points (<a href="#fig-ml_knn1">figure&nbsp;<span>13.4</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ml_knn1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="12-autoapprentissage_files/figure-html/fig-ml_knn1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;13.4: Distances entre les points pour utilisation avec les KNN</figcaption></figure>
</div>
</div>
</div>
<p>Techniquement la distance A-B est 100 fois plus élevée que la distance A-C, mais l’algorithme ne se soucie pas de la métrique que vous utilisez (<a href="#fig-ml_knn1">figure&nbsp;<span>13.4</span></a>). Il est primordial dans ce cas d’utiliser la même métrique. Cette stratégie est évidente lorsque les variables sont comparables. C’est rarement le cas, que ce soit lorsque l’on compare des dimensions physionomiques (la longueur d’une phalange ou celle d’un fémur) mais lorsque les variables incluent des mélanges de longueurs, des pH, des décomptes, etc., il est important de bien identifier la métrique et le type de distance qu’il convient le mieux d’utiliser. En outre, la standardisation des données à une moyenne de zéro et à un écart-type de 1 est une approche couramment utilisée.</p>
<section id="exemple-dapplication" class="level4" data-number="13.4.1.1"><h4 data-number="13.4.1.1" class="anchored" data-anchor-id="exemple-dapplication">
<span class="header-section-number">13.4.1.1</span> Exemple d’application</h4>
<p>Pour ce premier exemple, je présenterai un cheminement d’autoapprentissage, du prétraitement au test. Nous allons essayer de classer les espèces de dragon selon leurs dimensions.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ml_dragons" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/11_dragon.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;13.5: Dimensions mesurés sur les dragons capturés.</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dragons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/11_dragons.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 47 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (1): Species
dbl (12): V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, ID

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Assurons-nous que les données sont toutes à l’échelle. Nous pourrions utiliser la fonction <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code>. Toutefois, si je capture un nouveau dragon, je n’aurai pas l’information pour convertir mes nouvelles dimensions dans la même métrique que celle utilisée pour lisser mon modèle. Prenez donc soin de conserver la moyenne et l’écart-type pour subséquemment calculer des mises à l’échelle.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dim_means</span> <span class="op">&lt;-</span> <span class="va">dragons</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"V"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dim_sds</span> <span class="op">&lt;-</span> <span class="va">dragons</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"V"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="va">sd</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dragons_sc</span> <span class="op">&lt;-</span> <span class="va">dragons</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"V"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="va">dragons</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Séparons les données en entraînement (<code>_tr</code>) et en test (<code>_te</code>) avec une proportion 70/30 (<code>p = 0.7</code>). Il est essentiel d’utiliser <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> pour s’assurer que la partition soit la même à chaque session de code (pour la reproductibilité) - j’ai l’habitude de taper n’importe quel numéro à environ 6 chiffres, mais lors de publications, je vais sur <a href="https://www.random.org/">random.org</a> et je génère un numéro au hasard, sans biais.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">68017</span><span class="op">)</span></span>
<span><span class="va">id_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span><span class="va">dragons_sc</span><span class="op">$</span><span class="va">Species</span>, p <span class="op">=</span> <span class="fl">0.7</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">dragons_tr</span> <span class="op">&lt;-</span> <span class="va">dragons_sc</span><span class="op">[</span><span class="va">id_tr</span>, <span class="op">]</span></span>
<span><span class="va">dragons_te</span> <span class="op">&lt;-</span> <span class="va">dragons_sc</span><span class="op">[</span><span class="op">-</span><span class="va">id_tr</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Avant de lancer nos calculs, allons vois sur la <a href="https://topepo.github.io/caret/available-models.html">page de <code>caret</code></a> les modules qui effectuent des KNN pour la classification. Nous trouvons <strong><code>knn</code></strong> et <strong><code>kknn</code></strong>. Si les modules nécessaires aux calculs ne sont pas installés sur votre ordinateur, <strong><code>caret</code></strong> vous demandera de les installer. Prenons le module <strong><code>kknn</code></strong>, qui demande le paramètre <code>kmax</code>, soit le nombre de voisins à considérer, ainsi qu’un paramètre de <code>distance</code> (spécifiez 1 pour la distance de Mahattan et 2 pour la distance euclidienne), et un <code>kernel</code>, qui est une fonction pour mesurer la distance. Comment choisir les bons paramètres? Une manière de procéder est de créer une grille de paramètres.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kknn_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>kmax <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>                         distance <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>                         kernel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rectangular"</span>, <span class="st">"gaussian"</span>, <span class="st">"optimal"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les noms des colonnes de la grille doivent correspondre aux noms des paramètres du modèle. Nous allons modéliser avec une validation croisée à 5 plis.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"repeatedcv"</span>, repeats <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour finalement lisser le modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8961704</span><span class="op">)</span></span>
<span><span class="va">clf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>             data <span class="op">=</span> <span class="va">dragons_tr</span>,</span>
<span>             method <span class="op">=</span> <span class="st">"kknn"</span>,</span>
<span>             tuneGrid <span class="op">=</span> <span class="va">kknn_grid</span>,</span>
<span>             trainControl <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span></span>
<span><span class="va">clf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>k-Nearest Neighbors 

34 samples
11 predictors
 5 classes: 'Dragon de caverne', 'Dragon de feu', 'Dragon de mer', 'Dragon de pierre', 'Dragon de saturne' 

No pre-processing
Resampling: Bootstrapped (25 reps) 
Summary of sample sizes: 34, 34, 34, 34, 34, 34, ... 
Resampling results across tuning parameters:

  kmax  distance  kernel       Accuracy   Kappa    
  3     1         rectangular  0.8914566  0.8572135
  3     1         gaussian     0.8914566  0.8572135
  3     1         optimal      0.8914566  0.8572135
  3     2         rectangular  0.8601133  0.8164023
  3     2         gaussian     0.8601133  0.8164023
  3     2         optimal      0.8601133  0.8164023
  4     1         rectangular  0.8914566  0.8572135
  4     1         gaussian     0.8914566  0.8572135
  4     1         optimal      0.8914566  0.8572135
  4     2         rectangular  0.8528406  0.8070909
  4     2         gaussian     0.8601133  0.8164023
  4     2         optimal      0.8601133  0.8164023
  5     1         rectangular  0.8881233  0.8533711
  5     1         gaussian     0.8881233  0.8533711
  5     1         optimal      0.8914566  0.8572135
  5     2         rectangular  0.8528406  0.8071905
  5     2         gaussian     0.8601133  0.8165018
  5     2         optimal      0.8601133  0.8164023
  6     1         rectangular  0.8881233  0.8533711
  6     1         gaussian     0.8881233  0.8533711
  6     1         optimal      0.8914566  0.8572135
  6     2         rectangular  0.8528406  0.8071905
  6     2         gaussian     0.8601133  0.8165018
  6     2         optimal      0.8601133  0.8164023

Accuracy was used to select the optimal model using the largest value.
The final values used for the model were kmax = 6, distance = 1 and kernel
 = optimal.</code></pre>
</div>
</div>
<p>Nous obtenons les paramètres du modèle optimal. Prédisons l’espèce de dragons selon ses dimensions pour chacun des tableaux.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">clf</span><span class="op">)</span></span>
<span><span class="va">pred_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">clf</span>, newdata <span class="op">=</span> <span class="va">dragons_te</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Une manière d’évaluer la prédiction est d’afficher un tableau de contingence.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dragons_tr</span><span class="op">$</span><span class="va">Species</span>, <span class="va">pred_tr</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   pred_tr
                    Dragon de caverne Dragon de feu Dragon de mer
  Dragon de caverne                 6             0             0
  Dragon de feu                     0             7             0
  Dragon de mer                     0             0             7
  Dragon de pierre                  0             0             0
  Dragon de saturne                 0             0             0
                   pred_tr
                    Dragon de pierre Dragon de saturne
  Dragon de caverne                0                 0
  Dragon de feu                    0                 0
  Dragon de mer                    0                 0
  Dragon de pierre                 7                 0
  Dragon de saturne                0                 7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dragons_te</span><span class="op">$</span><span class="va">Species</span>, <span class="va">pred_te</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   pred_te
                    Dragon de caverne Dragon de feu Dragon de mer
  Dragon de caverne                 2             0             0
  Dragon de feu                     0             2             0
  Dragon de mer                     0             0             3
  Dragon de pierre                  0             0             0
  Dragon de saturne                 0             0             0
                   pred_te
                    Dragon de pierre Dragon de saturne
  Dragon de caverne                0                 0
  Dragon de feu                    0                 0
  Dragon de mer                    0                 0
  Dragon de pierre                 3                 0
  Dragon de saturne                1                 2</code></pre>
</div>
</div>
<p>Les espèces de dragon sont toutes bien classées tant entraînement qu’en test (c’est rarement le cas dans les situations réelles).</p>
</section></section><section id="les-arbres-décisionnels" class="level3" data-number="13.4.2"><h3 data-number="13.4.2" class="anchored" data-anchor-id="les-arbres-décisionnels">
<span class="header-section-number">13.4.2</span> Les arbres décisionnels</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/11_Entmoot.jpg" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Les Ents, tiré du film le Seigneur des anneaux, qui prennent trop de temps avant de se décider - paradoxalement, les arbres de décisions sont dotés d’algorithmes rapides.</figcaption></figure>
</div>
</div>
</div>
<p>Un arbre décisionnel est une collection hiérarchisée de décisions, le plus souvent binaires. Chaque embranchement est un test à vrai ou faux sur une variable. La réponse, que ce soit une catégorie ou une valeur numérique, se trouve au bout de la dernière branche. Les suites de décisions sont organisées de manière à ce que la précision de la réponse soit optimisée. Ils ont l’avantage de pouvoir être exprimés en un schéma simple et imprimable.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://www.jeremyjordan.me/content/images/2017/03/Screen-Shot-2017-03-11-at-10.15.37-PM.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Exemple d’arbre de décision, tiré du <a href="https://www.jeremyjordan.me/decision-trees/">blogue de Jeremy Jordon</a>.</figcaption></figure>
</div>
</div>
</div>
<p>Les arbres sont notamment paramétrés par le nombre maximum d’embranchements, qui s’il est trop élevé peut mener à du surapprentissage. <a href="https://topepo.github.io/caret/available-models.html">Il existe de nombreux algorithmes d’arbres de décision</a>.</p>
<p>Une collection d’arbres devient une forêt. Les forêts aléatoires (<em>random forest</em>) sont une catégorie d’algorithmes composés de plusieurs arbres de décision optimisés sur des données répliquées aléatoirement par <em>bagging</em>. Allons-y par étape. À partir des données existantes composées de <em>n</em> observations (donc <em>n</em> lignes) sélectionnées pour l’entraînement, échantillonnons au hasard <em>avec remplacement</em> un nombre <em>n</em> de nouvelles observations. Le remplacement implique qu’on retrouvera fort probablement dans notre nouveau tableau des lignes identiques. Lissons un arbre sur notre tableau aléatoire. Effectuons un nouveau tirage, puis un autre arbre. Puis encore, et encore, disons 10 fois. Nous obtiendrons une forêt de 10 arbres. Pour une nouvelle observation à prédire, nous obtenons donc 10 prédictions, sur lesquelles nous pouvons effectuer un moyenne s’il s’agit d’une variable numérique, ou bien prenons la catégorie la plus souvent prédite dans le cas d’une classification. Les forêts aléatoires peuvent être constitués de 10, 100, 1000 arbres: autant qu’il en est nécessaire.</p>
<section id="exemple-dapplication-1" class="level4" data-number="13.4.2.1"><h4 data-number="13.4.2.1" class="anchored" data-anchor-id="exemple-dapplication-1">
<span class="header-section-number">13.4.2.1</span> Exemple d’application</h4>
<p>Utilisons toujours nos données de dimensions de dragons. Bien qu’il en existe plusieurs, le module conventionnel pour effectuer un arbre de décision est <strong><code>rpart2</code></strong>. <a href="https://topepo.github.io/caret/available-models.html">Sur la page de <strong><code>caret</code></strong></a>, nous trouvons <strong><code>rpart2</code></strong>, apte pour les classifications et les régressions, <a href="https://topepo.github.io/caret/train-models-by-tag.html#random-forest">qui n’a besoin que du paramètre <code>maxdepth</code></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rpart2_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>maxdepth <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="co"># expand_grid n'est pas nécessaire ici</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Prenons 5 plis encore une fois.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"repeatedcv"</span>, repeats <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour finalement lisser le modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3468973</span><span class="op">)</span></span>
<span><span class="va">clf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>             data <span class="op">=</span> <span class="va">dragons_tr</span>,</span>
<span>             method <span class="op">=</span> <span class="st">"rpart2"</span>,</span>
<span>             tuneGrid <span class="op">=</span> <span class="va">rpart2_grid</span><span class="op">)</span></span>
<span><span class="va">clf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CART 

34 samples
11 predictors
 5 classes: 'Dragon de caverne', 'Dragon de feu', 'Dragon de mer', 'Dragon de pierre', 'Dragon de saturne' 

No pre-processing
Resampling: Bootstrapped (25 reps) 
Summary of sample sizes: 34, 34, 34, 34, 34, 34, ... 
Resampling results across tuning parameters:

  maxdepth  Accuracy   Kappa    
   3        0.4162868  0.2872798
   4        0.4162868  0.2872798
   5        0.4162868  0.2872798
   6        0.4162868  0.2872798
   7        0.4162868  0.2872798
   8        0.4162868  0.2872798
   9        0.4162868  0.2872798
  10        0.4162868  0.2872798

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was maxdepth = 3.</code></pre>
</div>
</div>
<p>Nous obtenons les paramètres du modèle optimal: <code>maxdepth = 3</code> - puisque c’est à la limite inférieure de la grille, mieux vaudrait étendre la grille, mais passons pour l’exemple. Comme je l’ai mentionné, un arbre de décision est un outil convivial à visualiser.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clf</span><span class="op">$</span><span class="va">finalModel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">clf</span><span class="op">$</span><span class="va">finalModel</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-tree-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ou en plus beau, je vous laisse essayer.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://rattle.togaware.com/">"rattle"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rattle/man/fancyRpartPlot.html">fancyRpartPlot</a></span><span class="op">(</span><span class="va">clf</span><span class="op">$</span><span class="va">finalModel</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tout comme pour les KNN, prédisons l’espèce de dragons selon ses dimensions pour chacun des tableaux.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">clf</span><span class="op">)</span></span>
<span><span class="va">pred_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">clf</span>, newdata <span class="op">=</span> <span class="va">dragons_te</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En ce qui a trait aux tableaux de contingence…</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dragons_tr</span><span class="op">$</span><span class="va">Species</span>, <span class="va">pred_tr</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   pred_tr
                    Dragon de caverne Dragon de feu Dragon de mer
  Dragon de caverne                 0             0             0
  Dragon de feu                     0             7             0
  Dragon de mer                     0             0             7
  Dragon de pierre                  0             0             0
  Dragon de saturne                 0             0             0
                   pred_tr
                    Dragon de pierre Dragon de saturne
  Dragon de caverne                0                 6
  Dragon de feu                    0                 0
  Dragon de mer                    0                 0
  Dragon de pierre                 7                 0
  Dragon de saturne                0                 7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dragons_te</span><span class="op">$</span><span class="va">Species</span>, <span class="va">pred_te</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   pred_te
                    Dragon de caverne Dragon de feu Dragon de mer
  Dragon de caverne                 0             1             0
  Dragon de feu                     0             2             0
  Dragon de mer                     0             0             3
  Dragon de pierre                  0             0             0
  Dragon de saturne                 0             0             0
                   pred_te
                    Dragon de pierre Dragon de saturne
  Dragon de caverne                0                 1
  Dragon de feu                    0                 0
  Dragon de mer                    0                 0
  Dragon de pierre                 3                 0
  Dragon de saturne                0                 3</code></pre>
</div>
</div>
<p>Les espèces de dragon sont toutes bien classées en entraînement et en test… sauf pour les dragons de caverne, qui (l’avez-vous remarquez?) n’apparaissent pas dans l’arbre de décision!</p>
<p>Le module <strong><code>caret</code></strong> vient avec la fonction <code><a href="https://rdrr.io/pkg/caret/man/varImp.html">varImp()</a></code> qui offre une appréciation de l’importance des variables dans le modèle final. La notion d’importance varie d’un modèle à l’autre, et reste à ce jour mal documenté. Mieux vaut en examiner les tenants et aboutissants avant d’interpréter excessivement la sortie de cette fonction.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html">varImp</a></span><span class="op">(</span><span class="va">clf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-tree-varimp-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On pourra effectuer de la même manière une forêt aléatoire, mais cette fois-ci avec le module <strong><code>rf</code></strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3468973</span><span class="op">)</span></span>
<span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"repeatedcv"</span>, repeats <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">clf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>             data <span class="op">=</span> <span class="va">dragons_tr</span>,</span>
<span>             method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span><span class="va">clf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

34 samples
11 predictors
 5 classes: 'Dragon de caverne', 'Dragon de feu', 'Dragon de mer', 'Dragon de pierre', 'Dragon de saturne' 

No pre-processing
Resampling: Bootstrapped (25 reps) 
Summary of sample sizes: 34, 34, 34, 34, 34, 34, ... 
Resampling results across tuning parameters:

  mtry  Accuracy   Kappa    
   2    0.9018266  0.8776655
   6    0.9555287  0.9441745
  11    0.9524518  0.9401765

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was mtry = 6.</code></pre>
</div>
</div>
<p>Et les résultats.</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">clf</span><span class="op">)</span></span>
<span><span class="va">pred_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">clf</span>, newdata <span class="op">=</span> <span class="va">dragons_te</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dragons_te</span><span class="op">$</span><span class="va">Species</span>, <span class="va">pred_te</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   pred_te
                    Dragon de caverne Dragon de feu Dragon de mer
  Dragon de caverne                 2             0             0
  Dragon de feu                     0             2             0
  Dragon de mer                     0             0             3
  Dragon de pierre                  0             0             0
  Dragon de saturne                 0             0             0
                   pred_te
                    Dragon de pierre Dragon de saturne
  Dragon de caverne                0                 0
  Dragon de feu                    0                 0
  Dragon de mer                    0                 0
  Dragon de pierre                 3                 0
  Dragon de saturne                0                 3</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dragons_tr</span><span class="op">$</span><span class="va">Species</span>, <span class="va">pred_tr</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   pred_tr
                    Dragon de caverne Dragon de feu Dragon de mer
  Dragon de caverne                 6             0             0
  Dragon de feu                     0             7             0
  Dragon de mer                     0             0             7
  Dragon de pierre                  0             0             0
  Dragon de saturne                 0             0             0
                   pred_tr
                    Dragon de pierre Dragon de saturne
  Dragon de caverne                0                 0
  Dragon de feu                    0                 0
  Dragon de mer                    0                 0
  Dragon de pierre                 7                 0
  Dragon de saturne                0                 7</code></pre>
</div>
</div>
<p>Notez que les forêts aléatoires ne génère par de visuel.</p>
</section></section><section id="les-réseaux-neuronaux" class="level3" data-number="13.4.3"><h3 data-number="13.4.3" class="anchored" data-anchor-id="les-réseaux-neuronaux">
<span class="header-section-number">13.4.3</span> Les réseaux neuronaux</h3>
<p>Après les KNN et les <em>random forests</em>, nous passons au domaine plus complexe des réseaux neuronaux. Le terme <em>réseau neuronal</em> est une métaphore liée à une perception que l’on avait du fonctionnement du cerveau humain lorsque la technique des réseaux neuronaux a été développée dans les années 1950. Un réseau neuronal comprend une série de boîtes d’entrées liée à des fonctions qui transforment et acheminent successivement l’information jusqu’à la sortie d’une ou plusieurs réponses. Il existe plusieurs formes de réseaux neuronaux, dont la plus simple manifestation est le <em>perceptron multicouche</em>. Dans l’exemple de la <a href="#fig-ml_nn1">figure&nbsp;<span>13.6</span></a>, on retrouve 4 variables d’entrée et trois variables de sortie entre lesquelles on retrouve 5 couches dont le nombre de neurones varient entre 3 et 6.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ml_nn1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/11_deep_neural_network.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;13.6: Réseau neuronal schématisé, Source: <a href="https://www.neuraldesigner.com/">Neural designer</a>.</figcaption></figure>
</div>
</div>
</div>
<p>Entre la première couche de neurones (les variables prédictives) et la dernière couche (les variables réponse), on retrouve des <em>couches cachées</em>. Chaque neurone est relié à tous les neurones de la couche suivante.</p>
<p>Les liens sont des poids, qui peuvent prendre des valeurs dans l’ensemble des nombres réels. À chaque neurone suivant la première couche, on fait la somme des poids multipliés par la sortie du neurone. Le nombre obtenu entre dans chaque neurone de la couche. Le neurone est une fonction, souvent très simple, qui transforme le nombre. La fonction plus utilisée est probablement la fonction ReLU, pour <em>rectified linear unit</em>, qui expulse le même nombre aux neurones de la prochaine couche s’il est positif: sinon, il expulse un zéro.</p>
<p><strong>Exercice</strong>. Si tous les neurones sont des fonctions ReLU, calculez la sortie de ce petit réseau neuronal.</p>
<p><img src="images/11_nn_ex1_Q.jpg" width="600px"></p>
<p>Vous trouverez la réponse sur l’image <code>images/11_nn_ex1_R.jpg</code>.</p>
<p>Il est aussi possible d’ajouter un <em>biais</em> à chaque neurone, qui est un nombre réel additionné à la somme des neurones pondérée par les poids.</p>
<p>L’optimisation les poids pour chaque lien et les biais pour chaque neurone (grâce à des algorithmes dont le fonctionnement sort du cadre de ce cours) constitue le processus d’apprentissage. Avec l’aide de logiciels et de modules spécialisés, la construction de réseaux de centaines de neurones organisés en centaines de couches vous permettra de capter des patrons complexes dans des ensembles de données.</p>
<p>Vous avez peut-être déjà entendu parler d’apprentissage profond (ou <em>deep learning</em>). Il s’agit simplement d’une appellation des réseaux neuronaux modernisé pour insister sur la présence de nombreuses couches de neurones. C’est un terme à la mode.</p>
<section id="les-réseaux-neuronaux-sur-r-avec-neuralnet" class="level4" data-number="13.4.3.1"><h4 data-number="13.4.3.1" class="anchored" data-anchor-id="les-réseaux-neuronaux-sur-r-avec-neuralnet">
<span class="header-section-number">13.4.3.1</span> Les réseaux neuronaux sur R avec <strong><code>neuralnet</code></strong>
</h4>
<p>Plusieurs modules sont disponibles sur R pour l’apprentissage profond. Certains utilisent le module <a href="https://github.com/h2oai/h2o-3">H2O.ia</a>, propulsé en Java, d’autres utilisent plutôt <a href="https://keras.rstudio.com/">Keras</a>, propulsé en Python par l’intermédiaire de <a href="https://www.tensorflow.org/">Tensorflow</a>. J’ai une préférence pour Keras, puisqu’il supporte les réseaux neuronaux classiques (perceptrons multicouche) autant que convolutifs ou récurrents. Keras pourrait néanmoins être difficile à installer sur Windows, où Python ne vient pas par défaut. Sur Windows, Keras ne fonctionne qu’avec Anaconda: vous devez donc installez <a href="https://www.anaconda.com/download/#windows">Anaconda ou Miniconda</a> (Miniconda offre une installation minimaliste).</p>
<p>Donc, pour ce cours, nous utiliserons le module <strong><code>neuralnet</code></strong>. Il est possible de l’utilser grâce à l’interface de <strong><code>caret</code></strong>, mais son utilisation directe permet davantage de flexibilité. Chargeons les données d’iris.</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bips-hb/neuralnet">"neuralnet"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'neuralnet'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    compute</code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Prenons soin de segmenter nos données en entraînement et en test.</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8453668</span><span class="op">)</span></span>
<span><span class="va">iris_tr_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, p <span class="op">=</span> <span class="fl">0.75</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons ainsi créer nos tableaux d’entraînement et de test pour les variables prédictives.</p>
<p>Les réseaux neuronaux sont aptes à générer des sorties multiples. Nous désirons prédire une catégorie, et <strong><code>neuralnet</code></strong> ne s’occupe pas de les transformer de facto. Lors de la prédiction d’une catégorie, nous devons générer des sorties multiples qui permettront de décider de l’appartenance exclusive à une catégorie ou une autre. Nous avons abordé l’encodage catégoriel aux chapitres <a href="07a-biostats.html"><span>7</span></a> et <a href="08-explorer.html"><span>9</span></a>. C’est ce que nous ferons ici.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">species_oh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Species</span>, <span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">species_oh</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="va">iris_oh</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">species_oh</span><span class="op">)</span></span>
<span><span class="va">iris_tr</span> <span class="op">&lt;-</span> <span class="va">iris_oh</span><span class="op">[</span><span class="va">iris_tr_index</span>, <span class="op">]</span></span>
<span><span class="va">iris_te</span> <span class="op">&lt;-</span> <span class="va">iris_oh</span><span class="op">[</span><span class="op">-</span><span class="va">iris_tr_index</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lançons le réseau neuronal avec l’interface-formule de R (neuralnet n’accepte pas le <code>.</code> pour indiquer <em>prend toutes les variables à l’exeption de celles utilisées en y</em>): nous allons les inclure à la main. L’argument <code>hidden</code> est un vecteur qui indique le nombre de neurones pour chaque couche. L’argument <code>linear.input</code> indique si l’on désire travailler en régression (<code>linear.output = TRUE</code>) ou en classification (<code>linear.output = FALSE</code>). Lorsque les données sont nombreuses, patience, le calcul prend pas mal de temps. Dans ce cas-ci, nous avons un tout petit tableau.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html">neuralnet</a></span><span class="op">(</span><span class="va">setosa</span> <span class="op">+</span> <span class="va">versicolor</span> <span class="op">+</span> <span class="va">virginica</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">+</span> <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>,</span>
<span>                data <span class="op">=</span> <span class="va">iris_tr</span>, </span>
<span>                hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                act.fct <span class="op">=</span> <span class="st">"tanh"</span>,</span>
<span>                linear.output <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Un réseau neuronal peu complexe peut être lisible.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">nn</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il n’existe pas de règle stricte sur le nombre de couche et le nombre de nœuds par couche. Il est néanmoins conseillé de générer d’abord un modèle simple, puis au besoin de le complexifier graduellement en terme de nombre de nœuds, puis de nombre de couches. Si vous désirez aller plus loin et utiliser keras, le module <a href="https://autokeras.com/"><code>autokeras</code></a>, disponible seulement en Python, est conçu pour optimiser un modèle Keras.</p>
<p>La sortie du réseau neuronal est une valeur près de 1 ou une valeur près de 0. Voici une manière de générer un vecteur catégoriel.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">compute_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/compute.html">compute</a></span><span class="op">(</span><span class="va">nn</span>, <span class="va">iris_te</span><span class="op">)</span></span>
<span><span class="va">pred_te</span> <span class="op">&lt;-</span> <span class="va">compute_te</span><span class="op">$</span><span class="va">net.result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">1</span>, <span class="va">which.max</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">[</span><span class="va">.</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if
`.name_repair` is omitted as of tibble 2.0.0.
ℹ Using compatibility `.name_repair`.</code></pre>
</div>
</div>
<p>La fonction <code><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">caret::confusionMatrix()</a></code> permet de générer les statistiques du modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="va">iris_te</span><span class="op">$</span><span class="va">Species</span>, <span class="va">pred_te</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

            Reference
Prediction   setosa versicolor virginica
  setosa         12          0         0
  versicolor      1         10         1
  virginica       0          0        12

Overall Statistics
                                          
               Accuracy : 0.9444          
                 95% CI : (0.8134, 0.9932)
    No Information Rate : 0.3611          
    P-Value [Acc &gt; NIR] : 2.421e-13       
                                          
                  Kappa : 0.9167          
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: setosa Class: versicolor Class: virginica
Sensitivity                 0.9231            1.0000           0.9231
Specificity                 1.0000            0.9231           1.0000
Pos Pred Value              1.0000            0.8333           1.0000
Neg Pred Value              0.9583            1.0000           0.9583
Prevalence                  0.3611            0.2778           0.3611
Detection Rate              0.3333            0.2778           0.3333
Detection Prevalence        0.3333            0.3333           0.3333
Balanced Accuracy           0.9615            0.9615           0.9615</code></pre>
</div>
</div>
<p>Encore une fois, c’est rarement le cas mais nous obtenons une classification parfaite.</p>
</section><section id="pour-aller-plus-loin" class="level4" data-number="13.4.3.2"><h4 data-number="13.4.3.2" class="anchored" data-anchor-id="pour-aller-plus-loin">
<span class="header-section-number">13.4.3.2</span> Pour aller plus loin</h4>
<p>En une heure divisée en <a href="https://www.youtube.com/playlist?list=PLZHQObOWTQDNU6R1_67000Dx_ZCJB-3pi">4 vidéos</a>, Grant Sanderson explique les réseaux neuronaux de manière intuitive. En ce qui a trait à Keras, je recommande le livre <a href="https://www.safaribooksonline.com/library/view/deep-learning-with/9781617295546/?ar">Deep learning with R, de François Allaire</a>, auquel vous avez accès avec un IDUL de l’Université Laval. Si vous vous sentez à l’aise à utiliser Keras avec le langage Python, je vous recommande le cours gratuit en ligne <a href="https://www.youtube.com/watch?v=sRy26qWejOI&amp;list=PLjy4p-07OYzulelvJ5KVaT2pDlxivl_BN"><em>Applications of deep neural networks</em>, de Jeff Heaton</a>.</p>
<p>Des types de réseaux neuronaux spécialisés ont été développés. Je les présente sans aller dans les détails.</p>
<ul>
<li>
<strong>Réseaux neuronaux convolutif</strong>. Ce type de réseau neuronal est surtout utilisé en reconnaissance d’image. Les couches de neurones convolutifs possèdent, en plus des fonctions des perceptrons classiques, des filtres permettant d’intégrer les variables descriptives connexes à l’observation: dans le cas d’une image, il s’agit de scanner les pixels au pourtour du pixel traité. <a href="https://www.youtube.com/watch?v=YRhxdVk_sIs">Une brève introduction sur Youtube</a>.</li>
<li>
<strong>Réseaux neuronaux récurrents</strong>. Prédire des occurrences futures à partir de séries temporelles implique que la réponse au temps t dépend non seulement de conditions externes, mais aussi de la réponse au temps t-1. Les réseaux neuronaux récurrents. Vous devrez ajouter des neurones particuliers pour cette tâche, qui pourra être pris en charge par Keras grâce aux couches de type <a href="https://www.youtube.com/watch?v=UnclHXZszpw"><em>Long Short-Term Memory network</em>, ou LSTM</a>.</li>
<li>
<strong>Réseaux neuronaux probabilistes</strong>. Les réseaux neuronaux non-probabilistes offre une estimation de la variable réponse. Mais quelle est la crédibilité de la réponse selon les variables descriptives? Question qui pourrait se révéler cruciale en médecine ou en ingénierie, à la laquelle on pourra répondre en mode probabiliste. Pour ce faire, on pose des distributions <em>a priori</em> sur les poids du réseau neuronal. Le module <a href="http://edwardlib.org/"><code>edward</code></a>, programmé et distribué en Python, offre cette possibilité. Vous pourrez accéder à <code>edward</code> grâce au module <code>reticulate</code>, mais à ce stade mieux vaudra basculer en Python. Pour en savoir davantage, considérez <a href="https://www.youtube.com/watch?v=I09QVNrUS3Q">cette conférence de Andrew Rowan</a>.</li>
</ul></section></section><section id="les-processus-gaussiens" class="level3" data-number="13.4.4"><h3 data-number="13.4.4" class="anchored" data-anchor-id="les-processus-gaussiens">
<span class="header-section-number">13.4.4</span> Les processus gaussiens</h3>
<p>Les sorties des techniques que soit les KNN, les arbres ou les forêts ainsi que les réseaux neuronaux sont (classiquement) des nombres réels ou des catégories. Dans les cas où la crédibilité de la réponse est importante, il devient pertinent que la sortie soit probabiliste: les prédictions seront alors présentées sous forme de distributions de probabilité. Dans le cas d’une classification, la sortie du modèle sera un vecteur de probabilité qu’une observation appartienne à une classe ou à une autre. Dans celui d’une régression, on obtiendra une distribution continue.</p>
<p>Les <strong>processus gaussiens</strong> tirent profit des statistiques bayésiennes pour effectuer des prédictions probabilistes. D’autres techniques peuvent être utilisées pour effectuer des prédictions probabilistes, comme les <a href="http://edwardlib.org/iclr2017">réseaux neuronaux probabilistes</a>, que j’ai introduits précédemment.</p>
<p>Bien que les processus gaussiens peuvent être utilisés pour la classification, son fonctionnement s’explique favorablement, de manière intuitive, par la régression.</p>
<section id="un-approche-intuitive" class="level4" data-number="13.4.4.1"><h4 data-number="13.4.4.1" class="anchored" data-anchor-id="un-approche-intuitive">
<span class="header-section-number">13.4.4.1</span> Un approche intuitive</h4>
<p>Ayant acquis de l’expérience en enseignement des processus gaussiens, <a href="http://stat.columbia.edu/~cunningham/">John Cunningham</a> a développé une approche intuitive permettant de saisir les mécanismes des processus gaussiens. lors de conférences disponible sur YouTube (<a href="https://youtu.be/BS4Wd5rwNwE">1</a>, <a href="https://www.youtube.com/watch?v=Jv25sg-IYHU">2</a>), il aborde le sujet par la nécessité d’effectuer une régression non-linéaire.</p>
<p>Générons d’abord une variable prédictive <code>x</code>, l’heure, et une variable réponse <code>y</code>, le rythme cardiaque d’un individu en battements par minute (bpm).</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">14</span>, <span class="fl">17</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">61</span>, <span class="fl">74</span>, <span class="fl">69</span>, <span class="fl">67</span>, <span class="fl">78</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, xlab<span class="op">=</span><span class="st">"Heure"</span>, ylab<span class="op">=</span><span class="st">"Rythme cardiaque (bpm)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">12</span>, lty<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">'gray50'</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">67</span>, <span class="st">'?'</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">16</span>, lty<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">'gray50'</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">72</span>, <span class="st">'?'</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-data-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Poser un problème par un processus gaussien, c’est se demander les valeurs crédibles qui pourraient être obtenues hors du domaine d’observations (par exemple, dans la figure ci-dessus, à <code>x=12</code> et <code>x=16</code>)? Ou bien, de manière plus générale, <em>quelles fonctions ont pu générer les variables réponse à partir d’une structure dans les variables prédictives?</em></p>
<p>Les distributions normales, que nous appellerons <em>gaussiennes</em> dans cette section par concordance avec le terme <em>processus gaussien</em>, sont particulièrement utiles pour répondre à cette question.</p>
<p>Nous avons vu précédemment ce que sont les distributions de probabilité: des outils mathématiques permettant d’appréhender la structure des processus aléatoires. Une distribution gaussienne représente une situation où l’on tire au hasard des valeurs continues. Une distribution gaussienne de la variable aléatoire <span class="math inline">\(X\)</span> de moyenne <span class="math inline">\(0\)</span> et de variance de <span class="math inline">\(1\)</span> est notée ainsi:</p>
<p><span class="math display">\[ X \sim \mathcal{N} \left( 0, 1\right)\]</span></p>
<p>Par exemple, une courbe de distribution gaussienne du rythme cardiaque à 7:00 pourrait prendre la forme suivante.</p>
<p><span class="math display">\[ bpm \sim \mathcal{N} \left( 65, 5\right)\]</span></p>
<p>En <code>R</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">80</span>, length<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x_sequence</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x_sequence</span>, mean<span class="op">=</span><span class="fl">65</span>, sd<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>     type<span class="op">=</span><span class="st">"l"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Rythme cardiaque (bpm)"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Densité"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-xseq-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Une distribution <strong>bi</strong>normale, un cas particulier de la distribution <strong>multi</strong>normale, comprendra deux vecteurs, <span class="math inline">\(x_1\)</span> et <span class="math inline">\(x_2\)</span>. Elle aura donc deux moyennes. Puisqu’il s’agit d’une distribution binormale, et non pas deux distributions normales, les deux variables ne sont pas indépendantes et l’on utilisera une matrice de covariance au lieu de deux variances indépendantes.</p>
<p><span class="math display">\[
\binom{x_1}{x_2} \sim \mathcal{N}
\Bigg(
\binom{\mu_1}{\mu_2},
\left[ {\begin{array}{cc}
\Sigma_{x_1} &amp; \Sigma_{x_1,x_2} \\
\Sigma_{x_1,x_2}^T &amp; \Sigma_{x_2} \\
\end{array} } \right]
\Bigg)
\]</span></p>
<p>La matrice <span class="math inline">\(\Sigma\)</span>, dite de <em>variance-covariance</em>, indique sur sa diagonale les variances des variables (<span class="math inline">\(\Sigma_{x_1}\)</span> et <span class="math inline">\(\Sigma_{x_2}\)</span>). Les covariances <span class="math inline">\(\Sigma_{x_1,x_2}\)</span> et <span class="math inline">\(\Sigma_{x_1,x_2}^T\)</span> sont symétriques et indiquent le lien entre les variables.</p>
<p>On pourrait supposer que le rythme cardiaque à 8:00 soit corrélé avec celui à 7:00. Mises ensembles, les distributions gaussiennes à 7:00 et à 8:00 formeraient une distribution gaussienne binormale.</p>
<p><span class="math display">\[
\binom{bpm_7}{bpm_8} \sim \mathcal{N}
\Bigg(
\binom{65}{75},
\left[ {\begin{array}{cc}
10 &amp; 6 \\
6 &amp; 15 \\
\end{array} } \right]
\Bigg)
\]</span></p>
<p>En <code>R</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/dmurdoch/ellipse">"ellipse"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ellipse'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    pairs</code></pre>
</div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">means_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">75</span><span class="op">)</span></span>
<span><span class="va">covariance_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">15</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>pty<span class="op">=</span><span class="st">'s'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://dmurdoch.github.io/ellipse/reference/ellipse.html">ellipse</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">covariance_mat</span>, centre<span class="op">=</span><span class="va">means_vec</span>, levels<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span>, </span>
<span>     type<span class="op">=</span><span class="st">'l'</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Rythme cardiaque à 7:00 (bpm)"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Rythme cardiaque à 8:00 (bpm)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-ellipse-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#lines(ellipse(x=covariance_mat, centre=means_vec, level=0.8))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut se poser la question: étant donnée que <span class="math inline">\(x_1 = 68\)</span>, quelle serait la distribution de <span class="math inline">\(x_2\)</span>? Dans ce cas bivariée, la distribution marginale serait univariée, mais dans le cas multivarié en <span class="math inline">\(D\)</span> dimensions, la distribution marginale où l’on spécifie <span class="math inline">\(m\)</span> variables serait de <span class="math inline">\(D-m\)</span>. Une propriété fondamentale d’une distribution gaussienne est que peu importe l’endroit où l’angle selon lequel on la tranche, la distribution marginale sera aussi gaussienne. Lorsque l’on retranche une ou plusieurs variables en spécifiant la valeur qu’elles prennent, on applique un <em>conditionnement</em> à la distribution.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: mvtnorm</code></pre>
</div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-multnorm-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Les points sur l’axe (symbole x) conditionnés sont des échantillons tirés au hasard dans la distribution conditionnée.</p>
<p>Une autre manière de visualiser la distribution gaussienne binormale est de placer <span class="math inline">\(x_1\)</span> et <span class="math inline">\(x_2\)</span> côte à côte en abscisse, avec leur valeur en ordonnée. Le bloc de code suivant peut sembler lourd au premier coup d’œil: pas de panique, il s’agit surtout d’instructions graphiques. Vous pouvez vous amuser à changer les paramètres de la distribution binormale (section 1) ainsi que la valeur de <span class="math inline">\(x_1\)</span> à laquelle est conditionnée la distribution de <span class="math inline">\(x_2\)</span> (section 2).</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-distr1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Les valeurs que peuvent prendre le rythme cardiaque en <span class="math inline">\(x_2\)</span> sont tirées aléatoirement d’une distribution conditionnée. Sautons maintenant au cas multinormal, incluant 6 variables (<em>hexanormal</em>!). Afin d’éviter de composer une matrice de covariance à la mitaine, je me permets de la générer avec une fonction. Cette fonction particulière est nommée <em>fonction de base radiale</em> ou <em>exponentiel de la racine</em>.</p>
<p><span class="math display">\[K_{RBF} \left( x_i, x_j \right) = \sigma^2 exp \left( -\frac{\left( x_i - x_j \right)^2}{2 l^2}  \right) \]</span></p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">RBF_kernel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">sigma</span>, <span class="va">l</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">k</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="va">sigma</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'x'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans la fonction <code>RBF_kernel</code>, <code>x</code> désigne les dimensions, <code>sigma</code> désigne un écart-type commun à chacune des dimensions et <code>l</code> est la longueur désignant l’amplification de la covariance entre des dimensions éloignées (dans le sens que la première dimension est éloignée de la dernière). Pour 6 dimensions, avec un écart-type de 4 et une longueur de 2.</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">covariance_6</span> <span class="op">&lt;-</span> <span class="fu">RBF_kernel</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, sigma<span class="op">=</span><span class="fl">4</span>, l<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">covariance_6</span>, <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      x1    x2    x3    x4    x5    x6
x1 16.00 14.12  9.70  5.19  2.17  0.70
x2 14.12 16.00 14.12  9.70  5.19  2.17
x3  9.70 14.12 16.00 14.12  9.70  5.19
x4  5.19  9.70 14.12 16.00 14.12  9.70
x5  2.17  5.19  9.70 14.12 16.00 14.12
x6  0.70  2.17  5.19  9.70 14.12 16.00</code></pre>
</div>
</div>
<p>Changez la valeur de <code>l</code> permet de bien saisir son influence sur la matrice de covariance. Avec un <code>l</code> de 1, la covariance entre <span class="math inline">\(x_1\)</span> et <span class="math inline">\(x_6\)</span> est pratiquement nulle: elle est un peut plus élevée avec <code>l=2</code>. Pour reprendre l’exemple du rythme cardiaque, on devrait en effet s’attendre à retrouver une plus grande corrélation entre celles mesurées aux temps 4 et 5 qu’entre les temps 1 et 6.</p>
<p>De même que dans la situation où nous avions une distribution binormale, nous pouvons conditionner une distribution multinormale. Dans l’exemple suivant, je conditionne la distribution multinormale de 6 dimensions en spécifiant les valeurs prises par les deux premières dimensions. Le résultat du conditionnement est une distribution en 4 dimensions. Puisqu’il est difficile de présenter une distribution en 6D, le graphique en haut à gauche ne comprend que les dimensions 1 et 6. Remarquez que la corrélation entre les dimensions 1 et 6 est faible, en concordance avec la matrice de covariance générée par la fonction <code>RBF_kernel</code>. Lancez plusieurs fois le code et voyez ce qui advient des échantillonnages dans les dimensions 3 à 6 selon le conditionnement en 1 et 2.</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">"MASS"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 1. Distribution</span></span>
<span><span class="va">means_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">covariance_mat</span> <span class="op">&lt;-</span> <span class="va">covariance_6</span></span>
<span></span>
<span><span class="co"># 2. Condition</span></span>
<span><span class="va">conditions_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">61</span>, <span class="fl">74</span><span class="op">)</span> <span class="co"># changer ces chiffres pour visualiser l'effet</span></span>
<span></span>
<span><span class="co"># 3. Densité conditionnée</span></span>
<span><span class="va">cond_parameters</span> <span class="op">&lt;-</span> <span class="fu">condMVN</span><span class="op">(</span>mean<span class="op">=</span><span class="va">means_vec</span>, sigma<span class="op">=</span><span class="va">covariance_mat</span>, </span>
<span>                           dependent.ind <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, given.ind<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>                           X.given<span class="op">=</span><span class="va">conditions_x</span><span class="op">)</span></span>
<span><span class="va">cond_mean</span> <span class="op">&lt;-</span> <span class="va">cond_parameters</span><span class="op">$</span><span class="va">condMean</span></span>
<span><span class="va">cond_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">cond_parameters</span><span class="op">$</span><span class="va">condVar</span><span class="op">)</span></span>
<span><span class="va">x6_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">90</span>, length<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">x6_dens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x2_sequence</span>, mean<span class="op">=</span><span class="va">cond_mean</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, sd<span class="op">=</span><span class="va">cond_sd</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_3.6_draw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mu <span class="op">=</span> <span class="va">cond_mean</span>, Sigma <span class="op">=</span> <span class="va">cond_sd</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Graphiques</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, widths<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 4.1 Ellipse</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://dmurdoch.github.io/ellipse/reference/ellipse.html">ellipse</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">covariance_mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span>, centre<span class="op">=</span><span class="va">means_vec</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span>, levels<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span>, </span>
<span>     type<span class="op">=</span><span class="st">'l'</span>, xlab<span class="op">=</span><span class="st">"BPM à 7:00"</span>, ylab<span class="op">=</span><span class="st">"BPM à 8:00"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">conditions_x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col<span class="op">=</span><span class="st">'#f8ad00'</span>, lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">condition_x1</span> <span class="op">+</span> <span class="va">x6_dens</span><span class="op">*</span><span class="fl">40</span>, y<span class="op">=</span><span class="va">x2_sequence</span>, col<span class="op">=</span><span class="st">"#f8ad00"</span>, lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">conditions_x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">conditions_x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cond_mean</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">-</span><span class="va">cond_sd</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">]</span>, <span class="va">cond_mean</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">+</span><span class="va">cond_sd</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">'#46c19a'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">conditions_x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">cond_mean</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>       col<span class="op">=</span><span class="st">'#46c19a'</span>, pch<span class="op">=</span><span class="fl">16</span>, cex<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">conditions_x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x_3.6_draw</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="st">"#b94a73"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 4.2 Covariance</span></span>
<span><span class="fu">plot_matrix</span><span class="op">(</span><span class="va">covariance_mat</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 4.3 Série</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">conditions_x</span>, <span class="va">x_3.6_draw</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">85</span><span class="op">)</span>, type<span class="op">=</span><span class="st">'l'</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Indice de la variable"</span>, ylab<span class="op">=</span><span class="st">"Rythme cardiaque (bpm)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">conditions_x</span>, pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="st">'#46c19a'</span>, cex<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, <span class="va">x_3.6_draw</span>, pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="st">'#b94a73'</span>, cex<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-cond_6d-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>La structure de la covariance assure que les dimensions proches prennent des valeurs similaires, assurant une courbe lisse et non en dents de scie. Pourquoi s’arrêter à 6 dimensions? Prenons-en plusieurs, puis générons plus d’un échantillon. Ensuite, utilisons ces simulations pour de calculer la moyenne et l’écart-type de chacune des dimensions.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-cond_65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Revenons au rythme cardiaque. On pourra utiliser le conditionnement aux temps observés, soit 7:00, 8:00, 10:00, 14:00 et 17:00 pour estimer la distribution à 12:00 et 16:00, où à des dimensions artificielles quelconques ici fixées aux demi-heures.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-cond-bpm-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Comme on devrait s’y attendre, la régression résultant de la mise en indices de la distribution est précise aux mesures, et imprécise aux indices peu garnis en mesures. Nous avions utilisé 21 dimensions. <strong>Lorsque l’on généralise la procédure à une quantité infinie de dimensions, on obtient un <em>processus gaussien</em>.</strong></p>
<p><img src="https://media.giphy.com/media/12R2bKfxceemNq/giphy.gif" class="img-fluid"></p>
<p>L’indice de la variable devient ainsi une valeur réelle. Un processus gaussien, <span class="math inline">\(\mathcal{GP}\)</span>, est défini par une fonction de la moyenne, <span class="math inline">\(m \left( x \right)\)</span>, et une autre de la covariance que l’on nomme <em>noyau</em> (ou <em>kernel</em>), <span class="math inline">\(K \left( x, x' \right)\)</span>. Un processus gaussien est noté de la manière suivante:</p>
<p><span class="math display">\[\mathcal{GP} \sim \left( m \left( x \right), K \left( x, x' \right) \right)\]</span></p>
<p>La fonction définissant la moyenne peut être facilement écartée en s’assurant de centrer la variable réponse à zéro (<span class="math inline">\(y_{centré} = y - \hat{y}\)</span>). Ainsi, par convention, on spécifie une fonction de moyenne comme retournant toujours un zéro. Quant au noyau, il peut prendre différentes fonctions de covariance ou combinaisons de fonctions de covariance. Règle générale, on utilisera un noyau permettant de définir deux paramètres: la hauteur (<span class="math inline">\(\sigma\)</span>) et la longueur de l’ondulation (<span class="math inline">\(l\)</span>) (figure <a href="#fig-ml_gp_hyperp">Figure&nbsp;<span>13.7</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ml_gp_hyperp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="12-autoapprentissage_files/figure-html/fig-ml_gp_hyperp-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;13.7: Hyperparamètres d’un noyau RBF.</figcaption></figure>
</div>
</div>
</div>
<p>On pourra ajouter à ce noyau un bruit blanc, c’est-à-dire une variation purement aléatoire, sans covariance (noyau générant une matrice diagonale).</p>
<p>Le noyau devient ainsi un <em>a priori</em>, et le processus gaussien conditionné aux données devient un <em>a posteriori</em> probabiliste.</p>
<p>Finalement, les processus gaussiens peuvent être extrapolés à plusieurs variables descriptives.</p>
</section></section><section id="les-processus-gaussiens-en-r" class="level3" data-number="13.4.5"><h3 data-number="13.4.5" class="anchored" data-anchor-id="les-processus-gaussiens-en-r">
<span class="header-section-number">13.4.5</span> Les processus gaussiens en <code>R</code>
</h3>
<p>Pas de souci, vous n’aurez pas à programmer vos propres fonctions pour lancer des processus gaussiens. Vous pourrez <a href="https://topepo.github.io/caret/train-models-by-tag.html#gaussian-process">passer par <code>caret</code></a>. Vous pourriez, comme c’est le cas avec les réseaux neuronaux, obtenir davantage de contrôle sur l’autoapprentissage en utilisant directement la fonction <code><a href="https://rdrr.io/pkg/kernlab/man/gausspr.html">gausspr()</a></code> du package <strong><code>kernlab</code></strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"kernlab"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'kernlab'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:scales':

    alpha</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    cross</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    alpha</code></pre>
</div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">14</span>, <span class="fl">17</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">61</span>, <span class="fl">74</span>, <span class="fl">69</span>, <span class="fl">67</span>, <span class="fl">78</span><span class="op">)</span></span>
<span><span class="va">y_sc</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/kernlab/man/gausspr.html">gausspr</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_sc</span>, </span>
<span>             kernel <span class="op">=</span> <span class="st">'rbfdot'</span>, <span class="co"># le noyau: différents types disponibles (?gausspr)</span></span>
<span>             kpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, <span class="co"># hyperparamètre du noyau (l est optimisé)</span></span>
<span>             variance.model <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># pour pouvoir générer les écarts-type</span></span>
<span>             scaled <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># mettre à l'échelle des variables</span></span>
<span>             var <span class="op">=</span> <span class="fl">0.01</span>, <span class="co"># bruit blanc</span></span>
<span>             cross <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># nombre de plis de la validation croisée</span></span>
<span></span>
<span><span class="va">xtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">18</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">y_sc_pred_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">xtest</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">y_pred_mean</span> <span class="op">&lt;-</span> <span class="va">y_sc_pred_mean</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">y_sc_pred_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">xtest</span>, type<span class="op">=</span><span class="st">"sdeviation"</span><span class="op">)</span> <span class="co"># "sdeviation" en régression et "probabilities" pour la classification</span></span>
<span><span class="va">y_pred_sd</span> <span class="op">&lt;-</span> <span class="va">y_sc_pred_sd</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">18</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">xtest</span>, <span class="va">y_pred_mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">xtest</span>, <span class="va">y_pred_mean</span> <span class="op">+</span> <span class="va">y_pred_sd</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">xtest</span>, <span class="va">y_pred_mean</span> <span class="op">-</span> <span class="va">y_pred_sd</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">12</span>, lty<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">'gray50'</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">67</span>, <span class="st">'?'</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">16</span>, lty<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">'gray50'</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">72</span>, <span class="st">'?'</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-kernlab-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="application-pratique" class="level4" data-number="13.4.5.1"><h4 data-number="13.4.5.1" class="anchored" data-anchor-id="application-pratique">
<span class="header-section-number">13.4.5.1</span> Application pratique</h4>
<p>Les processus gaussiens sont utiles pour effectuer des prédictions sur des phénomène sur lesquels on désire éviter de se commettre sur la structure. Les séries temporelles ou les signaux spectraux en sont des exemples. Aussi, j’ai utilisé les processus gaussiens pour modéliser des courbes de réponse aux fertilisants. Prenons ces données générées au hasard, comprenant l’identifiant de la mesure, le bloc du test, la dose de fertilisant, trois variables environnementales ainsi que la performance de la culture en terme de rendement.</p>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fert</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/11_response_fert.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fert</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Dose</span>, y <span class="op">=</span> <span class="va">Yield</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">Block</span><span class="op">)</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-pratique2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Les blocs 1 à 30 serviront d’entraînement, les autres de test. Le rendement est mis à l’échelle pour la modélisation.</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">environment</span> <span class="op">&lt;-</span> <span class="va">fert</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Dose</span>, <span class="va">var1</span>, <span class="va">var2</span>, <span class="va">var3</span><span class="op">)</span></span>
<span><span class="va">yield_sc</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span></span>
<span></span>
<span><span class="va">environment_tr</span> <span class="op">&lt;-</span> <span class="va">environment</span><span class="op">[</span><span class="va">fert</span><span class="op">$</span><span class="va">Block</span> <span class="op">&lt;=</span> <span class="fl">30</span>, <span class="op">]</span></span>
<span><span class="va">environment_te</span> <span class="op">&lt;-</span> <span class="va">environment</span><span class="op">[</span><span class="va">fert</span><span class="op">$</span><span class="va">Block</span> <span class="op">&gt;</span> <span class="fl">30</span>, <span class="op">]</span></span>
<span><span class="va">yield_tr</span> <span class="op">&lt;-</span> <span class="va">yield_sc</span><span class="op">[</span><span class="va">fert</span><span class="op">$</span><span class="va">Block</span> <span class="op">&lt;=</span> <span class="fl">30</span><span class="op">]</span></span>
<span><span class="va">yield_te</span> <span class="op">&lt;-</span> <span class="va">yield_sc</span><span class="op">[</span><span class="va">fert</span><span class="op">$</span><span class="va">Block</span> <span class="op">&gt;</span> <span class="fl">30</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Je pourrais optimiser les hyperparamètres en créant une grille puis en lançant plusieurs processus gaussiens en boucle. Mais pour l’exemple j’utilise des hyperparamètres quelconque.</p>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">yield_gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/kernlab/man/gausspr.html">gausspr</a></span><span class="op">(</span><span class="va">environment_tr</span>, <span class="va">yield_tr</span>, kernel <span class="op">=</span> <span class="st">'rbfdot'</span>,</span>
<span>                    kpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                    variance.model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    scaled <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    var <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                    cross <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rendements prédits dans l'échelle originale</span></span>
<span><span class="va">gp_pred_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">yield_gp</span>, <span class="va">environment_tr</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span></span>
<span><span class="va">gp_pred_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">yield_gp</span>, <span class="va">environment_te</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rendements réels dans l'échelle originale</span></span>
<span><span class="va">yield_tr_os</span> <span class="op">&lt;-</span> <span class="va">yield_tr</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span></span>
<span><span class="va">yield_te_os</span> <span class="op">&lt;-</span> <span class="va">yield_te</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">yield_tr_os</span>, <span class="va">gp_pred_tr</span>, main <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">yield_te_os</span>, <span class="va">gp_pred_te</span>, main <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-pratique4-fit-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>La prédiction semble bien fonctionner en entraînement comme en test. Pour une application à un cas d’étude, disons que pour mon site j’ai des variables environnementales de valeurs du bloc 50, et que je cherche la dose optimale.</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fert</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Block</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">var1</span>, <span class="va">var2</span>, <span class="va">var3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
   var1  var2  var3
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1  1.57  101. -10.7</code></pre>
</div>
</div>
<p>Je peux créer un tableau comprenant des environnements égaux pour chaque ligne, mais comprenant des incréments de dose, puis prédire la courbe de réponse ainsi que son incertitude. Et puisque c’est un cas documenté, je peux afficher les résultats de l’essai pour vérifier si le modèle est crédible.</p>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">environment_appl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, <span class="fl">5</span><span class="op">)</span>, var1 <span class="op">=</span> <span class="fl">1.57</span>, var2 <span class="op">=</span> <span class="fl">101.5</span>, var3 <span class="op">=</span> <span class="op">-</span><span class="fl">10.7</span><span class="op">)</span></span>
<span><span class="va">yield_appl_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">yield_gp</span>, <span class="va">environment_appl</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">y_sc_pred_sd_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">yield_gp</span>, <span class="va">environment_appl</span>, type<span class="op">=</span><span class="st">"sdeviation"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yield_appl</span> <span class="op">&lt;-</span> <span class="va">yield_appl_sc</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span></span>
<span><span class="va">yield_appl_sd</span> <span class="op">&lt;-</span> <span class="va">y_sc_pred_sd_sc</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">fert</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">environment_appl</span><span class="op">$</span><span class="va">Dose</span>, <span class="va">yield_appl</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fert</span><span class="op">[</span><span class="va">fert</span><span class="op">$</span><span class="va">Block</span> <span class="op">==</span> <span class="fl">50</span>, <span class="op">]</span><span class="op">$</span><span class="va">Dose</span>, y <span class="op">=</span> <span class="va">fert</span><span class="op">[</span><span class="va">fert</span><span class="op">$</span><span class="va">Block</span> <span class="op">==</span> <span class="fl">50</span>, <span class="op">]</span><span class="op">$</span><span class="va">Yield</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">environment_appl</span><span class="op">$</span><span class="va">Dose</span>, <span class="va">yield_appl</span> <span class="op">+</span> <span class="va">yield_appl_sd</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">environment_appl</span><span class="op">$</span><span class="va">Dose</span>, <span class="va">yield_appl</span> <span class="op">-</span> <span class="va">yield_appl_sd</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="12-autoapprentissage_files/figure-html/ml-gp-pratique-rep-table-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Pour chaque incrément de dose de la courbe de réponse, il est possible de calculer un rendement économique et/ou écologique en fonction du prix de la dose pondéré par un coût environnemental, puis de soutirer une performance optimale en terme de fertilisation.</p>
<p><strong>Exercice</strong>. Changez les valeurs des variables environnementales pour générer le tableau <code>environment_appl</code> avec des valeurs qui sortent du lot (voir figure <a href="#fig-ml_variables_env">Figure&nbsp;<span>13.8</span></a>). Qu’observez-vous? Pourquoi?</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ml_variables_env" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="12-autoapprentissage_files/figure-html/fig-ml_variables_env-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;13.8: Variables environnementales du tableau fictif <code>fert</code>.</figcaption></figure>
</div>
</div>
</div>
<p><strong>Exercice</strong>. Effectuer la prédiction du rendement avec d’autres techniques, comme des réseaux neuronaux. Comment les modèles se comportent-ils?</p>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./11-series-temporelles.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Les séries temporelles</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13-donnees-spatiales.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Les données géospatiales</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Analyse et modélisation d’agroécosystèmes est construit avec <a href="https://quarto.org/">Quarto</a>.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Lien vers le <a href="https://essicolo.github.io/ecologie-mathematique-R/">manuel original</a>.</div>
  </div>
</footer>


</body></html>