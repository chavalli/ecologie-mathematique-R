<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Analyse et modélisation d’agroécosystèmes sur R - 3&nbsp; Organisation des données et opérations sur des tableaux</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-visualisation.html" rel="next">
<link href="./02-R.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-tableaux.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Organisation des données et opérations sur des tableaux</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Analyse et modélisation d’agroécosystèmes sur R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/chavalli/ecologie-mathematique-R/tree/h2024" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">La science des données avec R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-tableaux.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Organisation des données et opérations sur des tableaux</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Science ouverte et reproductibilité</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction à Python</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07a-biostats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Biostatistiques</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07b-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction à l’analyse bayésienne en écologie</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-explorer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Explorer R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Association, partitionnement et ordination</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Détection de valeurs aberrantes et imputation de données manquantes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-series-temporelles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Les séries temporelles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-autoapprentissage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction à l’autoapprentissage</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-donnees-spatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Les données géospatiales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-modelisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Modélisation de mécanismes écologiques</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#les-collections-de-donn%C3%A9es" id="toc-les-collections-de-données" class="nav-link active" data-scroll-target="#les-collections-de-donn%C3%A9es"><span class="header-section-number">3.1</span> Les collections de données</a></li>
  <li><a href="#organiser-un-tableau-de-donn%C3%A9es" id="toc-organiser-un-tableau-de-données" class="nav-link" data-scroll-target="#organiser-un-tableau-de-donn%C3%A9es"><span class="header-section-number">3.2</span> Organiser un tableau de données</a></li>
  <li>
<a href="#formats-de-tableau" id="toc-formats-de-tableau" class="nav-link" data-scroll-target="#formats-de-tableau"><span class="header-section-number">3.3</span> Formats de tableau</a>
  <ul class="collapse">
<li><a href="#xls-ou-xlsx" id="toc-xls-ou-xlsx" class="nav-link" data-scroll-target="#xls-ou-xlsx"><span class="header-section-number">3.3.1</span> <em>xls</em> ou <em>xlsx</em></a></li>
  <li><a href="#csv" id="toc-csv" class="nav-link" data-scroll-target="#csv"><span class="header-section-number">3.3.2</span> <em>csv</em></a></li>
  <li><a href="#json" id="toc-json" class="nav-link" data-scroll-target="#json"><span class="header-section-number">3.3.3</span> <em>json</em></a></li>
  <li><a href="#sqlite" id="toc-sqlite" class="nav-link" data-scroll-target="#sqlite"><span class="header-section-number">3.3.4</span> SQLite</a></li>
  <li><a href="#suggestion" id="toc-suggestion" class="nav-link" data-scroll-target="#suggestion"><span class="header-section-number">3.3.5</span> Suggestion</a></li>
  </ul>
</li>
  <li><a href="#entreposer-ses-donn%C3%A9es" id="toc-entreposer-ses-données" class="nav-link" data-scroll-target="#entreposer-ses-donn%C3%A9es"><span class="header-section-number">3.4</span> Entreposer ses données</a></li>
  <li>
<a href="#manipuler-des-donn%C3%A9es-en-mode-tidyverse" id="toc-manipuler-des-données-en-mode-tidyverse" class="nav-link" data-scroll-target="#manipuler-des-donn%C3%A9es-en-mode-tidyverse"><span class="header-section-number">3.5</span> Manipuler des données en mode tidyverse</a>
  <ul class="collapse">
<li><a href="#importer-vos-donn%C3%A9es-dans-votre-session-de-travail" id="toc-importer-vos-données-dans-votre-session-de-travail" class="nav-link" data-scroll-target="#importer-vos-donn%C3%A9es-dans-votre-session-de-travail"><span class="header-section-number">3.5.1</span> Importer vos données dans votre session de travail</a></li>
  <li><a href="#comment-s%C3%A9lectionner-et-filtrer-des-donn%C3%A9es" id="toc-comment-sélectionner-et-filtrer-des-données" class="nav-link" data-scroll-target="#comment-s%C3%A9lectionner-et-filtrer-des-donn%C3%A9es"><span class="header-section-number">3.5.2</span> Comment sélectionner et filtrer des données ?</a></li>
  <li><a href="#le-format-long-et-le-format-large" id="toc-le-format-long-et-le-format-large" class="nav-link" data-scroll-target="#le-format-long-et-le-format-large"><span class="header-section-number">3.5.3</span> Le format long et le format large</a></li>
  <li><a href="#combiner-des-tableaux" id="toc-combiner-des-tableaux" class="nav-link" data-scroll-target="#combiner-des-tableaux"><span class="header-section-number">3.5.4</span> Combiner des tableaux</a></li>
  <li><a href="#op%C3%A9rations-sur-les-tableaux" id="toc-opérations-sur-les-tableaux" class="nav-link" data-scroll-target="#op%C3%A9rations-sur-les-tableaux"><span class="header-section-number">3.5.5</span> Opérations sur les tableaux</a></li>
  <li><a href="#exemple-difficile" id="toc-exemple-difficile" class="nav-link" data-scroll-target="#exemple-difficile"><span class="header-section-number">3.5.6</span> Exemple (difficile)</a></li>
  <li><a href="#exporter-un-tableau" id="toc-exporter-un-tableau" class="nav-link" data-scroll-target="#exporter-un-tableau"><span class="header-section-number">3.5.7</span> Exporter un tableau</a></li>
  <li><a href="#aller-plus-loin-dans-le-tidyverse" id="toc-aller-plus-loin-dans-le-tidyverse" class="nav-link" data-scroll-target="#aller-plus-loin-dans-le-tidyverse"><span class="header-section-number">3.5.8</span> Aller plus loin dans le tidyverse</a></li>
  </ul>
</li>
  <li><a href="#r%C3%A9f%C3%A9rences" id="toc-références" class="nav-link" data-scroll-target="#r%C3%A9f%C3%A9rences"><span class="header-section-number">3.6</span> Références</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-table" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Organisation des données et opérations sur des tableaux</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><hr>
<p><strong>Objectifs spécifiques</strong>:</p>
<p>À la fin de ce chapitre, vous</p>
<ul>
<li>comprendrez les règles guidant la création et la gestion des tableaux,</li>
<li>saurez importer et exporter des données et</li>
<li>saurez effectuer des opérations en cascade avec le module tidyverse, dont :
<ul>
<li>des filtres sur les lignes,</li>
<li>des sélections de colonnes,</li>
<li>des sommaires statistiques et</li>
<li>des jointures entre tableaux.</li>
</ul>
</li>
</ul>
<hr>
<p>Les données sont utilisées à chaque étape dans les flux de travail en sciences. Elles alimentent l’analyse et la modélisation. Les résultats qui en découlent sont aussi des données qui peuvent alimenter les travaux subséquents. Une bonne organisation des données facilitera le flux de travail.</p>
<blockquote class="blockquote">
<p><strong>Dicton</strong>. Proportions de temps voué au calcul scientifique : 80 % de nettoyage de données mal organisées, 20 % de calcul.</p>
</blockquote>
<p>Qu’est-ce qu’une donnée ? De manière abstraite, il s’agit d’une valeur associée à une variable. Une variable peut être une dimension, une date, une couleur, le résultat d’un test statistique, à laquelle on attribue la valeur quantitative ou qualitative d’un chiffre, d’une chaîne de caractère, d’un symbole conventionné, etc. Par exemple, lorsque vous commandez un café <em>latte</em> végane, <em>au latte</em> est la valeur que vous attribuez à la variable <em>type de café</em>, et <em>végane</em> est la valeur de la variable <em>type de lait</em>.</p>
<p>L’exemple est peut-être horrible. J’ai besoin d’un café…</p>
<p><img src="https://media.giphy.com/media/3nbxypT20Ulmo/giphy.gif" class="img-fluid"></p>
<p>Ce chapitre traite de l’importation, l’utilisation et l’exportation de données structurées, en R, sous forme de vecteurs, matrices, tableaux et ensemble de tableaux (bases de données).</p>
<p>Bien qu’il soit toujours préférable d’organiser les structures qui accueilleront les données d’une expérience avant-même de procéder à la collecte de données, l’analyste doit s’attendre à réorganiser ses données en cours de route. Or, des données bien organisées au départ faciliteront aussi leur réorganisation.</p>
<p>Ce chapitre débute avec quelques définitions : les données, les matrices, les tableaux et les bases de données, ainsi que leur signification en R. Puis nous verrons comment organiser un tableau selon quelques règles simples, mais importantes pour éviter les erreurs et les opérations fastidieuses pour reconstruire un tableau mal conçu. Ensuite, nous traiterons des formats de tableaux courants, pour enfin passer à l’utilisation de <a href="https://dplyr.tidyverse.org/"><strong><code>dplyr</code></strong></a>, le module du <em>tidyverse</em> pour effectuer des opérations sur les tableaux.</p>
<section id="les-collections-de-données" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="les-collections-de-données">
<span class="header-section-number">3.1</span> Les collections de données</h2>
<p>Dans le <span class="quarto-unresolved-ref">?sec-R</span>, nous avons survolé différents types d’objets : réels, entiers, chaînes de caractères et booléens. Les données peuvent appartenir à d’autres types : dates, catégories ordinales (ordonnées : faible, moyen, élevé) et nominales (non ordonnées : espèces, cultivars, couleurs, unité pédologique, etc.). Comme mentionné en début de chapitre, une donnée est une valeur associée à une variable. Les données peuvent être organisées en collections.</p>
<p>Nous avons aussi vu au <span class="quarto-unresolved-ref">?sec-R</span> que la manière privilégiée d’organiser des données était sous forme de <strong>tableaux</strong>. De manière générale, un tableau de données est une organisation de données en deux dimensions, comportant des <em>lignes</em> et des <em>colonnes</em>. Il est préférable de respecter la convention selon laquelle <strong>les lignes sont des observations et les colonnes sont des variables</strong>. Ainsi, un tableau est une liste de vecteurs de même longueur, chaque vecteur représentant une variable. Chaque variable est libre de prendre le type de données approprié. La position d’une donnée dans le vecteur correspond à une observation. Lorsque les vecteurs sont posés les uns à côté des autres, la position dans le vecteur devient une ligne qui définit les valeurs des variables d’une observation.</p>
<p>Imaginez que vous consignez des données météorologiques comme les précipitations totales ou la température moyenne pour chaque jour, pendant une semaine sur les sites A, B et C. Chaque site possède ses propres caractéristiques, comme la position en longitude-latitude. Il est redondant de répéter la position du site pour chaque jour de la semaine. Vous préférerez créer deux tableaux : un pour décrire vos observations, et un autre pour décrire les sites. De cette manière, vous créez une collection de tableaux interreliés : une <strong>base de données</strong>. Nous couvrirons cette notion un peu plus loin. R peut soutirer des données des bases de données grâce au module DBI, qui n’est pas couvert à ce stade de développement du cours.</p>
<p>Dans R, les données structurées en tableaux, ainsi que les opérations sur les tableaux, peuvent être gérées grâce aux modules <strong><code>readr</code></strong>, <strong><code>dplyr</code></strong> et <strong><code>tidyr</code></strong>, tous des modules faisant partie du méta-module <strong><code>tidyverse</code></strong>, qui est un genre de Microsoft Office sur R : plusieurs modules fonctionnant en interopérabilité. Mais avant de se lancer dans l’utilisation de ces modules, voyons quelques règles à suivre pour bien structurer ses données en format <em>tidy</em>, un jargon du <em>tidyverse</em> qui signifie <em>proprement organisé</em>.</p>
</section><section id="organiser-un-tableau-de-données" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="organiser-un-tableau-de-données">
<span class="header-section-number">3.2</span> Organiser un tableau de données</h2>
<p>Afin de repérer chaque cellule d’un tableau, on attribue à chaque ligne et à chaque colonne un identifiant <em>unique</em>, que l’on nomme <em>indice</em> pour les lignes et <em>entête</em> pour les colonnes.</p>
<blockquote class="blockquote">
<p><strong>Règle no 1.</strong> Une variable par colonne, une observation par ligne, une valeur par cellule.</p>
</blockquote>
<p>Les unités expérimentales sont décrites par une ou plusieurs variables, par des chiffres ou des lettres. Chaque variable devrait être présente en une seule colonne, et chaque ligne devrait correspondre à une unité expérimentale où ces variables ont été mesurées. La règle parait simple, mais elle est rarement respectée. Prenez par exemple le tableau suivant.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="cell-output-display">
<div id="tbl-exwide" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3.1: Rendements obtenus sur les sites expérimentaux selon les traitements.</caption>
<thead><tr class="header">
<th style="text-align: left;">Site</th>
<th style="text-align: right;">Traitement A</th>
<th style="text-align: right;">Traitement B</th>
<th style="text-align: right;">Traitement C</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sainte-Souris</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">8.2</td>
<td style="text-align: right;">6.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sainte-Fourmi</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: right;">5.9</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Saint-Ours</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">3.4</td>
<td style="text-align: right;">4.6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Qu’est-ce qui cloche avec ce tableau? Chaque ligne est une observation, mais contient plusieurs observations d’une même variable, le rendement, qui devient étalé sur plusieurs colonnes. <em>À bien y penser</em>, le type de traitement est une variable et le rendement en est une autre:</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-exlong" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3.2: Rendements obtenus sur les sites expérimentaux selon les traitements.</caption>
<thead><tr class="header">
<th style="text-align: left;">Site</th>
<th style="text-align: left;">Traitement</th>
<th style="text-align: right;">Rendement</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sainte-Souris</td>
<td style="text-align: left;">Traitement A</td>
<td style="text-align: right;">4.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sainte-Souris</td>
<td style="text-align: left;">Traitement B</td>
<td style="text-align: right;">8.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sainte-Souris</td>
<td style="text-align: left;">Traitement C</td>
<td style="text-align: right;">6.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sainte-Fourmi</td>
<td style="text-align: left;">Traitement A</td>
<td style="text-align: right;">5.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sainte-Fourmi</td>
<td style="text-align: left;">Traitement B</td>
<td style="text-align: right;">5.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sainte-Fourmi</td>
<td style="text-align: left;">Traitement C</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Saint-Ours</td>
<td style="text-align: left;">Traitement A</td>
<td style="text-align: right;">2.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Saint-Ours</td>
<td style="text-align: left;">Traitement B</td>
<td style="text-align: right;">3.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Saint-Ours</td>
<td style="text-align: left;">Traitement C</td>
<td style="text-align: right;">4.6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Plus précisément, l’expression <em>à bien y penser</em> suggère une réflexion sur la signification des données. Certaines variables peuvent parfois être intégrées dans une même colonne, parfois pas. Par exemple, les concentrations en cuivre, zinc et plomb dans un sol contaminé peuvent être placées dans la même colonne “Concentration” ou déclinées en plusieurs colonnes Cu, Zn et Pb. La première version trouvera son utilité pour créer des graphiques (<span class="quarto-unresolved-ref">?sec-visual</span>), alors que la deuxième favorise le traitement statistique (<span class="quarto-unresolved-ref">?sec-bios</span>). Il est possible de passer d’un format à l’autre grâce à la fonction <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> et <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> du module tidyr.</p>
<blockquote class="blockquote">
<p><strong>Règle no 2.</strong> Un tableau par unité observationnelle: ne pas répéter les informations.</p>
</blockquote>
<p>Reprenons la même expérience. Supposons que vous mesurez la précipitation à l’échelle du site.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-exlong-prec" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3.3: Rendements et précipitations obtenus sur les sites expérimentaux selon les traitements.</caption>
<thead><tr class="header">
<th style="text-align: left;">Site</th>
<th style="text-align: left;">Traitement</th>
<th style="text-align: right;">Rendement</th>
<th style="text-align: right;">Précipitations</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sainte-Souris</td>
<td style="text-align: left;">Traitement A</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">813</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sainte-Souris</td>
<td style="text-align: left;">Traitement B</td>
<td style="text-align: right;">8.2</td>
<td style="text-align: right;">813</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sainte-Souris</td>
<td style="text-align: left;">Traitement C</td>
<td style="text-align: right;">6.8</td>
<td style="text-align: right;">813</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sainte-Fourmi</td>
<td style="text-align: left;">Traitement A</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: right;">642</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sainte-Fourmi</td>
<td style="text-align: left;">Traitement B</td>
<td style="text-align: right;">5.9</td>
<td style="text-align: right;">642</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sainte-Fourmi</td>
<td style="text-align: left;">Traitement C</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">642</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Saint-Ours</td>
<td style="text-align: left;">Traitement A</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">1028</td>
</tr>
<tr class="even">
<td style="text-align: left;">Saint-Ours</td>
<td style="text-align: left;">Traitement B</td>
<td style="text-align: right;">3.4</td>
<td style="text-align: right;">1028</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Saint-Ours</td>
<td style="text-align: left;">Traitement C</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">1028</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Segmenter l’information en deux tableaux serait préférable.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-prec" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3.4: Précipitations sur les sites expérimentaux.</caption>
<thead><tr class="header">
<th style="text-align: left;">Site</th>
<th style="text-align: right;">Précipitations</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sainte-Souris</td>
<td style="text-align: right;">813</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sainte-Fourmi</td>
<td style="text-align: right;">642</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Saint-Ours</td>
<td style="text-align: right;">1028</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Les tableaux <a href="#tbl-exlong">Table&nbsp;<span>3.2</span></a> et <a href="#tbl-prec">Table&nbsp;<span>3.4</span></a>, ensemble, forment une base de données (collection organisée de tableaux). Les opérations de fusion entre les tableaux peuvent être effectuées grâce aux fonctions de jointure (<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>, par exemple) du module <strong><code>tidyr</code></strong>. Une jointure de <a href="#tbl-prec">Table&nbsp;<span>3.4</span></a> vers <a href="#tbl-exlong">Table&nbsp;<span>3.2</span></a> donnera le tableau <a href="#tbl-exlong-prec">Table&nbsp;<span>3.3</span></a>.</p>
<blockquote class="blockquote">
<p><strong>Règle no 3.</strong> Ne pas bousiller les données.</p>
</blockquote>
<p>Par exemple.</p>
<ul>
<li>
<em>Ajouter des commentaires dans des cellules</em>. Si une cellule mérite d’être commentée, il est préférable de placer les commentaires soit dans un fichier décrivant le tableau de données, soit dans une colonne de commentaire juxtaposée à la colonne de la variable à commenter. Par exemple, si vous n’avez pas mesuré le pH pour une observation, n’écrivez pas “échantillon contaminé” dans la cellule, mais annoter dans un fichier d’explication que l’échantillon no X a été contaminé. Si les commentaires sont systématiques, il peut être pratique de les inscrire dans une colonne <code>commentaire_pH</code>.</li>
<li>
<em>Inscription non systématique</em>. Il arrive souvent que des catégories d’une variable ou que des valeurs manquantes soient annotées différemment. Il arrive même que le séparateur décimal soit non systématique, parfois noté par un point, parfois par une virgule. Par exemple, une fois importés dans votre session, les catégories <code>St-Ours</code> et <code>Saint-Ours</code> seront traitées comme deux catégories distinctes. De même, les cellules correspondant à des valeurs manquantes ne devraient pas être inscrites parfois avec une cellule vide, parfois avec un point, parfois avec un tiret ou avec la mention <code>NA</code>. Le plus simple est de laisser systématiquement ces cellules vides.</li>
<li>
<em>Inclure des notes dans un tableau</em>. La règle “une colonne, une variable” n’est pas respectée si on ajoute des notes un peu n’importe où sous ou à côté du tableau.</li>
<li>
<em>Ajouter des sommaires</em>. Si vous ajoutez une ligne sous un tableau comprenant la moyenne de chaque colonne, qu’est-ce qui arrivera lorsque vous importerez votre tableau dans votre session de travail? La ligne sera considérée comme une observation supplémentaire.</li>
<li>
<em>Inclure une hiérarchie dans les entêtes</em>. Afin de consigner des données de texture du sol, comprenant la proportion de sable, de limon et d’argile, vous organisez votre entête en plusieurs lignes. Une ligne pour la catégorie de donnée, <em>Texture</em>, fusionnée sur trois colonnes, puis trois colonnes intitulées <em>Sable</em>, <em>Limon</em> et <em>Argile</em>. Votre tableau est joli, mais il ne pourra pas être importé conformément dans un votre session de calcul : on recherche <em>une entête unique par colonne</em>. Votre tableau de données devrait plutôt porter les entêtes <em>Texture sable</em>, <em>Texture limon</em> et <em>Texture argile</em>. Un conseil : réserver le travail esthétique à la toute fin d’un flux de travail.</li>
</ul></section><section id="formats-de-tableau" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="formats-de-tableau">
<span class="header-section-number">3.3</span> Formats de tableau</h2>
<p>Plusieurs outils sont à votre disposition pour créer des tableaux. Je vous présente ici les plus communs.</p>
<section id="xls-ou-xlsx" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="xls-ou-xlsx">
<span class="header-section-number">3.3.1</span> <em>xls</em> ou <em>xlsx</em>
</h3>
<p>Microsoft Excel est un logiciel de type <em>tableur</em>, ou chiffrier électronique. L’ancien format <em>xls</em> a été remplacé par le format <em>xlsx</em> avec l’arrivée de Microsoft Office 2010. Il s’agit d’un format propriétaire, dont l’alternative libre la plus connue est le format <em>ods</em>, popularisé par la suite bureautique LibreOffice. Les formats <em>xls</em>, <em>xlsx</em> ou <em>ods</em> sont davantage utilisés comme outils de calcul que d’entreposage de données. Ils contiennent des formules, des graphiques, du formatage de cellule, etc. <em>Je ne les recommande pas pour stocker des données</em>.</p>
</section><section id="csv" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="csv">
<span class="header-section-number">3.3.2</span> <em>csv</em>
</h3>
<p>Le format <em>csv</em>, pour <em>comma separated values</em>, est un fichier texte, que vous pouvez ouvrir avec n’importe quel éditeur de texte brut (Bloc note, <a href="https://code.visualstudio.com/">VSCode</a>, <a href="https://notepad-plus-plus.org">Notepad++</a>, etc.). Chaque colonne doit être délimitée par un caractère cohérent (conventionnellement une virgule, mais en français un point-virgule ou une tabulation pour éviter la confusion avec le séparateur décimal) et chaque ligne du tableau est un retour de ligne. Il est possible d’ouvrir et d’éditer les fichiers csv dans un éditeur texte, mais il est plus pratique de les ouvrir avec des tableurs (LibreOffice Calc, Microsoft Excel, Google Sheets, etc.).</p>
<p><strong>Encodage des fichiers texte</strong>. Puisque le format <em>csv</em> est un fichier texte, un souci particulier doit être porté sur la manière dont le texte est encodé. Les caractères accentués pourraient être importés incorrectement si vous importez votre tableau en spécifiant le mauvais encodage. Pour les fichiers en langues occidentales, l’encodage UTF-8 devrait être utilisé. Toutefois, par défaut, Excel utilise un encodage de Microsoft. Si le <em>csv</em> a été généré par Excel, il est préférable de l’ouvrir avec votre éditeur texte et de l’enregistrer dans l’encodage UTF-8.</p>
</section><section id="json" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="json">
<span class="header-section-number">3.3.3</span> <em>json</em>
</h3>
<p>Comme le format <em>csv</em>, le format <em>json</em> indique un fichier en texte clair. En permettant des structures de tableaux emboîtés et en ne demandant pas que chaque colonne ait la même longueur, le format <em>json</em> permet plus de souplesse que le format <em>csv</em>, mais il est plus compliqué à consulter et prend davantage d’espace sur le disque que le <em>csv</em>. Il est utilisé davantage pour le partage de données des applications web, mais en ce qui concerne la matière du cours, ce format est surtout utilisé pour les données géoréférencées. L’encodage est géré de la même manière qu’un fichier <em>csv</em>.</p>
</section><section id="sqlite" class="level3" data-number="3.3.4"><h3 data-number="3.3.4" class="anchored" data-anchor-id="sqlite">
<span class="header-section-number">3.3.4</span> SQLite</h3>
<p>SQLite est une application pour les bases de données relationnelles de type SQL qui n’a pas besoin de serveur pour fonctionner. Les bases de données SQLite sont encodés dans des fichiers portant l’extension <em>db</em>, qui peuvent être facilement partagés.</p>
</section><section id="suggestion" class="level3" data-number="3.3.5"><h3 data-number="3.3.5" class="anchored" data-anchor-id="suggestion">
<span class="header-section-number">3.3.5</span> Suggestion</h3>
<p>En <em>csv</em> pour les petits tableaux, en <em>sqlite</em> pour les bases de données plus complexes. Ce cours se concentre toutefois sur les données de type <em>csv</em>.</p>
</section></section><section id="entreposer-ses-données" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="entreposer-ses-données">
<span class="header-section-number">3.4</span> Entreposer ses données</h2>
<p>La manière la plus sécurisée pour entreposer ses données est de les confiner dans une base de données sécurisée sur un serveur sécurisé dans un environnement sécurisé et d’encrypter les communications. C’est aussi… la manière la moins accessible. Des espaces de stockage nuagiques, comme Dropbox ou d’autres <a href="https://alternativeto.net/software/dropbox/">options similaires</a>, peuvent être pratiques pour les backups et le partage des données avec une équipe de travail (qui risque en retour de bousiller vos données). Le suivi de version est possible chez certains fournisseurs d’espace de stockage. Mais pour un suivi de version plus rigoureux, les espaces de développement (comme GitHub et GitLab) sont plus appropriés (couverts au <span class="quarto-unresolved-ref">?sec-git</span>). Dans tous les cas, il est important de garder (1) des copies anciennes pour y revenir en cas d’erreurs et (2) un petit fichier décrivant les changements effectués sur les données.</p>
</section><section id="manipuler-des-données-en-mode-tidyverse" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="manipuler-des-données-en-mode-tidyverse">
<span class="header-section-number">3.5</span> Manipuler des données en mode tidyverse</h2>
<p>Le méta-module <strong><code>tidyverse</code></strong> regroupe une collection de précieux modules pour l’analyse de données en R. Il permet d’importer des données dans votre session de travail avec <strong><code>readr</code></strong>, de les explorer avec le module de visualisation <strong><code>ggplot2</code></strong>, de les transformer avec <strong><code>tidyr</code></strong> et <strong><code>dplyr</code></strong> et de les exporter avec <strong><code>readr</code></strong>. Les tableaux de classe <code>data.frame</code>, comme ceux de la plus moderne classe <code>tibble</code>, peuvent être manipulés à travers le flux de travail pour l’analyse et la modélisation. Comme ce sera le cas pour le chapitre sur la visualisation, ce chapitre est loin de couvrir les nombreuses fonctionnalités qui sont offertes dans le <em>tidyverse</em>.</p>
<section id="importer-vos-données-dans-votre-session-de-travail" class="level3" data-number="3.5.1"><h3 data-number="3.5.1" class="anchored" data-anchor-id="importer-vos-données-dans-votre-session-de-travail">
<span class="header-section-number">3.5.1</span> Importer vos données dans votre session de travail</h3>
<p>Supposons que vous avez bien organisé vos données en mode <em>tidy</em>. Pour les importer dans votre session et commencer à les inspecter, vous lancerez une des commandes du module <strong><code>readr</code></strong>, décrites dans la documentation dédiée.</p>
<ul>
<li>
<code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> si le séparateur de colonne est une virgule</li>
<li>
<code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2()</a></code> si le séparateur de colonne est un point-virgule et que le séparateur décimal est une virgule</li>
<li>
<code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv()</a></code> si le séparateur de colonne est une tabulation</li>
<li>
<code><a href="https://readr.tidyverse.org/reference/read_table.html">read_table()</a></code> si le séparateur de colonne est un espace blanc</li>
<li>
<code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim()</a></code> si le séparateur de colonne est un autre caractère (comme le point-virgule) que vous spécifierez dans l’argument <code>delim = ";"</code>
</li>
</ul>
<p>Les principaux arguments sont les suivants.</p>
<ul>
<li>
<code>file</code>: le chemin vers le fichier. Ce chemin peut aussi bien être une adresse locale (data/…) qu’une adresse internet (https://…).</li>
<li>
<code>delim</code>: le symbole délimitant les colonnes dans le cas de <code>read_delim</code>.</li>
<li>
<code>col_names</code>: si TRUE, la première ligne est l’entête du tableau, sinon FALSE. Si vous spécifiez un vecteur numérique, ce sont les numéros des lignes utilisées pour le nom de l’entête. Si vous utilisez un vecteur de caractères, ce sont les noms des colonnes que vous désirez donner à votre tableau.</li>
<li>
<code>na</code>: le symbole spécifiant une valeur manquante. L’argument <code>na=''</code> signifie que les cellules vides sont des données manquantes. Si les valeurs manquantes ne sont pas uniformes, vous pouvez les indiquer dans un vecteur, par exemple <code>na = c("", "NA", "NaN", ".", "-")</code>.</li>
<li>
<code>local</code>: cet argument prend une fonction <code><a href="https://rdrr.io/r/base/eval.html">local()</a></code> qui peut inclure des arguments de format de temps, mais aussi d’encodage (<a href="https://readr.tidyverse.org/reference/locale.html">voir documentation</a>)</li>
</ul>
<p>D’autres arguments peuvent être spécifiés au besoin, et les répéter ici dupliquerait l’information de la documentation de <a href="https://readr.tidyverse.org/reference/read_delim.html">la fonction <code>read_csv</code> de readr</a>.</p>
<p>Je déconseille d’importer des données en format xls ou xlsx. Si toutefois cela vous convient, je vous réfère au module <a href="https://readxl.tidyverse.org/">readxl</a>.</p>
<p>L’<a href="https://rstudio.github.io/cheatsheets/data-import.pdf">aide-mémoire de readr</a> (<a href="#fig-readr-cheatsheet">Figure&nbsp;<span>3.1</span></a>) est à afficher près de soi.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-readr-cheatsheet" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/04_data-import-cs.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: Aide-mémoire de readr, Source: <a href="https://rstudio.github.io/cheatsheets/data-import.pdf">https://rstudio.github.io/cheatsheets/data-import.pdf</a></figcaption></figure>
</div>
</div>
</div>
<p>Nous allons charger des données de culture de la chicouté (<em>Rubus chamaemorus</em>), un petit fruit nordique, tiré de Parent et al.&nbsp;(2013). Ouvrons d’abord le fichier pour vérifier les séparateurs de colonnes et de décimales (<a href="#fig-tab-csv">Figure&nbsp;<span>3.2</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-tab-csv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/04_chicoute-csv-atom.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: Aperçu brut d’un fichier csv.</figcaption></figure>
</div>
</div>
</div>
<p>Le séparateur de colonnes est un point-virgule et le décimal est une virgule.</p>
<p>Avec <a href="https://atom.io/">Atom</a>, mon éditeur texte préféré (il y en a d’<a href="https://alternativeto.net/software/atom/">autres</a>), je vais dans Edit &gt; Select Encoding et j’obtiens bien le UTF-8 (<a href="#fig-tab-csv-enc">Figure&nbsp;<span>3.3</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-tab-csv-enc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/04_chicoute-csv-encoding.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: Changer l’encodage d’un fichier csv.</figcaption></figure>
</div>
</div>
</div>
<p>Nous allons donc utiliser <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2()</a></code> avec ses arguments par défaut.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></span>
<span><span class="va">chicoute</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2</a></span><span class="op">(</span><span class="st">"data/chicoute.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 90 Columns: 31
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr  (5): CodeTourbiere, Ordre, Traitement, DemiParcelle, SousTraitement
dbl (26): ID, Site, Latitude_m, Longitude_m, Rendement_g_5m2, TotalRamet_nom...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Quelques commandes utiles inspecter le tableau:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> présente l’entête du tableau, soit ses 6 premières lignes</li>
<li>
<code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> et <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> présentent les variables du tableau et leur type - <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code>est la fonction tidyverse et <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> est la fonction classique (je préfère <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>)</li>
<li>
<code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> présente des statistiques de base du tableau</li>
<li>
<code><a href="https://rdrr.io/r/base/names.html">names()</a></code> ou <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code> sort les noms des colonnes sous forme d’un vecteur</li>
<li>
<code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code> donne les dimensions du tableau, <code><a href="https://rdrr.io/r/base/nrow.html">ncol()</a></code> son nombre de colonnes et <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code> son nombre de lignes</li>
<li>
<code>skim</code> est une fonction du module skimr montrant un portrait graphique et numérique du tableau</li>
</ul>
<p><strong>Extra 1</strong>. Plusieurs modules ne se trouvent pas dans les dépôts CRAN, mais sont disponibles sur GitHub. Pour les installer, installez d’abord le module devtools disponible sur CRAN. Vous pourrez alors installer les packages de GitHub comme on le fait avec le package skimr.</p>
<p><strong>Extra 2</strong>. Lorsque je désire utiliser une fonction, mais sans charger le module dans la session, j’utilise la notation <code>module::fonction</code>. Comme dans ce cas, pour skimr.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">chicoute</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">chicoute</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">90</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">31</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CodeTourbiere</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ordre</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Traitement</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">DemiParcelle</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SousTraitement</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 4%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ID</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">45.50</td>
<td style="text-align: right;">26.12</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">23.25</td>
<td style="text-align: right;">45.50</td>
<td style="text-align: right;">67.75</td>
<td style="text-align: right;">90.00</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">Site</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">6.33</td>
<td style="text-align: right;">5.49</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">9.00</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Latitude_m</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5701839.86</td>
<td style="text-align: right;">1915.50</td>
<td style="text-align: right;">5695688.00</td>
<td style="text-align: right;">5701868.50</td>
<td style="text-align: right;">5702129.00</td>
<td style="text-align: right;">5702537.00</td>
<td style="text-align: right;">5706394.00</td>
<td style="text-align: left;">▁▂▅▇▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Longitude_m</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">485295.54</td>
<td style="text-align: right;">6452.33</td>
<td style="text-align: right;">459873.00</td>
<td style="text-align: right;">485927.00</td>
<td style="text-align: right;">486500.00</td>
<td style="text-align: right;">486544.75</td>
<td style="text-align: right;">491955.00</td>
<td style="text-align: left;">▁▁▁▂▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rendement_g_5m2</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">13.33</td>
<td style="text-align: right;">21.56</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">15.63</td>
<td style="text-align: right;">72.44</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">TotalRamet_nombre_m2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">251.26</td>
<td style="text-align: right;">156.06</td>
<td style="text-align: right;">40.74</td>
<td style="text-align: right;">122.70</td>
<td style="text-align: right;">212.92</td>
<td style="text-align: right;">347.80</td>
<td style="text-align: right;">651.90</td>
<td style="text-align: left;">▇▇▃▂▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TotalVegetatif_nombre_m2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">199.02</td>
<td style="text-align: right;">139.13</td>
<td style="text-align: right;">22.92</td>
<td style="text-align: right;">86.26</td>
<td style="text-align: right;">161.25</td>
<td style="text-align: right;">263.78</td>
<td style="text-align: right;">580.60</td>
<td style="text-align: left;">▇▇▂▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">TotalFloral_nombre_m2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">52.08</td>
<td style="text-align: right;">40.41</td>
<td style="text-align: right;">4.80</td>
<td style="text-align: right;">22.92</td>
<td style="text-align: right;">43.00</td>
<td style="text-align: right;">69.52</td>
<td style="text-align: right;">198.62</td>
<td style="text-align: left;">▇▅▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TotalMale_nombre_m2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">24.40</td>
<td style="text-align: right;">26.87</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">15.28</td>
<td style="text-align: right;">36.51</td>
<td style="text-align: right;">104.41</td>
<td style="text-align: left;">▇▂▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">TotalFemelle_nombre_m2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">27.53</td>
<td style="text-align: right;">29.83</td>
<td style="text-align: right;">2.55</td>
<td style="text-align: right;">10.34</td>
<td style="text-align: right;">17.19</td>
<td style="text-align: right;">31.96</td>
<td style="text-align: right;">187.17</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FemelleFruit_nombre_m2</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">19.97</td>
<td style="text-align: right;">23.79</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">7.64</td>
<td style="text-align: right;">11.46</td>
<td style="text-align: right;">22.83</td>
<td style="text-align: right;">157.88</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">FemelleAvorte_nombre_m2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">8.49</td>
<td style="text-align: right;">14.52</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.27</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">10.14</td>
<td style="text-align: right;">76.80</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SterileFleur_nombre_m2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">3.82</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">C_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">50.28</td>
<td style="text-align: right;">1.61</td>
<td style="text-align: right;">46.72</td>
<td style="text-align: right;">49.14</td>
<td style="text-align: right;">50.45</td>
<td style="text-align: right;">51.58</td>
<td style="text-align: right;">53.83</td>
<td style="text-align: left;">▃▆▅▇▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">N_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.20</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">1.89</td>
<td style="text-align: right;">2.12</td>
<td style="text-align: right;">2.58</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: left;">▃▇▃▃▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">P_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: left;">▃▆▇▂▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">K_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">1.13</td>
<td style="text-align: right;">1.54</td>
<td style="text-align: left;">▃▇▇▇▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ca_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: left;">▅▇▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mg_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: left;">▇▇▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">S_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: left;">▅▇▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">▂▅▃▇▃</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cu_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Zn_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">▇▇▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mn_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: left;">▇▅▃▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fe_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Al_pourc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">▇▅▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Exercice</strong>. Inspectez le tableau.</p>
</section><section id="comment-sélectionner-et-filtrer-des-données" class="level3" data-number="3.5.2"><h3 data-number="3.5.2" class="anchored" data-anchor-id="comment-sélectionner-et-filtrer-des-données">
<span class="header-section-number">3.5.2</span> Comment sélectionner et filtrer des données ?</h3>
<p>On utilise le terme <em>sélectionner</em> lorsque l’on désire choisir une ou plusieurs lignes et colonnes d’un tableau (la plupart du temps des colonnes). L’action de <em>filtrer</em> signifie de sélectionner des lignes selon certains critères.</p>
<section id="sélectionner" class="level4" data-number="3.5.2.1"><h4 data-number="3.5.2.1" class="anchored" data-anchor-id="sélectionner">
<span class="header-section-number">3.5.2.1</span> Sélectionner</h4>
<p>Voici 4 manières de sélectionner une colonne en R.</p>
<ul>
<li>Une méthode rapide mais peu expressive consiste à indiquer les valeurs numériques de l’indice de la colonne entre des crochets. Il s’agit d’appeler le tableau suivi de crochets. L’intérieur des crochets comprend deux éléments séparés par une virgule. Le premier élément sert à filtrer selon l’indice, le deuxième sert à sélectionner selon l’indice. Ainsi:
<ul>
<li>
<code>chicoute[, 1]</code>: sélectionner la première colonne</li>
<li>
<code>chicoute[, 1:10]</code>: sélectionner les 10 premières colonnes</li>
<li>
<code>chicoute[, c(2, 4, 5)]</code>: sélectionner les colonnes 2, 4 et 5</li>
<li>
<code>chicoute[c(10, 13, 20), c(2, 4, 5)]</code>: sélectionner les colonnes 2, 4 et 5 et les lignes 10, 13 et 20.</li>
</ul>
</li>
<li>Une autre méthode rapide, mais plus expressive, consiste à appeler le tableau, suivi du symbole <code>$</code>, puis le nom de la colonne, e.g.&nbsp;<code>chicoute$Site</code>.</li>
</ul>
<blockquote class="blockquote">
<p><strong>Truc</strong>. La plupart des IDE, comme RStudio, peuvent vous proposer des colonnes dans une liste. Après avoir saisi le <code>$</code>, taper sur la touche de tabulation: vous pourrez sélectionner la colonne dans une liste défilante (<a href="#fig-tab-auto-complete">Figure&nbsp;<span>3.4</span></a>).</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-tab-auto-complete" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/04_auto-complete-cols.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: Autocomplétion dans RStudio.</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>Vous pouvez aussi inscrire le nom de la colonne, ou du vecteur des colonnes, entre des crochets suivant le nom du tableau, c’est-à-dire <code>chicoute[c("Site", "Latitude_m", "Longitude_m")]</code>.</li>
<li>Enfin, dans une séquence d’opérations en mode pipeline (chaque opération est mise à la suite de la précédente en plaçant le <em>pipe</em> <code>|&gt;</code> entre chacune), il peut être préférable de sélectionner des colonnes avec la fonction <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, i.e.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Site</span>, <span class="va">Latitude_m</span>, <span class="va">Longitude_m</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p><strong>Note sur le mode <em>pipeline</em> :</strong> Le <em>pipe</em> <code>|&gt;</code> a été introduit dans R-base en 2021. Auparavant, on utilisait la fonction <code>%&gt;%</code> introduite dans le module magrittr, inclus dans tidyverse. La plupart du temps, les deux fonctionnent sensiblement de la même façon, mais il existe quelques différences dans leur interaction avec certaines fonctions. Puisque <code>|&gt;</code> fait partie de R-base, je vous suggère de l’utiliser par défaut, mais il est fort probable que vous trouviez l’ancienne version <code>%&gt;%</code> lors de vos recherches sur internet (ou même dans ce guide si j’oublie d’effectuer les modifications). Pour insérer un <em>pipe</em>, il suffit d’utiliser le raccourci clavier <strong><code>Ctrl + Shift + M</code></strong>. Vous pouvez modifier la forme par défaut dans les options de RStudio, comme sur la <a href="#fig-tab-pipe">Figure&nbsp;<span>3.5</span></a>.</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-tab-pipe" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/04_pipe.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3.5: Modifier le <em>pipe</em> par défaut dans RStudio.</figcaption></figure>
</div>
</div>
</div>
<p>La fonction <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> permet aussi de travailler en exclusion. Ainsi pour enlever des colonnes, on placera un <code>-</code> (signe de soustraction) devant le nom de la colonne.</p>
<p>⚠️ <strong>Attention</strong>. Plusieurs modules utilisent la fonction <code>select</code> (et <code>filter</code>, plus bas). Lorsque vous lancez <code>select</code> et que vous obtenez un message d’erreur comme</p>
<pre><code>Error in select(., ends_with("pourc")) : 
  argument inutilisé (ends_with("pourc"))</code></pre>
<p>il se pourrait bien que R utilise la fonction <code>select</code> d’un autre module. Pour spécifier que vous désirez la fonction <code>select</code> du module <strong><code>dplyr</code></strong>, spécifiez <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select</a></code>.</p>
<p>D’autre arguments de <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> permettent une sélection rapide. Par exemple, pour obtenir les colonnes contenant des pourcentages:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"pourc"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 13
  C_pourc N_pourc P_pourc K_pourc Ca_pourc Mg_pourc S_pourc B_pourc Cu_pourc
    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1    51.5    1.72  0.108     1.21    0.435    0.470  0.0976 0.00258 0.000175
2    51.3    2.18  0.0985    1.22    0.337    0.439  0.0996 0.00258 0.000407
3    50.6    2.12  0.0708    1.05    0.373    0.420  0.104  0.00258 0.000037
# ℹ 4 more variables: Zn_pourc &lt;dbl&gt;, Mn_pourc &lt;dbl&gt;, Fe_pourc &lt;dbl&gt;,
#   Al_pourc &lt;dbl&gt;</code></pre>
</div>
</div>
</section><section id="filtrer" class="level4" data-number="3.5.2.2"><h4 data-number="3.5.2.2" class="anchored" data-anchor-id="filtrer">
<span class="header-section-number">3.5.2.2</span> Filtrer</h4>
<p>Comme c’est le cas de la sélection, on pourra filtrer un tableau de plusieurs manières. J’ai déjà présenté comment filtrer selon les indices des lignes. Les autres manières reposent néanmoins sur une opération logique <code>==</code>, <code>&lt;</code>, <code>&gt;</code> ou <code>%in%</code> (le %in% signifie <em>se trouve parmi</em> et peut être suivi d’un vecteur de valeurs que l’on désire accepter).</p>
<p>Les conditions booléennes peuvent être combinées avec les opérateurs <em>et</em>, <code>&amp;</code>, et <em>ou</em>, <code>|</code>. Pour rappel,</p>
<table class="table">
<thead><tr class="header">
<th>Opération</th>
<th>Résultat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Vrai <strong>et</strong> Vrai</td>
<td>Vrai</td>
</tr>
<tr class="even">
<td>Vrai <strong>et</strong> Faux</td>
<td>Faux</td>
</tr>
<tr class="odd">
<td>Faux <strong>et</strong> Faux</td>
<td>Faux</td>
</tr>
<tr class="even">
<td>Vrai <strong>ou</strong> Vrai</td>
<td>Vrai</td>
</tr>
<tr class="odd">
<td>Vrai <strong>ou</strong> Faux</td>
<td>Vrai</td>
</tr>
<tr class="even">
<td>Faux <strong>ou</strong> Faux</td>
<td>Faux</td>
</tr>
</tbody>
</table>
<ul>
<li>La méthode classique consiste à appliquer une opération logique entre les crochets, par exemple <code>chicoute[chicoute$CodeTourbiere == "BEAU", ]</code>
</li>
<li>La méthode <em>tidyverse</em>, plus pratique en mode pipeline, passe par la fonction <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, i.e.</li>
</ul>
<pre><code>chicoute |&gt; 
  filter(CodeTourbiere == "BEAU")</code></pre>
<p>Combiner le tout.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Ca_pourc</span> <span class="op">&lt;</span> <span class="fl">0.4</span> <span class="op">&amp;</span> <span class="va">CodeTourbiere</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BEAU"</span>, <span class="st">"MB"</span>, <span class="st">"WTP"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"pourc"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 13
  C_pourc N_pourc P_pourc K_pourc Ca_pourc Mg_pourc S_pourc B_pourc Cu_pourc
    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1    51.3    2.18  0.0985   1.22     0.337    0.439  0.0996 0.00258 0.000407
2    50.6    2.12  0.0708   1.05     0.373    0.420  0.104  0.00258 0.000037
3    53.8    2.04  0.115    0.947    0.333    0.472  0.106  0.00258 0.000037
4    52.6    2.11  0.0847   0.913    0.328    0.376  0.111  0.00296 0.000037
# ℹ 4 more variables: Zn_pourc &lt;dbl&gt;, Mn_pourc &lt;dbl&gt;, Fe_pourc &lt;dbl&gt;,
#   Al_pourc &lt;dbl&gt;</code></pre>
</div>
</div>
</section></section><section id="le-format-long-et-le-format-large" class="level3" data-number="3.5.3"><h3 data-number="3.5.3" class="anchored" data-anchor-id="le-format-long-et-le-format-large">
<span class="header-section-number">3.5.3</span> Le format long et le format large</h3>
<p>Dans le tableau <code>chicoute</code>, chaque élément possède sa propre colonne. Si l’on voulait mettre en graphique les boxplot des facettes de concentrations d’azote, de phosphore et de potassium dans les différentes tourbières, il faudrait obtenir une seule colonne de concentrations.</p>
<p>Pour ce faire, nous utiliserons la fonction <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>. L’argument obligatoire (excluant le tableau, qui est implicite dans la chaîne d’opérations), est <code>cols</code>, le nom des colonnes à allonger. Pour obtenir des noms de colonnes allongées personnalisées, on spécifie le nom des variables consistant aux anciens noms de colonnes avec <code>names_to</code> et celui de la nouvelle colonne contenant les valeurs dans <code>values_to</code>. La suite consiste à décrire les colonnes à inclure ou à exclure. Dans le cas qui suit, j’exclue CodeTourbiere de la refonte et j’utilise <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> pour présenter un échantillon aléatoire du résultat. Notez la ligne comprenant la fonction <code>mutate</code>, que l’on verra plus loin. Cette fonction ajoute une colonne au tableau. Dans ce cas-ci, j’ajoute une colonne constituée d’une séquence de nombres allant de 1 au nombre de lignes du tableau (il y en a 90). Cet identifiant unique pour chaque ligne permettra de reconstituer par la suite le tableau initial.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute_long</span> <span class="op">&lt;-</span> <span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">CodeTourbiere</span>, <span class="va">N_pourc</span>, <span class="va">P_pourc</span>, <span class="va">K_pourc</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="op">|&gt;</span>  <span class="co"># mutate ajoute une colonne au tableau</span></span>
<span>  <span class="co"># pour l'identifiant, on peut aussi utiliser la commande cur_group_rows()</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"pourc"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"nutrient"</span>, values_to <span class="op">=</span> <span class="st">"concentration"</span><span class="op">)</span></span>
<span><span class="va">chicoute_long</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   CodeTourbiere    ID nutrient concentration
   &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt;
 1 2                12 N_pourc          2.70 
 2 1                70 K_pourc          1.01 
 3 2                26 P_pourc          0.158
 4 BP                7 P_pourc          0.162
 5 MR               38 N_pourc          1.95 
 6 1                81 K_pourc          0.713
 7 NESP             41 P_pourc          0.148
 8 1                82 K_pourc          0.937
 9 BS2              65 K_pourc          1.09 
10 NTP              52 N_pourc          1.88 </code></pre>
</div>
</div>
<p>L’opération inverse est <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>, avec laquelle nous sélectionnons une colonne spécifiant les nouvelles colonnes à construire (<code>names_from</code>) ainsi que les valeurs à placer dans ces colonnes (<code>values_from</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute_large</span> <span class="op">&lt;-</span> <span class="va">chicoute_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">nutrient</span>, values_from <span class="op">=</span> <span class="va">concentration</span><span class="op">)</span></span>
<span><span class="va">chicoute_large</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   CodeTourbiere    ID N_pourc P_pourc K_pourc
   &lt;chr&gt;         &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 1                72    2.77  0.206    1.18 
 2 1                82    1.95  0.141    0.937
 3 2                24    2.72  0.181    1.14 
 4 2                14    3.10  0.207    1.33 
 5 NTP              52    1.88  0.0807   0.394
 6 MR               36    2.06  0.123    0.934
 7 WTP              88    1.63  0.0756   0.507
 8 BEAU              5    2.04  0.115    0.947
 9 MB               31    2.07  0.128    0.740
10 BEAU              4    1.95  0.0909   1.19 </code></pre>
</div>
</div>
</section><section id="combiner-des-tableaux" class="level3" data-number="3.5.4"><h3 data-number="3.5.4" class="anchored" data-anchor-id="combiner-des-tableaux">
<span class="header-section-number">3.5.4</span> Combiner des tableaux</h3>
<p>Nous avons introduit plus haut la notion de base de données. Nous voudrions peut-être utiliser le code des tourbières pour inclure leur nom, le type d’essai mené à ces tourbières, etc. Importons d’abord le tableau des noms liés aux codes.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tourbieres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2</a></span><span class="op">(</span><span class="st">"data/chicoute_tourbieres.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 11 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (4): Tourbiere, CodeTourbiere, Type, TypeCulture

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tourbieres</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
   Tourbiere               CodeTourbiere Type        TypeCulture
   &lt;chr&gt;                   &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;      
 1 Beaulieu                BEAU          calibration naturel    
 2 Brador Path             BP            calibration naturel    
 3 Lichen (BS2E)           2             validation  cultive sec
 4 Mannys Brook            MB            calibration naturel    
 5 Middle Bay Road         MR            calibration naturel    
 6 North Est of Smelt Pond NESP          calibration naturel    
 7 North of Blue Moon      NBM           calibration naturel    
 8 South of Smelt Pond     SSP           calibration naturel    
 9 Sphaigne (BS2F)         BS2           validation  cultive sec
10 Sphaigne (BS2F)         1             calibration naturel    
11 West of Trout Pond      WTP           calibration naturel    </code></pre>
</div>
</div>
<p>Notre information est organisée en deux tableaux, liés par la colonne <code>CodeTourbiere</code>. Comment fusionner l’information pour qu’elle puisse être utilisée dans son ensemble? La fonction <code>left_join</code> effectue cette opération typique avec les bases de données.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute_merge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">chicoute</span>, y <span class="op">=</span> <span class="va">tourbieres</span>, by <span class="op">=</span> <span class="st">"CodeTourbiere"</span><span class="op">)</span></span>
<span><span class="co"># ou bien chicoute |&gt;  left_join(y = tourbieres, by = "CodeTourbiere")</span></span>
<span><span class="va">chicoute_merge</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 34
     ID CodeTourbiere Ordre  Site Traitement DemiParcelle SousTraitement
  &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;         
1     1 BEAU          A         1 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
2     2 BEAU          A         2 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
3     3 BEAU          A         3 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
4     4 BEAU          A         4 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
# ℹ 27 more variables: Latitude_m &lt;dbl&gt;, Longitude_m &lt;dbl&gt;,
#   Rendement_g_5m2 &lt;dbl&gt;, TotalRamet_nombre_m2 &lt;dbl&gt;,
#   TotalVegetatif_nombre_m2 &lt;dbl&gt;, TotalFloral_nombre_m2 &lt;dbl&gt;,
#   TotalMale_nombre_m2 &lt;dbl&gt;, TotalFemelle_nombre_m2 &lt;dbl&gt;,
#   FemelleFruit_nombre_m2 &lt;dbl&gt;, FemelleAvorte_nombre_m2 &lt;dbl&gt;,
#   SterileFleur_nombre_m2 &lt;dbl&gt;, C_pourc &lt;dbl&gt;, N_pourc &lt;dbl&gt;, P_pourc &lt;dbl&gt;,
#   K_pourc &lt;dbl&gt;, Ca_pourc &lt;dbl&gt;, Mg_pourc &lt;dbl&gt;, S_pourc &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>D’autres types de jointures sont possibles, et décrites en détails dans la <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">documentation</a>.</p>
<p><a href="https://www.garrickadenbuie.com/">Garrick Aden-Buie</a> a préparé de <a href="https://gist.github.com/gadenbuie/077bcd2700ac1241c65c324581a9f619">jolies animations</a> pour décrire les différents types de jointures.</p>
<p><code>left_join(x, y)</code> colle y à x seulement ce qui dans y correspond à ce que l’on trouve dans x.</p>
<p><img src="images/04_animated-left-join.gif" class="img-fluid"></p>
<p><code>right_join(x, y)</code> colle y à x seulement ce qui dans x correspond à ce que l’on trouve dans y.</p>
<p><img src="images/04_animated-right-join.gif" class="img-fluid"></p>
<p><code>inner_join(x, y)</code> colle x et y en excluant les lignes où au moins une variable de jointure est absente dans x et y.</p>
<p><img src="images/04_animated-inner-join.gif" class="img-fluid"></p>
<p><code>full_join(x, y)</code>garde toutes les lignes et les colonnes de x et y.</p>
<p><img src="images/04_animated-full-join.gif" class="img-fluid"></p>
</section><section id="opérations-sur-les-tableaux" class="level3" data-number="3.5.5"><h3 data-number="3.5.5" class="anchored" data-anchor-id="opérations-sur-les-tableaux">
<span class="header-section-number">3.5.5</span> Opérations sur les tableaux</h3>
<p>Les tableaux peuvent être segmentés en éléments sur lesquels on calculera ce qui nous chante.</p>
<p>On pourrait vouloir obtenir :</p>
<ul>
<li>la somme avec la function <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>
</li>
<li>la moyenne avec la function <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> ou la médiane avec la fonction <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>
</li>
<li>l’écart-type avec la function <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>
</li>
<li>les maximum et minimum avec les fonctions <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> et <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>
</li>
<li>un décompte d’occurrence avec la fonction <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> ou <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>
</li>
</ul>
<p>Par exemple,</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">chicoute</span><span class="op">$</span><span class="va">Rendement_g_5m2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.32851</code></pre>
</div>
</div>
<p><strong>En mode classique</strong>, pour effectuer des opérations sur des tableaux, on utilisera la fonction <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>. Cette fonction prend, comme arguments, le tableau, l’axe (opération par ligne = 1, opération par colonne = 2), puis la fonction à appliquer.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">chicoute</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"pourc"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     C_pourc      N_pourc      P_pourc      K_pourc     Ca_pourc     Mg_pourc 
5.027911e+01 2.199411e+00 1.388959e-01 8.887000e-01 3.884391e-01 4.980142e-01 
     S_pourc      B_pourc     Cu_pourc     Zn_pourc     Mn_pourc     Fe_pourc 
1.347177e-01 3.090922e-03 4.089891e-04 6.662155e-03 3.345239e-02 1.514885e-02 
    Al_pourc 
2.694979e-03 </code></pre>
</div>
</div>
<p>Les opérations peuvent aussi être effectuées par ligne, par exemple une somme (je garde seulement les 10 premiers résultats).</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">chicoute</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"pourc"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 55.64299 55.76767 54.78856 55.84453 57.89671 55.53603 55.62526 55.10991
 [9] 55.06295 55.16774</code></pre>
</div>
</div>
<p>La fonction à appliquer peut être personnalisée, par exemple:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span></span>
<span>  <span class="va">chicoute</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"pourc"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     C_pourc      N_pourc      P_pourc      K_pourc     Ca_pourc     Mg_pourc 
50.253429104  2.165246915  0.133754530  0.846193827  0.376192724  0.491763884 
     S_pourc      B_pourc     Cu_pourc     Zn_pourc     Mn_pourc     Fe_pourc 
 0.129900753  0.003014675  0.000000000  0.006408775  0.024140327  0.014351745 
    Al_pourc 
 0.002450982 </code></pre>
</div>
</div>
<p>Vous reconnaissez cette fonction? C’était la moyenne géométrique (la fonction <code><a href="https://rdrr.io/r/base/prod.html">prod()</a></code> étant le produit d’un vecteur).</p>
<p><strong>En mode tidyverse</strong>, on aura besoin principalement des fonction suivantes:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> pour effectuer des opérations par groupe, l’opération <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> sépare le tableau en plusieurs petits tableaux, en attendant de les recombiner. C’est un peu l’équivalent des facettes avec le module de visualisation ggplot2, que nous explorons au <span class="quarto-unresolved-ref">?sec-visual</span>.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> pour réduire plusieurs valeurs en une seule, il applique un calcul sur le tableau ou s’il y a lieu sur chaque petit tableau segmenté. Il en existe quelques variantes.
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all()</a></code> applique la fonction à toutes les colonnes</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at()</a></code> applique la fonction aux colonnes spécifiées</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if()</a></code> applique la fonction aux colonnes qui ressortent comme <code>TRUE</code> selon une opération booléenne</li>
</ul>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> pour ajouter une nouvelle colonne
<ul>
<li>Si l’on désire ajouter une colonne à un tableau, par exemple le sommaire calculé avec <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>. À l’inverse, la fonction <code><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute()</a></code> retournera seulement le résultat, sans le tableau à partir duquel il a été calculé. De même que <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> et <code><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute()</a></code> possèdent leurs équivalents <code>_all()</code>, <code>_at()</code> et <code>_if()</code>.</li>
</ul>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> pour réordonner le tableau
<ul>
<li>Cette fonction est parfois utile lors de la mise en page de tableaux ou de graphiques. Il ne s’agit pas d’une opération sur un tableau, mais plutôt un changement d’affichage en changeant l’ordre d’apparition des données.</li>
</ul>
</li>
</ul>
<p>Ces opérations sont décrites dans l’aide-mémoire <a href="https://rstudio.github.io/cheatsheets/data-transformation.pdf"><em>Data Transformation Cheat Sheet</em></a> (<a href="#fig-tab-trans-cs">Figure&nbsp;<span>3.6</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-tab-trans-cs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/04_data-transformation-cs.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3.6: Aide-mémoire pour la transformation des données, <a href="https://rstudio.github.io/cheatsheets/data-transformation.pdf">https://rstudio.github.io/cheatsheets/data-transformation.pdf</a></figcaption></figure>
</div>
</div>
</div>
<p>Pour effectuer des statistiques par colonne, on utilisera <code>summarise</code> pour des statistiques effectuées sur une seule colonne. <code>summarise</code> peut prendre le nombre désiré de statistiques dont la sortie est un scalaire.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    moyenne <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">TotalFloral_nombre_m2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    ecart_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">TotalFloral_nombre_m2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  moyenne ecart_type
    &lt;dbl&gt;      &lt;dbl&gt;
1    52.1       40.4</code></pre>
</div>
</div>
<p>Si l’on désire un sommaire sur toutes les variables sélectionnées, on utilisera <code><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all()</a></code>. Pour spécifier que l’on désire la moyenne et l’écart-type, on inscrit les noms des fonctions dans <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"pourc"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">sd</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 26
  C_pourc_fn1 N_pourc_fn1 P_pourc_fn1 K_pourc_fn1 Ca_pourc_fn1 Mg_pourc_fn1
        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
1        50.3        2.20       0.139       0.889        0.388        0.498
# ℹ 20 more variables: S_pourc_fn1 &lt;dbl&gt;, B_pourc_fn1 &lt;dbl&gt;,
#   Cu_pourc_fn1 &lt;dbl&gt;, Zn_pourc_fn1 &lt;dbl&gt;, Mn_pourc_fn1 &lt;dbl&gt;,
#   Fe_pourc_fn1 &lt;dbl&gt;, Al_pourc_fn1 &lt;dbl&gt;, C_pourc_fn2 &lt;dbl&gt;,
#   N_pourc_fn2 &lt;dbl&gt;, P_pourc_fn2 &lt;dbl&gt;, K_pourc_fn2 &lt;dbl&gt;,
#   Ca_pourc_fn2 &lt;dbl&gt;, Mg_pourc_fn2 &lt;dbl&gt;, S_pourc_fn2 &lt;dbl&gt;,
#   B_pourc_fn2 &lt;dbl&gt;, Cu_pourc_fn2 &lt;dbl&gt;, Zn_pourc_fn2 &lt;dbl&gt;,
#   Mn_pourc_fn2 &lt;dbl&gt;, Fe_pourc_fn2 &lt;dbl&gt;, Al_pourc_fn2 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>On utilisera <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> pour segmenter le tableau, et ainsi obtenir des statistiques pour chaque groupe.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">CodeTourbiere</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    moyenne <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">TotalFloral_nombre_m2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    ecart_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">TotalFloral_nombre_m2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   CodeTourbiere moyenne ecart_type
   &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;
 1 1                72.1      32.7 
 2 2                37.1      32.9 
 3 BEAU            149.       53.2 
 4 BP               60.4      30.6 
 5 BS2              27.2      15.5 
 6 MB               64.7      40.8 
 7 MR               35.1      10.5 
 8 NBM              35.1      16.6 
 9 NESP             21.4       4.88
10 NTP              47.6      15.9 
11 SSP              25.7      11.1 
12 WTP              50.2      28.3 </code></pre>
</div>
</div>
<p>Dans le cas de <code>summarise_all</code>, les résultats s’affichent de la même manière.</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">CodeTourbiere</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">N_pourc</span>, <span class="va">P_pourc</span>, <span class="va">K_pourc</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">sd</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `CodeTourbiere`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 7
   CodeTourbiere N_pourc_fn1 P_pourc_fn1 K_pourc_fn1 N_pourc_fn2 P_pourc_fn2
   &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 1                    2.26      0.156        0.880      0.250      0.0193 
 2 2                    2.76      0.181        1.12       0.178      0.0283 
 3 BEAU                 2.00      0.0967       1.12       0.179      0.0172 
 4 BP                   2.05      0.158        0.747      0.161      0.00625
 5 BS2                  2.08      0.103        1.12       0.420      0.0218 
 6 MB                   2.15      0.109        0.675      0.114      0.0165 
 7 MR                   1.99      0.127        0.830      0.0802     0.0131 
 8 NBM                  2.01      0.127        0.854      0.310      0.0202 
 9 NESP                 1.76      0.135        0.945      0.149      0.0108 
10 NTP                  1.83      0.0873       0.402      0.166      0.0103 
11 SSP                  1.83      0.130        0.700      0.160      0.00383
12 WTP                  1.79      0.0811       0.578      0.132      0.00587
# ℹ 1 more variable: K_pourc_fn2 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Pour obtenir des statistiques à chaque ligne, mieux vaut utiliser <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>, tel que vu précédemment. Le point, <code>.</code>, représente le tableau dans une fonction qui n’a pas été conçue pour fonctionner de facto avec <strong><code>dplyr</code></strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"pourc"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 55.64299 55.76767 54.78856 55.84453 57.89671 55.53603 55.62526 55.10991
 [9] 55.06295 55.16774 56.41123 55.47917 55.43537 55.79175 55.44561 54.85448
[17] 54.34262 55.03075 54.40533 51.89319 54.70172 54.62176 54.30250 53.86976
[25] 53.44731 53.86244 52.43280 54.34978 53.96756 51.46672 55.44267 54.70350
[33] 55.30711 56.16200 56.64710 55.95499 54.76370 54.32775 54.95419 53.37094
[41] 53.07855 53.04541 52.09520 52.40456 51.92376 53.33248 56.56405 56.35004
[49] 56.27185 55.56986 53.81654 55.39638 55.51961 54.88098 54.74774 51.08921
[57] 51.31462 53.46819 53.15640 52.82020 57.78038 57.94636 56.65558 56.28845
[65] 55.54463 56.51751 55.36497 56.00594 55.64247 56.56967 56.81674 55.87070
[73] 55.72308 56.14116 56.42611 55.35650 54.90469 54.03674 53.42991 53.99334
[81] 53.09085 53.23222 53.28212 53.63192 53.48102 52.31131 51.72026 51.10534
[89] 51.49055 51.59297</code></pre>
</div>
</div>
<p>Prenons ce tableau des espèces menacées issu de l’Union internationale pour la conservation de la nature <a href="https://stats.oecd.org/Index.aspx?DataSetCode=WILD_LIFE">distribué par l’OCDE</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></span>
<span><span class="va">especes_menacees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/WILD_LIFE_14012020030114795.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous exécutons le pipeline suivant.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">especes_menacees</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">IUCN</span> <span class="op">==</span> <span class="st">"CRITICAL"</span>, <span class="va">SPEC</span> <span class="op">==</span> <span class="st">"VASCULAR_PLANT"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Value</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_critical_plants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n_critical_plants</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   Country         n_critical_plants
   &lt;chr&gt;                       &lt;dbl&gt;
 1 United States                1222
 2 Japan                         525
 3 Canada                        315
 4 Czech Republic                284
 5 Spain                         271
 6 Belgium                       253
 7 Austria                       172
 8 Slovak Republic               155
 9 Australia                     148
10 Italy                         128</code></pre>
</div>
</div>
<p>Ce pipeline consiste à:</p>
<pre><code>prendre le tableau especes_menacees, puis
  
filtrer pour n'obtenir que les espèces critiques dans la catégorie des plantes vasculaires, puis
  
sélectionner les colonnes des pays et des valeurs (nombre d'espèces), puis

segmenter le tableau en plusieurs tableaux selon le pays, puis

appliquer la fonction sum pour chacun de ces petits tableaux (et recombiner ces sommaires), puis

trier les pays en nombre décroissant de décompte d'espèces, puis

afficher le top 10</code></pre>
<p>Notez qu’il aurait aussi été possible d’utiliser la fonction <code>dplyr::slice_max(n_critical_plants, n = 10)</code> pour afficher directement le top 10, sans faire le tri préalable.</p>
</section><section id="exemple-difficile" class="level3" data-number="3.5.6"><h3 data-number="3.5.6" class="anchored" data-anchor-id="exemple-difficile">
<span class="header-section-number">3.5.6</span> Exemple (difficile)</h3>
<p>Pour revenir à notre tableau <code>chicoute</code>, imaginez que vous aviez une station météo (station_A) située aux coordonnées (490640, 5702453) et que vous désiriez calculer la distance entre l’observation et la station. Prenez du temps pour réfléchir à la manière dont vous procéderez…</p>
<hr>
<p>On pourra créer une fonction qui mesure la distance entre un point x, y et les coordonnées de la station A…</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dist_station_A</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">490640</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fl">5702453</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>… puis ajouter une colonne avec mutate grâce à une fonction prenant les arguments x et y spécifiés.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="fu">dist_station_A</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude_m</span>, y <span class="op">=</span> <span class="va">Latitude_m</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">CodeTourbiere</span>, <span class="va">Longitude_m</span>, <span class="va">Latitude_m</span>, <span class="va">dist</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
      ID CodeTourbiere Longitude_m Latitude_m    dist
   &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
 1     4 BEAU               490647    5702453    7   
 2    83 1                  486505    5702162 4145.  
 3    84 1                  486514    5702160 4136.  
 4     2 BEAU               490634    5702452    6.08
 5    80 1                  486504    5702081 4153.  
 6    27 2                  486353    5702478 4287.  
 7    32 MB                 491935    5699337 3374.  
 8    53 NTP                487562    5704093 3488.  
 9    59 SSP                484454    5699796 6732.  
10    47 NBM                485972    5696590 7494.  </code></pre>
</div>
</div>
<p>Nous pourrions procéder de la même manière pour fusionner des données climatiques. Le tableau <code>chicoute</code> ne possède pas d’indicateurs climatiques, mais il est possible de les soutirer de stations météo placées près des sites. Ces données ne sont pas disponibles pour le tableau de la chicouté, alors j’utiliserai des données fictives pour l’exemple.</p>
<p>Voici ce qui pourrait être fait.</p>
<ol type="1">
<li>Créer un tableau des stations météo ainsi que des indices météorologiques associés à ces stations.</li>
<li>Lier chaque site à une station (à la main où selon la plus petite distance entre le site et la station).</li>
<li>Fusionner les indices climatiques aux sites, puis les sites aux mesures de rendement.</li>
</ol>
<p>Ces opérations demandent habituellement du tâtonnement. Il serait surprenant que même une personne expérimentée soit en mesure de compiler ces opérations sans obtenir de message d’erreur, et retravailler jusqu’à obtenir le résultat souhaité. L’objectif de cette section est de vous présenter un flux de travail que vous pourriez être amenés à effectuer et de fournir quelques éléments nouveaux pour mener à bien une opération. Il peut être frustrant de ne pas saisir toutes les opérations: passez à travers cette section sans jugement. Si vous devez vous frotter à un problème semblable, vous saurez que vous trouverez dans ce manuel une recette intéressante.</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mes_stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Station <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>,</span>
<span>  Longitude_m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">490640</span>, <span class="fl">484870</span>, <span class="fl">485929</span><span class="op">)</span>,</span>
<span>  Latitude_m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5702453</span>, <span class="fl">5701870</span>, <span class="fl">5696421</span><span class="op">)</span>,</span>
<span>  t_moy_C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">13.8</span>, <span class="fl">18.2</span>, <span class="fl">16.30</span><span class="op">)</span>,</span>
<span>  prec_tot_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">687</span>, <span class="fl">714</span>, <span class="fl">732</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mes_stations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Station Longitude_m Latitude_m t_moy_C prec_tot_mm
1       A      490640    5702453    13.8         687
2       B      484870    5701870    18.2         714
3       C      485929    5696421    16.3         732</code></pre>
</div>
</div>
<p>La fonction suivante calcule la distance entre des coordonnées x et y et chaque station d’un tableau de stations, puis retourne le nom de la station dont la distance est la moindre.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dist_station</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">stations_df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># stations est le tableau des stations à trois colonnes</span></span>
<span>  <span class="co"># 1iere: nom de la station</span></span>
<span>  <span class="co"># 2ieme: longitude</span></span>
<span>  <span class="co"># 3ieme: latitude</span></span>
<span>  <span class="va">distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">stations_df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">distance</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">stations_df</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">stations_df</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">nom_station</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">stations_df</span><span class="op">$</span><span class="va">Station</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">nom_station</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Testons la fonction avec des coordonnées.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">dist_station</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">459875</span>, y <span class="op">=</span> <span class="fl">5701988</span>, stations_df <span class="op">=</span> <span class="va">mes_stations</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "B"</code></pre>
</div>
</div>
<p>Nous appliquons cette fonction à toutes les lignes du tableau, puis en retournons un échantillon.</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Station <span class="op">=</span> <span class="fu">dist_station</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude_m</span>, y <span class="op">=</span> <span class="va">Latitude_m</span>, stations_df <span class="op">=</span> <span class="va">mes_stations</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">CodeTourbiere</span>, <span class="va">Longitude_m</span>, <span class="va">Latitude_m</span>, <span class="va">Station</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 90 × 5
# Rowwise: 
      ID CodeTourbiere Longitude_m Latitude_m Station
   &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;  
 1     1 BEAU               490627    5702454 A      
 2     2 BEAU               490634    5702452 A      
 3     3 BEAU               490638    5702461 A      
 4     4 BEAU               490647    5702453 A      
 5     5 BEAU               490654    5702445 A      
 6     6 BP                 484865    5706394 B      
 7     7 BP                 484054    5706307 B      
 8     8 BP                 484742    5702280 B      
 9     9 BP                 484761    5706324 B      
10    10 BP                 484780    5706364 B      
# ℹ 80 more rows</code></pre>
</div>
</div>
<p>Cela semble fonctionner. On peut y ajouter un <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> pour joindre les données météo au tableau principal.</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chicoute_weather</span> <span class="op">&lt;-</span> <span class="va">chicoute</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Station <span class="op">=</span> <span class="fu">dist_station</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude_m</span>, y <span class="op">=</span> <span class="va">Latitude_m</span>, stations_df <span class="op">=</span> <span class="va">mes_stations</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mes_stations</span>, by <span class="op">=</span> <span class="st">"Station"</span><span class="op">)</span></span>
<span><span class="va">chicoute_weather</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 90 × 36
# Rowwise: 
      ID CodeTourbiere Ordre  Site Traitement DemiParcelle SousTraitement
   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;         
 1     1 BEAU          A         1 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
 2     2 BEAU          A         2 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
 3     3 BEAU          A         3 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
 4     4 BEAU          A         4 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
 5     5 BEAU          A         5 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
 6     6 BP            H         1 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
 7     7 BP            H         2 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
 8     8 BP            H         3 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
 9     9 BP            H         4 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
10    10 BP            H         5 &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;          
# ℹ 80 more rows
# ℹ 29 more variables: Latitude_m.x &lt;dbl&gt;, Longitude_m.x &lt;dbl&gt;,
#   Rendement_g_5m2 &lt;dbl&gt;, TotalRamet_nombre_m2 &lt;dbl&gt;,
#   TotalVegetatif_nombre_m2 &lt;dbl&gt;, TotalFloral_nombre_m2 &lt;dbl&gt;,
#   TotalMale_nombre_m2 &lt;dbl&gt;, TotalFemelle_nombre_m2 &lt;dbl&gt;,
#   FemelleFruit_nombre_m2 &lt;dbl&gt;, FemelleAvorte_nombre_m2 &lt;dbl&gt;,
#   SterileFleur_nombre_m2 &lt;dbl&gt;, C_pourc &lt;dbl&gt;, N_pourc &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section><section id="exporter-un-tableau" class="level3" data-number="3.5.7"><h3 data-number="3.5.7" class="anchored" data-anchor-id="exporter-un-tableau">
<span class="header-section-number">3.5.7</span> Exporter un tableau</h3>
<p>Simplement avec <code><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">chicoute_weather</span>, <span class="st">"data/chicoute_weather.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="aller-plus-loin-dans-le-tidyverse" class="level3" data-number="3.5.8"><h3 data-number="3.5.8" class="anchored" data-anchor-id="aller-plus-loin-dans-le-tidyverse">
<span class="header-section-number">3.5.8</span> Aller plus loin dans le tidyverse</h3>
<p>Le livre <a href="https://r4ds.hadley.nz/">R for data science (2e)</a>, de Hadley Wickham et Garrett Grolemund (couverture à la <a href="#fig-wickham-book">Figure&nbsp;<span>3.7</span></a>), est un incontournable.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-wickham-book" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/04_wickhamcover.jpg" class="img-fluid figure-img" style="width:30.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.7: Couverture du libre de Hadley Wickham, Mine Çetinkaya-Rundel et Garrett Grolemund, Source: https://r4ds.hadley.nz/</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="références" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="références">
<span class="header-section-number">3.6</span> Références</h2>
<p>Parent L.E., Parent, S.É., Herbert-Gentile, V., Naess, K. et Lapointe, L. 2013. Mineral Balance Plasticity of Cloudberry (Rubus chamaemorus) in Quebec-Labrador Bogs. American Journal of Plant Sciences, 4, 1508-1520. DOI: <a href="http://dx.doi.org/10.4236/ajps.2013.47183">10.4236/ajps.2013.47183</a></p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02-R.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">La science des données avec R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-visualisation.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualisation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Analyse et modélisation d’agroécosystèmes est construit avec <a href="https://quarto.org/">Quarto</a>.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Lien vers le <a href="https://essicolo.github.io/ecologie-mathematique-R/">manuel original</a>.</div>
  </div>
</footer>


</body></html>